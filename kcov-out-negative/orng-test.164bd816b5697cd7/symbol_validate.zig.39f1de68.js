var data = {lines:[
{"lineNum":"    1","line":"//! This file contains the semantic validation logic for symbols."},
{"lineNum":"    2","line":""},
{"lineNum":"    3","line":"const std = @import(\"std\");"},
{"lineNum":"    4","line":"const ast_ = @import(\"../ast/ast.zig\");"},
{"lineNum":"    5","line":"const Compiler_Context = @import(\"../hierarchy/compiler.zig\");"},
{"lineNum":"    6","line":"const Const_Eval = @import(\"const_eval.zig\");"},
{"lineNum":"    7","line":"const typecheck_AST = @import(\"typecheck.zig\").typecheck_AST;"},
{"lineNum":"    8","line":"const errs_ = @import(\"../util/errors.zig\");"},
{"lineNum":"    9","line":"const prelude_ = @import(\"../hierarchy/prelude.zig\");"},
{"lineNum":"   10","line":"const String = @import(\"../zig-string/zig-string.zig\").String;"},
{"lineNum":"   11","line":"const Symbol = @import(\"../symbol/symbol.zig\");"},
{"lineNum":"   12","line":"const Token = @import(\"../lexer/token.zig\");"},
{"lineNum":"   13","line":"const Tree_Writer = @import(\"../ast/tree_writer.zig\");"},
{"lineNum":"   14","line":"const Type_AST = @import(\"../types/type.zig\").Type_AST;"},
{"lineNum":"   15","line":"const walk_ = @import(\"../ast/walker.zig\");"},
{"lineNum":"   16","line":""},
{"lineNum":"   17","line":"const Validate_Error_Enum = error{ OutOfMemory, CompileError };"},
{"lineNum":"   18","line":""},
{"lineNum":"   19","line":"const Self: type = @This();"},
{"lineNum":"   20","line":""},
{"lineNum":"   21","line":"ctx: *Compiler_Context,"},
{"lineNum":"   22","line":""},
{"lineNum":"   23","line":"pub fn init(ctx: *Compiler_Context) Self {","class":"lineCov","hits":"2","order":"104","possible_hits":"2",},
{"lineNum":"   24","line":"    return Self{ .ctx = ctx };","class":"lineCov","hits":"1","order":"105","possible_hits":"1",},
{"lineNum":"   25","line":"}"},
{"lineNum":"   26","line":""},
{"lineNum":"   27","line":"pub fn validate_symbol(self: *Self, symbol: *Symbol) Validate_Error_Enum!void {","class":"lineCov","hits":"2","order":"2064","possible_hits":"2",},
{"lineNum":"   28","line":"    // TODO: Bit long"},
{"lineNum":"   29","line":"    if (symbol.validation_state == .valid or symbol.validation_state == .validating) {","class":"lineCov","hits":"2","order":"2065","possible_hits":"2",},
{"lineNum":"   30","line":"        return;","class":"lineCov","hits":"1","order":"3264","possible_hits":"1",},
{"lineNum":"   31","line":"    }"},
{"lineNum":"   32","line":"    symbol.validation_state = .validating;","class":"lineCov","hits":"1","order":"2066","possible_hits":"1",},
{"lineNum":"   33","line":"    symbol.init_validation_state = .validating;","class":"lineCov","hits":"1","order":"2067","possible_hits":"1",},
{"lineNum":"   34","line":""},
{"lineNum":"   35","line":"    _ = symbol.assert_symbol_valid();","class":"lineCov","hits":"1","order":"2068","possible_hits":"1",},
{"lineNum":"   36","line":"    const expected: ?*Type_AST = switch (symbol.kind) {","class":"lineCov","hits":"3","order":"2069","possible_hits":"3",},
{"lineNum":"   37","line":"        .@\"fn\", .@\"test\" => symbol.type().rhs(),","class":"lineCov","hits":"2","order":"2070","possible_hits":"2",},
{"lineNum":"   38","line":"        .type, .context => null,"},
{"lineNum":"   39","line":"        .import_inner => if (symbol.decl.?.* == .type_alias) null else symbol.type(),","class":"lineNoCov","hits":"0","possible_hits":"2",},
{"lineNum":"   40","line":"        else => symbol.type(),","class":"lineCov","hits":"2","order":"2071","possible_hits":"2",},
{"lineNum":"   41","line":"    };"},
{"lineNum":"   42","line":""},
{"lineNum":"   43","line":"    // std.debug.print(\"validating type for: {s} ({t}): {?f}\\n\", .{ symbol.name, symbol.kind, expected });"},
{"lineNum":"   44","line":""},
{"lineNum":"   45","line":"    if (expected) |expected_type| {","class":"lineCov","hits":"2","order":"2072","possible_hits":"2",},
{"lineNum":"   46","line":"        try self.ctx.validate_type.validate_type(expected_type);","class":"lineCov","hits":"2","order":"2227","possible_hits":"2",},
{"lineNum":"   47","line":"        if (self.ctx.validate_type.detect_cycle(expected_type, null)) {","class":"lineCov","hits":"1","order":"2228","possible_hits":"1",},
{"lineNum":"   48","line":"            self.ctx.errors.add_error(errs_.Error{ .symbol_error = .{","class":"lineNoCov","hits":"0","possible_hits":"2",},
{"lineNum":"   49","line":"                .problem = \"cyclic type detected\","},
{"lineNum":"   50","line":"                .span = symbol.span(),","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"   51","line":"                .name = symbol.name,","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"   52","line":"            } });"},
{"lineNum":"   53","line":"            return error.CompileError;","class":"linePartCov","hits":"2","order":"2073","possible_hits":"3",},
{"lineNum":"   54","line":"        }"},
{"lineNum":"   55","line":"    }"},
{"lineNum":"   56","line":""},
{"lineNum":"   57","line":"    if (symbol.init_value()) |_init| {","class":"lineCov","hits":"2","order":"2074","possible_hits":"2",},
{"lineNum":"   58","line":"        // might be null for parameters"},
{"lineNum":"   59","line":"        _ = self.ctx.typecheck.typecheck_AST(_init, expected) catch |e| switch (e) {","class":"linePartCov","hits":"2","order":"2229","possible_hits":"3",},
{"lineNum":"   60","line":"            error.CompileError => return error.CompileError,","class":"lineCov","hits":"1","order":"4838","possible_hits":"1",},
{"lineNum":"   61","line":"            error.OutOfMemory => return error.OutOfMemory,","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"   62","line":"            error.UnexpectedTypeType => {"},
{"lineNum":"   63","line":"                self.ctx.errors.add_error(errs_.Error{ .unexpected_type_type = .{ .expected = expected, .span = _init.token().span } });","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"   64","line":"                return error.CompileError;","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"   65","line":"            },"},
{"lineNum":"   66","line":"        };"},
{"lineNum":"   67","line":"        if (_init.* != .module) {","class":"lineCov","hits":"1","order":"2232","possible_hits":"1",},
{"lineNum":"   68","line":"            try walk_.walk_ast(_init, Const_Eval.new(self.ctx));","class":"lineCov","hits":"3","order":"2233","possible_hits":"3",},
{"lineNum":"   69","line":"        }"},
{"lineNum":"   70","line":"    } else if (symbol.kind == .type and symbol.init_typedef() != null) {","class":"lineCov","hits":"2","order":"2075","possible_hits":"2",},
{"lineNum":"   71","line":"        try self.ctx.validate_type.validate_type(symbol.init_typedef().?);","class":"lineCov","hits":"2","order":"2078","possible_hits":"2",},
{"lineNum":"   72","line":"        if (self.ctx.validate_type.detect_cycle(symbol.init_typedef().?, symbol)) {","class":"lineCov","hits":"2","order":"2171","possible_hits":"2",},
{"lineNum":"   73","line":"            self.ctx.errors.add_error(errs_.Error{ .basic = .{","class":"lineCov","hits":"2","order":"6715","possible_hits":"2",},
{"lineNum":"   74","line":"                .msg = \"cyclic type detected\","},
{"lineNum":"   75","line":"                .span = symbol.span(),","class":"lineCov","hits":"1","order":"6716","possible_hits":"1",},
{"lineNum":"   76","line":"            } });"},
{"lineNum":"   77","line":"            return error.CompileError;","class":"lineCov","hits":"4","order":"2199","possible_hits":"4",},
{"lineNum":"   78","line":"        }"},
{"lineNum":"   79","line":"    }"},
{"lineNum":"   80","line":""},
{"lineNum":"   81","line":"    if (symbol.kind == .trait) {","class":"lineCov","hits":"1","order":"2200","possible_hits":"1",},
{"lineNum":"   82","line":"        try self.validate_trait(symbol);","class":"lineCov","hits":"2","order":"2234","possible_hits":"2",},
{"lineNum":"   83","line":"    } else if (symbol.init_value() != null and symbol.init_value().?.* == .poison) {","class":"lineCov","hits":"2","order":"2201","possible_hits":"2",},
{"lineNum":"   84","line":"        symbol.validation_state = .invalid;","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"   85","line":"        symbol.init_validation_state = .invalid;","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"   86","line":"        return error.CompileError;","class":"linePartCov","hits":"1","order":"2202","possible_hits":"2",},
{"lineNum":"   87","line":"        // unreachable;"},
{"lineNum":"   88","line":"    }"},
{"lineNum":"   89","line":""},
{"lineNum":"   90","line":"    // Check that tests are requesting good contexts"},
{"lineNum":"   91","line":"    if (symbol.kind == .@\"test\") {","class":"lineCov","hits":"2","order":"2203","possible_hits":"2",},
{"lineNum":"   92","line":"        for (symbol.type().function.contexts.items) |ctx| {","class":"lineCov","hits":"4","order":"5103","possible_hits":"4",},
{"lineNum":"   93","line":"            if (!ctx.child().types_match(self.ctx.get_core_type(\"Allocating\"))) {","class":"lineCov","hits":"1","order":"5104","possible_hits":"1",},
{"lineNum":"   94","line":"                self.ctx.errors.add_error(errs_.Error{ .basic = .{","class":"lineCov","hits":"2","order":"5105","possible_hits":"2",},
{"lineNum":"   95","line":"                    .span = ctx.token().span,","class":"lineCov","hits":"1","order":"5106","possible_hits":"1",},
{"lineNum":"   96","line":"                    .msg = \"test can\'t request this context\","},
{"lineNum":"   97","line":"                } });"},
{"lineNum":"   98","line":"                return error.CompileError;","class":"lineCov","hits":"1","order":"5107","possible_hits":"1",},
{"lineNum":"   99","line":"            }"},
{"lineNum":"  100","line":"        }","class":"linePartCov","hits":"1","order":"2204","possible_hits":"5",},
{"lineNum":"  101","line":"    }"},
{"lineNum":"  102","line":""},
{"lineNum":"  103","line":"    // Symbol\'s name must be capitalized iff its type is Type"},
{"lineNum":"  104","line":"    if (symbol.is_type() or symbol.kind == .trait or symbol.kind == .context) {","class":"lineCov","hits":"2","order":"2205","possible_hits":"2",},
{"lineNum":"  105","line":"        if (!is_capitalized(symbol.name)) {","class":"lineCov","hits":"1","order":"2206","possible_hits":"1",},
{"lineNum":"  106","line":"            self.ctx.errors.add_error(errs_.Error{ .symbol_error = .{","class":"lineCov","hits":"2","order":"6258","possible_hits":"2",},
{"lineNum":"  107","line":"                .problem = \"must start with an uppercase letter\","},
{"lineNum":"  108","line":"                .span = symbol.span(),","class":"lineCov","hits":"1","order":"6259","possible_hits":"1",},
{"lineNum":"  109","line":"                .name = symbol.name,","class":"lineCov","hits":"1","order":"6260","possible_hits":"1",},
{"lineNum":"  110","line":"            } });"},
{"lineNum":"  111","line":"            return error.CompileError;","class":"lineCov","hits":"2","order":"2214","possible_hits":"2",},
{"lineNum":"  112","line":"        }"},
{"lineNum":"  113","line":"    } else {"},
{"lineNum":"  114","line":"        if (is_capitalized(symbol.name)) {","class":"lineCov","hits":"1","order":"2336","possible_hits":"1",},
{"lineNum":"  115","line":"            self.ctx.errors.add_error(errs_.Error{ .symbol_error = .{","class":"lineCov","hits":"2","order":"6270","possible_hits":"2",},
{"lineNum":"  116","line":"                .problem = \"must start with an lowercase letter\","},
{"lineNum":"  117","line":"                .span = symbol.span(),","class":"lineCov","hits":"1","order":"6271","possible_hits":"1",},
{"lineNum":"  118","line":"                .name = symbol.name,","class":"lineCov","hits":"1","order":"6272","possible_hits":"1",},
{"lineNum":"  119","line":"            } });"},
{"lineNum":"  120","line":"            return error.CompileError;","class":"lineCov","hits":"2","order":"2338","possible_hits":"2",},
{"lineNum":"  121","line":"        }"},
{"lineNum":"  122","line":"    }"},
{"lineNum":"  123","line":""},
{"lineNum":"  124","line":"    if (symbol.storage == .@\"extern\") {","class":"lineCov","hits":"1","order":"2215","possible_hits":"1",},
{"lineNum":"  125","line":"        if (symbol.storage.@\"extern\".c_name != null) {","class":"lineCov","hits":"2","order":"5145","possible_hits":"2",},
{"lineNum":"  126","line":"            _ = self.ctx.typecheck.typecheck_AST(symbol.storage.@\"extern\".c_name.?, prelude_.string_type) catch return error.CompileError;","class":"lineCov","hits":"2","order":"5146","possible_hits":"2",},
{"lineNum":"  127","line":"        } else {"},
{"lineNum":"  128","line":"            symbol.storage.@\"extern\".c_name = ast_.AST.create_string(Token.init_simple(symbol.name), symbol.name, self.ctx.allocator());","class":"lineCov","hits":"4","order":"2216","possible_hits":"4",},
{"lineNum":"  129","line":"        }"},
{"lineNum":"  130","line":"    }"},
{"lineNum":"  131","line":""},
{"lineNum":"  132","line":"    _ = symbol.assert_init_valid();","class":"lineCov","hits":"1","order":"2217","possible_hits":"1",},
{"lineNum":"  133","line":"}"},
{"lineNum":"  134","line":""},
{"lineNum":"  135","line":"fn type_is_type_type(ast: *ast_.AST) bool {"},
{"lineNum":"  136","line":"    if (ast.* == .function) {"},
{"lineNum":"  137","line":"        return type_is_type_type_atom(ast.rhs());"},
{"lineNum":"  138","line":"    } else {"},
{"lineNum":"  139","line":"        return type_is_type_type_atom(ast);"},
{"lineNum":"  140","line":"    }"},
{"lineNum":"  141","line":"}"},
{"lineNum":"  142","line":""},
{"lineNum":"  143","line":"fn type_is_type_type_atom(ast: *ast_.AST) bool {"},
{"lineNum":"  144","line":"    return ast.* == .identifier and std.mem.eql(u8, ast.token().data, \"Type\");"},
{"lineNum":"  145","line":"}"},
{"lineNum":"  146","line":""},
{"lineNum":"  147","line":"fn validate_trait(self: *Self, trait: *Symbol) Validate_Error_Enum!void {","class":"lineCov","hits":"2","order":"2235","possible_hits":"2",},
{"lineNum":"  148","line":"    var names = std.StringArrayHashMap(*ast_.AST).init(self.ctx.allocator());","class":"lineCov","hits":"1","order":"2236","possible_hits":"1",},
{"lineNum":"  149","line":"    defer names.deinit();","class":"linePartCov","hits":"3","order":"2262","possible_hits":"6",},
{"lineNum":"  150","line":""},
{"lineNum":"  151","line":"    for (trait.decl.?.trait.method_decls.items) |decl| {","class":"lineCov","hits":"3","order":"2237","possible_hits":"3",},
{"lineNum":"  152","line":"        if (names.get(decl.method_decl.name.token().data)) |other| {","class":"lineCov","hits":"2","order":"2238","possible_hits":"2",},
{"lineNum":"  153","line":"            self.ctx.errors.add_error(errs_.Error{ .duplicate = .{","class":"lineCov","hits":"2","order":"6369","possible_hits":"2",},
{"lineNum":"  154","line":"                .span = decl.token().span,","class":"lineCov","hits":"1","order":"6370","possible_hits":"1",},
{"lineNum":"  155","line":"                .identifier = decl.method_decl.name.token().data,","class":"lineCov","hits":"3","order":"6371","possible_hits":"3",},
{"lineNum":"  156","line":"                .first = other.token().span,","class":"lineCov","hits":"1","order":"6372","possible_hits":"1",},
{"lineNum":"  157","line":"            } });"},
{"lineNum":"  158","line":"            return error.CompileError;","class":"lineCov","hits":"1","order":"6373","possible_hits":"1",},
{"lineNum":"  159","line":"        } else {"},
{"lineNum":"  160","line":"            names.put(decl.method_decl.name.token().data, decl) catch unreachable;","class":"lineCov","hits":"3","order":"2239","possible_hits":"3",},
{"lineNum":"  161","line":"        }"},
{"lineNum":"  162","line":""},
{"lineNum":"  163","line":"        for (decl.method_decl._params.items) |param| {","class":"lineCov","hits":"4","order":"2240","possible_hits":"4",},
{"lineNum":"  164","line":"            try self.ctx.validate_type.validate_type(param.binding.type);","class":"linePartCov","hits":"2","order":"2241","possible_hits":"3",},
{"lineNum":"  165","line":"        }","class":"lineCov","hits":"3","order":"2242","possible_hits":"3",},
{"lineNum":"  166","line":"        try self.ctx.validate_type.validate_type(decl.method_decl.ret_type);","class":"linePartCov","hits":"2","order":"2243","possible_hits":"3",},
{"lineNum":"  167","line":"        try self.ctx.validate_type.validate_type(decl.method_decl.c_type.?);","class":"linePartCov","hits":"1","order":"2244","possible_hits":"2",},
{"lineNum":"  168","line":""},
{"lineNum":"  169","line":"        if (decl.method_decl.is_virtual) {","class":"lineCov","hits":"2","order":"2247","possible_hits":"2",},
{"lineNum":"  170","line":"            if (decl.method_decl.c_type.?.refers_to_self()) {","class":"lineCov","hits":"2","order":"2248","possible_hits":"2",},
{"lineNum":"  171","line":"                self.ctx.errors.add_error(errs_.Error{ .trait_virtual_refers_to_self = .{","class":"lineCov","hits":"2","order":"6576","possible_hits":"2",},
{"lineNum":"  172","line":"                    .span = decl.token().span,","class":"lineCov","hits":"1","order":"6577","possible_hits":"1",},
{"lineNum":"  173","line":"                    .method_name = decl.method_decl.name.token().data,","class":"lineCov","hits":"3","order":"6578","possible_hits":"3",},
{"lineNum":"  174","line":"                    .trait_name = trait.name,","class":"lineCov","hits":"1","order":"6579","possible_hits":"1",},
{"lineNum":"  175","line":"                } });"},
{"lineNum":"  176","line":"                return error.CompileError;","class":"lineCov","hits":"2","order":"2259","possible_hits":"2",},
{"lineNum":"  177","line":"            }"},
{"lineNum":"  178","line":"            trait.decl.?.trait.num_virtual_methods += 1;","class":"lineCov","hits":"3","order":"2260","possible_hits":"3",},
{"lineNum":"  179","line":"        }"},
{"lineNum":"  180","line":"    }","class":"lineCov","hits":"3","order":"2261","possible_hits":"3",},
{"lineNum":"  181","line":"}"},
{"lineNum":"  182","line":""},
{"lineNum":"  183","line":"fn is_capitalized(name: []const u8) bool {","class":"lineCov","hits":"2","order":"2207","possible_hits":"2",},
{"lineNum":"  184","line":"    var should_be_upper = true;","class":"lineCov","hits":"1","order":"2208","possible_hits":"1",},
{"lineNum":"  185","line":"    for (name) |c| {","class":"lineCov","hits":"3","order":"2209","possible_hits":"3",},
{"lineNum":"  186","line":"        if (should_be_upper and std.ascii.isLower(c)) {","class":"lineCov","hits":"2","order":"2210","possible_hits":"2",},
{"lineNum":"  187","line":"            return false;","class":"lineCov","hits":"1","order":"2337","possible_hits":"1",},
{"lineNum":"  188","line":"        }"},
{"lineNum":"  189","line":"        should_be_upper = c == \'_\';","class":"lineCov","hits":"1","order":"2211","possible_hits":"1",},
{"lineNum":"  190","line":"    }","class":"lineCov","hits":"3","order":"2212","possible_hits":"3",},
{"lineNum":"  191","line":"    return true;","class":"lineCov","hits":"1","order":"2213","possible_hits":"1",},
{"lineNum":"  192","line":"}"},
]};
var percent_low = 25;var percent_high = 75;
var header = { "command" : "orng-test", "date" : "2025-11-10 15:43:08", "instrumented" : 95, "covered" : 86,};
var merged_data = [];
