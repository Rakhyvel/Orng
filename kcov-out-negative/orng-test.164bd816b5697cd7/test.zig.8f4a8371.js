var data = {lines:[
{"lineNum":"    1","line":"const std = @import(\"std\");"},
{"lineNum":"    2","line":"const Compiler_Context = @import(\"hierarchy/compiler.zig\");"},
{"lineNum":"    3","line":"const Codegen_Context = @import(\"codegen/codegen.zig\");"},
{"lineNum":"    4","line":"const core_ = @import(\"hierarchy/core.zig\");"},
{"lineNum":"    5","line":"const exec = @import(\"util/exec.zig\").exec;"},
{"lineNum":"    6","line":"const module_ = @import(\"hierarchy/module.zig\");"},
{"lineNum":"    7","line":"const prelude_ = @import(\"hierarchy/prelude.zig\");"},
{"lineNum":"    8","line":"const Read_File = @import(\"lexer/read_file.zig\");"},
{"lineNum":"    9","line":"const String = @import(\"zig-string/zig-string.zig\").String;"},
{"lineNum":"   10","line":"const term_ = @import(\"util/term.zig\");"},
{"lineNum":"   11","line":""},
{"lineNum":"   12","line":"const allocator = std.heap.page_allocator;"},
{"lineNum":"   13","line":"const revert = term_.Attr{};"},
{"lineNum":"   14","line":"const succeed_color = term_.Attr{ .fg = .green, .bold = true };"},
{"lineNum":"   15","line":"const fail_color = term_.Attr{ .fg = .red, .bold = true };"},
{"lineNum":"   16","line":"const not_orng_color = term_.Attr{ .fg = .blue, .bold = true };"},
{"lineNum":"   17","line":""},
{"lineNum":"   18","line":"const Test_Mode = enum { regular, coverage, bless };"},
{"lineNum":"   19","line":"const Debug_Allocator = std.heap.DebugAllocator(.{"},
{"lineNum":"   20","line":"    .never_unmap = false,"},
{"lineNum":"   21","line":"    .safety = true,"},
{"lineNum":"   22","line":"    .retain_metadata = true,"},
{"lineNum":"   23","line":"    .verbose_log = false,"},
{"lineNum":"   24","line":"    .resize_stack_traces = true,"},
{"lineNum":"   25","line":"    .enable_memory_limit = true,"},
{"lineNum":"   26","line":"});"},
{"lineNum":"   27","line":"const Test_File_Fn = fn ([]const u8, Test_Mode, *Debug_Allocator) bool;"},
{"lineNum":"   28","line":""},
{"lineNum":"   29","line":"// This is for compatability with Windows, since stdout for Windows isn\'t known at compile-time"},
{"lineNum":"   30","line":"fn get_std_out() std.fs.File {","class":"lineCov","hits":"1","order":"17","possible_hits":"1",},
{"lineNum":"   31","line":"    return std.fs.File.stdout();","class":"lineCov","hits":"1","order":"18","possible_hits":"1",},
{"lineNum":"   32","line":"}"},
{"lineNum":"   33","line":""},
{"lineNum":"   34","line":"pub fn main() !void {","class":"lineCov","hits":"1","order":"1","possible_hits":"1",},
{"lineNum":"   35","line":"    var args = try std.process.ArgIterator.initWithAllocator(allocator);","class":"lineCov","hits":"1","order":"2","possible_hits":"1",},
{"lineNum":"   36","line":"    _ = args.next() orelse unreachable;","class":"lineCov","hits":"2","order":"3","possible_hits":"2",},
{"lineNum":"   37","line":""},
{"lineNum":"   38","line":"    _ = std.fs.cwd().realpathAlloc(allocator, \".\") catch unreachable;","class":"lineCov","hits":"2","order":"4","possible_hits":"2",},
{"lineNum":"   39","line":""},
{"lineNum":"   40","line":"    var arg: []const u8 = undefined;","class":"lineCov","hits":"1","order":"5","possible_hits":"1",},
{"lineNum":"   41","line":"    if (args.next()) |_arg| {","class":"lineCov","hits":"2","order":"6","possible_hits":"2",},
{"lineNum":"   42","line":"        arg = _arg;","class":"lineCov","hits":"1","order":"7","possible_hits":"1",},
{"lineNum":"   43","line":"        while (std.mem.eql(u8, arg, \"--\")) {","class":"lineCov","hits":"1","order":"8","possible_hits":"1",},
{"lineNum":"   44","line":"            arg = args.next().?;","class":"lineNoCov","hits":"0","possible_hits":"3",},
{"lineNum":"   45","line":"        }","class":"linePartCov","hits":"1","order":"9","possible_hits":"3",},
{"lineNum":"   46","line":"        if (std.mem.eql(u8, \"integration\", arg)) {","class":"lineCov","hits":"1","order":"10","possible_hits":"1",},
{"lineNum":"   47","line":"            try parse_args(args, .regular, integrate_test_file);","class":"lineNoCov","hits":"0","possible_hits":"2",},
{"lineNum":"   48","line":"        } else if (std.mem.eql(u8, \"coverage\", arg)) {","class":"lineCov","hits":"1","order":"11","possible_hits":"1",},
{"lineNum":"   49","line":"            try parse_args(args, .coverage, integrate_test_file);","class":"lineNoCov","hits":"0","possible_hits":"2",},
{"lineNum":"   50","line":"        } else if (std.mem.eql(u8, \"negative\", arg)) {","class":"lineCov","hits":"1","order":"12","possible_hits":"1",},
{"lineNum":"   51","line":"            try parse_args(args, .regular, negative_test_file);","class":"lineNoCov","hits":"0","possible_hits":"2",},
{"lineNum":"   52","line":"        } else if (std.mem.eql(u8, \"negative-coverage\", arg)) {","class":"lineCov","hits":"1","order":"13","possible_hits":"1",},
{"lineNum":"   53","line":"            try parse_args(args, .coverage, negative_test_file);","class":"linePartCov","hits":"1","order":"14","possible_hits":"2",},
{"lineNum":"   54","line":"        } else if (std.mem.eql(u8, \"bless\", arg)) {","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"   55","line":"            try parse_args(args, .bless, negative_test_file);","class":"lineNoCov","hits":"0","possible_hits":"2",},
{"lineNum":"   56","line":"        } else {"},
{"lineNum":"   57","line":"            std.debug.print(\"invalid command-line argument: {s}\\nusage: orng-test (integration | coverage | fuzz)\\n\", .{arg});","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"   58","line":"            return error.InvalidCliArgument;","class":"linePartCov","hits":"5","order":"6901","possible_hits":"8",},
{"lineNum":"   59","line":"        }"},
{"lineNum":"   60","line":"    }"},
{"lineNum":"   61","line":"}"},
{"lineNum":"   62","line":""},
{"lineNum":"   63","line":"/// kcov can\'t handle child processes for some reason and freezes."},
{"lineNum":"   64","line":"/// When `coverage` is false, integration testing occurs as normal, and child processes are spawned for gcc, executing the executable, etc"},
{"lineNum":"   65","line":"/// When `coverage` is true, no child processes are spawned, and no output is given."},
{"lineNum":"   66","line":"const Results = struct { passed: usize, failed: usize };"},
{"lineNum":"   67","line":"fn parse_args(old_args: std.process.ArgIterator, mode: Test_Mode, comptime test_file: Test_File_Fn) !void { // TODO: Uninfer error","class":"linePartCov","hits":"2","order":"15","possible_hits":"4",},
{"lineNum":"   68","line":"    var writer_struct = get_std_out().writer(&.{});","class":"linePartCov","hits":"1","order":"16","possible_hits":"2",},
{"lineNum":"   69","line":"    const writer = &writer_struct.interface;","class":"linePartCov","hits":"1","order":"19","possible_hits":"2",},
{"lineNum":"   70","line":"    var args = old_args;","class":"linePartCov","hits":"1","order":"20","possible_hits":"2",},
{"lineNum":"   71","line":"    if (mode == .regular) {","class":"linePartCov","hits":"1","order":"21","possible_hits":"2",},
{"lineNum":"   72","line":"        try term_.outputColor(succeed_color, \"[==============]\\n\", writer);","class":"lineNoCov","hits":"0","possible_hits":"2",},
{"lineNum":"   73","line":"    }"},
{"lineNum":"   74","line":""},
{"lineNum":"   75","line":"    var failed_tests = std.array_list.Managed([]const u8).init(std.heap.page_allocator);","class":"linePartCov","hits":"1","order":"22","possible_hits":"2",},
{"lineNum":"   76","line":"    defer failed_tests.deinit();","class":"linePartCov","hits":"1","order":"6900","possible_hits":"16",},
{"lineNum":"   77","line":""},
{"lineNum":"   78","line":"    var results = Results{ .passed = 0, .failed = 0 };","class":"linePartCov","hits":"1","order":"23","possible_hits":"2",},
{"lineNum":"   79","line":"    while (args.next()) |next| {","class":"linePartCov","hits":"2","order":"24","possible_hits":"4",},
{"lineNum":"   80","line":"        if (next.len < 4 or !std.mem.eql(u8, next[next.len - 4 ..], \"orng\")) {","class":"linePartCov","hits":"2","order":"25","possible_hits":"4",},
{"lineNum":"   81","line":"            continue;","class":"lineNoCov","hits":"0","possible_hits":"2",},
{"lineNum":"   82","line":"        }"},
{"lineNum":"   83","line":""},
{"lineNum":"   84","line":"        var debug_alloc = Debug_Allocator{};","class":"linePartCov","hits":"1","order":"26","possible_hits":"2",},
{"lineNum":"   85","line":"        const test_name = get_test_name(next) orelse continue;","class":"linePartCov","hits":"3","order":"27","possible_hits":"6",},
{"lineNum":"   86","line":"        if (mode == .regular) {","class":"linePartCov","hits":"1","order":"40","possible_hits":"2",},
{"lineNum":"   87","line":"            term_.outputColor(succeed_color, \"[ RUN      ... ] \", writer) catch unreachable;","class":"lineNoCov","hits":"0","possible_hits":"4",},
{"lineNum":"   88","line":"            writer.print(\"{s}\\n\", .{test_name}) catch unreachable;","class":"linePartCov","hits":"1","order":"41","possible_hits":"4",},
{"lineNum":"   89","line":"        }"},
{"lineNum":"   90","line":""},
{"lineNum":"   91","line":"        const res = test_file(next, mode, &debug_alloc);","class":"linePartCov","hits":"1","order":"42","possible_hits":"2",},
{"lineNum":"   92","line":""},
{"lineNum":"   93","line":"        const debug_result = debug_alloc.deinit();","class":"linePartCov","hits":"1","order":"4709","possible_hits":"2",},
{"lineNum":"   94","line":"        var memory_leak_detected: bool = undefined;","class":"linePartCov","hits":"1","order":"4710","possible_hits":"2",},
{"lineNum":"   95","line":"        if (debug_result == .leak) {","class":"linePartCov","hits":"1","order":"4711","possible_hits":"2",},
{"lineNum":"   96","line":"            writer.print(\"compiler error: memory leak!\\n\", .{}) catch unreachable;","class":"lineNoCov","hits":"0","possible_hits":"4",},
{"lineNum":"   97","line":"            memory_leak_detected = true;","class":"lineNoCov","hits":"0","possible_hits":"2",},
{"lineNum":"   98","line":"        } else {"},
{"lineNum":"   99","line":"            memory_leak_detected = false;","class":"linePartCov","hits":"1","order":"4712","possible_hits":"2",},
{"lineNum":"  100","line":"        }"},
{"lineNum":"  101","line":""},
{"lineNum":"  102","line":"        if (res and !memory_leak_detected) {","class":"linePartCov","hits":"2","order":"4713","possible_hits":"4",},
{"lineNum":"  103","line":"            results.passed += 1;","class":"lineNoCov","hits":"0","possible_hits":"4",},
{"lineNum":"  104","line":"            if (mode == .regular) {","class":"lineNoCov","hits":"0","possible_hits":"2",},
{"lineNum":"  105","line":"                term_.outputColor(succeed_color, \"[  ... PASSED  ]\\n\", writer) catch unreachable;","class":"lineNoCov","hits":"0","possible_hits":"2",},
{"lineNum":"  106","line":"            }"},
{"lineNum":"  107","line":"        } else {"},
{"lineNum":"  108","line":"            results.failed += 1;","class":"linePartCov","hits":"1","order":"4714","possible_hits":"4",},
{"lineNum":"  109","line":"            failed_tests.append(test_name) catch unreachable;","class":"linePartCov","hits":"2","order":"4715","possible_hits":"4",},
{"lineNum":"  110","line":"            if (mode == .regular) {","class":"linePartCov","hits":"1","order":"4716","possible_hits":"2",},
{"lineNum":"  111","line":"                term_.outputColor(fail_color, \"[  ... FAILED  ]\\n\", writer) catch unreachable;","class":"linePartCov","hits":"1","order":"4717","possible_hits":"2",},
{"lineNum":"  112","line":"            }"},
{"lineNum":"  113","line":"        }"},
{"lineNum":"  114","line":"    }","class":"linePartCov","hits":"3","order":"4718","possible_hits":"6",},
{"lineNum":"  115","line":""},
{"lineNum":"  116","line":"    if (mode == .regular) {","class":"linePartCov","hits":"1","order":"6898","possible_hits":"2",},
{"lineNum":"  117","line":"        try term_.outputColor(succeed_color, \"[==============]\\n\", writer);","class":"lineNoCov","hits":"0","possible_hits":"4",},
{"lineNum":"  118","line":"        try writer.print(\"Passed tests: {}\\n\", .{results.passed});","class":"lineNoCov","hits":"0","possible_hits":"4",},
{"lineNum":"  119","line":"        try writer.print(\"Failed tests: {}\\n\", .{results.failed});","class":"lineNoCov","hits":"0","possible_hits":"4",},
{"lineNum":"  120","line":""},
{"lineNum":"  121","line":"        if (results.failed > 0) {","class":"lineNoCov","hits":"0","possible_hits":"2",},
{"lineNum":"  122","line":"            try term_.outputColor(fail_color, \"[ FAILED TESTS ]\\n\", writer);","class":"lineNoCov","hits":"0","possible_hits":"4",},
{"lineNum":"  123","line":"            for (failed_tests.items) |failed_test| {","class":"lineNoCov","hits":"0","possible_hits":"6",},
{"lineNum":"  124","line":"                try writer.print(\"{s} \", .{failed_test});","class":"lineNoCov","hits":"0","possible_hits":"4",},
{"lineNum":"  125","line":"            }","class":"lineNoCov","hits":"0","possible_hits":"6",},
{"lineNum":"  126","line":"            try term_.outputColor(fail_color, \"\\n[==============]\\n\", writer);","class":"lineNoCov","hits":"0","possible_hits":"4",},
{"lineNum":"  127","line":"            return error.TestsFailed;","class":"linePartCov","hits":"1","order":"6899","possible_hits":"8",},
{"lineNum":"  128","line":"        }"},
{"lineNum":"  129","line":"    }"},
{"lineNum":"  130","line":"}"},
{"lineNum":"  131","line":""},
{"lineNum":"  132","line":"fn integrate_test_file(filename: []const u8, mode: Test_Mode, debug_alloc: *Debug_Allocator) bool {","class":"lineNoCov","hits":"0","possible_hits":"2",},
{"lineNum":"  133","line":"    // FIXME: High Cyclo"},
{"lineNum":"  134","line":"    const absolute_filename = std.fs.cwd().realpathAlloc(allocator, filename) catch unreachable;","class":"lineNoCov","hits":"0","possible_hits":"2",},
{"lineNum":"  135","line":"    var writer_struct = get_std_out().writer(&.{});","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"  136","line":"    const writer = &writer_struct.interface;","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"  137","line":""},
{"lineNum":"  138","line":"    // Try to compile Orange (make sure no errors)"},
{"lineNum":"  139","line":"    var compiler = Compiler_Context.init(if (mode != .coverage) get_std_out() else null, debug_alloc.allocator()) catch unreachable;","class":"lineNoCov","hits":"0","possible_hits":"3",},
{"lineNum":"  140","line":"    defer compiler.deinit();","class":"lineNoCov","hits":"0","possible_hits":"5",},
{"lineNum":"  141","line":"    defer prelude_.deinit();","class":"lineNoCov","hits":"0","possible_hits":"5",},
{"lineNum":"  142","line":"    defer core_.deinit();","class":"lineNoCov","hits":"0","possible_hits":"5",},
{"lineNum":"  143","line":""},
{"lineNum":"  144","line":"    const module = module_.Module.load_from_filename(absolute_filename, \"main\", false, compiler) catch {","class":"lineNoCov","hits":"0","possible_hits":"2",},
{"lineNum":"  145","line":"        if (mode == .regular) {","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"  146","line":"            writer.print(\"Orange -> C.\\n\", .{}) catch unreachable;","class":"lineNoCov","hits":"0","possible_hits":"2",},
{"lineNum":"  147","line":"        }"},
{"lineNum":"  148","line":"        return false;","class":"lineNoCov","hits":"0","possible_hits":"2",},
{"lineNum":"  149","line":"    };"},
{"lineNum":"  150","line":"    const module_symbol = compiler.lookup_module(module.absolute_path).?;","class":"lineNoCov","hits":"0","possible_hits":"3",},
{"lineNum":"  151","line":""},
{"lineNum":"  152","line":"    const package_abs_path = module.get_package_abs_path();","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"  153","line":"    compiler.register_package(package_abs_path, .executable);","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"  154","line":"    compiler.set_package_root(package_abs_path, module_symbol);","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"  155","line":"    compiler.clean_package(package_abs_path);","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"  156","line":"    compiler.lookup_package(package_abs_path).?.include_directories.put(std.fs.path.dirname(absolute_filename).?, void{}) catch unreachable;","class":"lineNoCov","hits":"0","possible_hits":"2",},
{"lineNum":"  157","line":""},
{"lineNum":"  158","line":"    compiler.propagate_include_directories(package_abs_path);","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"  159","line":"    compiler.collect_package_local_modules();","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"  160","line":"    compiler.determine_if_modified(package_abs_path);","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"  161","line":"    compiler.collect_types();","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"  162","line":""},
{"lineNum":"  163","line":"    const package = compiler.lookup_package(package_abs_path).?;","class":"lineNoCov","hits":"0","possible_hits":"3",},
{"lineNum":"  164","line":"    package.modified = true; // so that it always re-does stuff","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"  165","line":"    Codegen_Context.output_modules(compiler) catch unreachable;","class":"lineNoCov","hits":"0","possible_hits":"2",},
{"lineNum":"  166","line":""},
{"lineNum":"  167","line":"    if (mode == .coverage) {","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"  168","line":"        // kcov can\'t call gcc, so stop JUST before it calls gcc"},
{"lineNum":"  169","line":"        return false;","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"  170","line":"    }"},
{"lineNum":"  171","line":""},
{"lineNum":"  172","line":"    const contents = Read_File.init(compiler.allocator()).run(absolute_filename) catch unreachable;","class":"lineNoCov","hits":"0","possible_hits":"3",},
{"lineNum":"  173","line":"    const header_comment_contents = header_comment(contents, debug_alloc.allocator()) catch unreachable;","class":"lineNoCov","hits":"0","possible_hits":"3",},
{"lineNum":"  174","line":"    defer debug_alloc.allocator().free(header_comment_contents);","class":"lineNoCov","hits":"0","possible_hits":"3",},
{"lineNum":"  175","line":"    var expected_out = String.init_with_contents(debug_alloc.allocator(), header_comment_contents[0]) catch unreachable;","class":"lineNoCov","hits":"0","possible_hits":"3",},
{"lineNum":"  176","line":"    defer expected_out.deinit();","class":"lineNoCov","hits":"0","possible_hits":"3",},
{"lineNum":"  177","line":"    _ = expected_out.replace(\"\\r\", \"\") catch unreachable;","class":"lineNoCov","hits":"0","possible_hits":"2",},
{"lineNum":"  178","line":"    _ = expected_out.replace(\"\\n\", \"\") catch unreachable;","class":"lineNoCov","hits":"0","possible_hits":"2",},
{"lineNum":"  179","line":""},
{"lineNum":"  180","line":"    compiler.compile(package_abs_path) catch unreachable;","class":"lineNoCov","hits":"0","possible_hits":"2",},
{"lineNum":"  181","line":""},
{"lineNum":"  182","line":"    // execute (make sure no signals)"},
{"lineNum":"  183","line":"    var output_name = String.init_with_contents(allocator, \"\") catch unreachable;","class":"lineNoCov","hits":"0","possible_hits":"3",},
{"lineNum":"  184","line":"    var output_name_writer = output_name.writer(output_name.buffer.?);","class":"lineNoCov","hits":"0","possible_hits":"3",},
{"lineNum":"  185","line":"    const out_name_writer_intfc = &output_name_writer.interface;","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"  186","line":"    out_name_writer_intfc.print(\"{s}/build/{s}\", .{ package_abs_path, module.package_name }) catch unreachable;","class":"lineNoCov","hits":"0","possible_hits":"2",},
{"lineNum":"  187","line":"    const res = exec(&[_][]const u8{output_name.str()}, .Pipe) catch |e| {","class":"lineNoCov","hits":"0","possible_hits":"2",},
{"lineNum":"  188","line":"        writer.print(\"{}\\n\", .{e}) catch unreachable;","class":"lineNoCov","hits":"0","possible_hits":"2",},
{"lineNum":"  189","line":"        writer.print(\"Execution interrupted!\\n\", .{}) catch unreachable;","class":"lineNoCov","hits":"0","possible_hits":"2",},
{"lineNum":"  190","line":"        return false;","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"  191","line":"    };"},
{"lineNum":"  192","line":"    if (!std.mem.eql(u8, res.stdout, expected_out.str())) {","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"  193","line":"        writer.print(\"Expected \\\"{s}\\\" retcode, got \\\"{s}\\\"\\n\", .{ expected_out.str(), res.stdout }) catch unreachable;","class":"lineNoCov","hits":"0","possible_hits":"2",},
{"lineNum":"  194","line":"        return false;","class":"lineNoCov","hits":"0","possible_hits":"2",},
{"lineNum":"  195","line":"    }"},
{"lineNum":"  196","line":""},
{"lineNum":"  197","line":"    // Monitor stdout and capture return value, if these don\'t match expected as commented in the file, print error"},
{"lineNum":"  198","line":"    return true;","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"  199","line":"}"},
{"lineNum":"  200","line":""},
{"lineNum":"  201","line":"fn negative_test_file(filename: []const u8, mode: Test_Mode, debug_alloc: *Debug_Allocator) bool {","class":"lineCov","hits":"2","order":"43","possible_hits":"2",},
{"lineNum":"  202","line":"    // FIXME: High Cyclo"},
{"lineNum":"  203","line":"    var writer_struct = get_std_out().writer(&.{});","class":"lineCov","hits":"1","order":"44","possible_hits":"1",},
{"lineNum":"  204","line":"    const writer = &writer_struct.interface;","class":"lineCov","hits":"1","order":"45","possible_hits":"1",},
{"lineNum":"  205","line":""},
{"lineNum":"  206","line":"    const absolute_filename = std.fs.cwd().realpathAlloc(allocator, filename) catch unreachable;","class":"lineCov","hits":"2","order":"46","possible_hits":"2",},
{"lineNum":"  207","line":"    // Try to compile Orange (make sure no errors)"},
{"lineNum":"  208","line":"    var compiler = Compiler_Context.init(if (mode != .coverage) get_std_out() else null, debug_alloc.allocator()) catch unreachable;","class":"lineCov","hits":"3","order":"47","possible_hits":"3",},
{"lineNum":"  209","line":"    defer compiler.deinit();","class":"linePartCov","hits":"1","order":"4699","possible_hits":"7",},
{"lineNum":"  210","line":"    defer prelude_.deinit();","class":"linePartCov","hits":"1","order":"4696","possible_hits":"7",},
{"lineNum":"  211","line":"    defer core_.deinit();","class":"linePartCov","hits":"1","order":"4693","possible_hits":"7",},
{"lineNum":"  212","line":"    const contents = Read_File.init(compiler.allocator()).run(absolute_filename) catch unreachable;","class":"lineCov","hits":"3","order":"4302","possible_hits":"3",},
{"lineNum":"  213","line":"    const head = header_comment(contents, debug_alloc.allocator()) catch unreachable;","class":"lineCov","hits":"3","order":"4311","possible_hits":"3",},
{"lineNum":"  214","line":"    defer debug_alloc.allocator().free(head);","class":"linePartCov","hits":"1","order":"4692","possible_hits":"7",},
{"lineNum":"  215","line":"    var flat_head = flatten_header_comment(head, debug_alloc.allocator()) catch unreachable;","class":"lineCov","hits":"3","order":"4328","possible_hits":"3",},
{"lineNum":"  216","line":"    defer flat_head.deinit();","class":"linePartCov","hits":"1","order":"4691","possible_hits":"7",},
{"lineNum":"  217","line":"    const body = test_body(contents);","class":"lineCov","hits":"1","order":"4371","possible_hits":"1",},
{"lineNum":"  218","line":""},
{"lineNum":"  219","line":"    var error_string = String.init_with_contents(debug_alloc.allocator(), \"\") catch unreachable;","class":"lineCov","hits":"3","order":"4382","possible_hits":"3",},
{"lineNum":"  220","line":"    defer error_string.deinit();","class":"linePartCov","hits":"1","order":"4690","possible_hits":"7",},
{"lineNum":"  221","line":""},
{"lineNum":"  222","line":"    // Try to compile Orange (make sure YES errors)"},
{"lineNum":"  223","line":"    _ = module_.Module.load_from_filename(absolute_filename, \"main\", false, compiler) catch |err| {","class":"linePartCov","hits":"1","order":"4383","possible_hits":"2",},
{"lineNum":"  224","line":"        var error_string_writer = error_string.writer(error_string.buffer.?);","class":"lineCov","hits":"2","order":"4682","possible_hits":"2",},
{"lineNum":"  225","line":"        const error_string_writer_intfc = &error_string_writer.interface;","class":"lineCov","hits":"1","order":"4683","possible_hits":"1",},
{"lineNum":"  226","line":"        compiler.errors.print_errors(error_string_writer_intfc, .{ .print_full_path = false, .print_color = false });","class":"lineCov","hits":"1","order":"4684","possible_hits":"1",},
{"lineNum":"  227","line":"        if (mode == .bless) {","class":"lineCov","hits":"1","order":"4688","possible_hits":"1",},
{"lineNum":"  228","line":"            bless_file(filename, error_string.str(), body) catch unreachable;","class":"lineNoCov","hits":"0","possible_hits":"2",},
{"lineNum":"  229","line":"            return true;","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"  230","line":"        } else if (mode == .regular) {","class":"lineCov","hits":"1","order":"4689","possible_hits":"1",},
{"lineNum":"  231","line":"            // For windows compatability, these don\'t really matter tbh"},
{"lineNum":"  232","line":"            _ = error_string.replace(\"\\r\", \"\") catch unreachable;","class":"lineNoCov","hits":"0","possible_hits":"2",},
{"lineNum":"  233","line":"            _ = error_string.replace(\"\\n\", \"\") catch unreachable;","class":"lineNoCov","hits":"0","possible_hits":"2",},
{"lineNum":"  234","line":"            _ = flat_head.replace(\"\\r\", \"\") catch unreachable;","class":"lineNoCov","hits":"0","possible_hits":"2",},
{"lineNum":"  235","line":"            _ = flat_head.replace(\"\\n\", \"\") catch unreachable;","class":"lineNoCov","hits":"0","possible_hits":"2",},
{"lineNum":"  236","line":"            const errors_match = std.mem.eql(u8, error_string.str(), flat_head.str());","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"  237","line":"            switch (err) {","class":"lineNoCov","hits":"0","possible_hits":"2",},
{"lineNum":"  238","line":"                error.LexerError,"},
{"lineNum":"  239","line":"                error.CompileError,"},
{"lineNum":"  240","line":"                error.OutOfMemory,"},
{"lineNum":"  241","line":"                => {"},
{"lineNum":"  242","line":"                    return errors_match;","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"  243","line":"                },"},
{"lineNum":"  244","line":"                error.ParseError, error.FileNotFound => {"},
{"lineNum":"  245","line":"                    var str = String.init_with_contents(allocator, filename) catch unreachable;","class":"lineNoCov","hits":"0","possible_hits":"3",},
{"lineNum":"  246","line":"                    defer str.deinit();","class":"lineNoCov","hits":"0","possible_hits":"2",},
{"lineNum":"  247","line":"                    if (str.find(\"parser\") != null) {","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"  248","line":"                        return errors_match;","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"  249","line":"                    } else {"},
{"lineNum":"  250","line":"                        writer.print(\"Non-parser negative tests should parse!\\n\", .{}) catch unreachable;","class":"lineNoCov","hits":"0","possible_hits":"2",},
{"lineNum":"  251","line":"                        return false;","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"  252","line":"                    }"},
{"lineNum":"  253","line":"                },"},
{"lineNum":"  254","line":"            }"},
{"lineNum":"  255","line":"        } else {"},
{"lineNum":"  256","line":"            return false;","class":"lineCov","hits":"1","order":"4708","possible_hits":"1",},
{"lineNum":"  257","line":"        }"},
{"lineNum":"  258","line":"    };"},
{"lineNum":"  259","line":""},
{"lineNum":"  260","line":"    if (mode == .coverage) {","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"  261","line":"        return false;","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"  262","line":"    }"},
{"lineNum":"  263","line":""},
{"lineNum":"  264","line":"    writer.print(\"Negative test compiled without error.\\n\", .{}) catch unreachable;","class":"lineNoCov","hits":"0","possible_hits":"2",},
{"lineNum":"  265","line":"    return false;","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"  266","line":"}"},
{"lineNum":"  267","line":""},
{"lineNum":"  268","line":"fn bless_file(filename: []const u8, error_msg: []const u8, body: []const u8) !void {","class":"lineNoCov","hits":"0","possible_hits":"2",},
{"lineNum":"  269","line":"    var file = try std.fs.cwd().createFile(filename, .{});","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"  270","line":"    defer file.close();","class":"lineNoCov","hits":"0","possible_hits":"6",},
{"lineNum":"  271","line":""},
{"lineNum":"  272","line":"    var file_contents = String.init_with_contents(std.heap.page_allocator, \"\") catch unreachable;","class":"lineNoCov","hits":"0","possible_hits":"2",},
{"lineNum":"  273","line":"    defer file_contents.deinit();","class":"lineNoCov","hits":"0","possible_hits":"6",},
{"lineNum":"  274","line":""},
{"lineNum":"  275","line":"    var writer_struct = file_contents.writer(file_contents.buffer.?);","class":"lineNoCov","hits":"0","possible_hits":"3",},
{"lineNum":"  276","line":"    const writer = &writer_struct.interface;","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"  277","line":""},
{"lineNum":"  278","line":"    _ = try writer.write(\"// \");","class":"lineNoCov","hits":"0","possible_hits":"3",},
{"lineNum":"  279","line":"    for (error_msg) |c| {","class":"lineNoCov","hits":"0","possible_hits":"3",},
{"lineNum":"  280","line":"        _ = try writer.write(&[1]u8{c});","class":"lineNoCov","hits":"0","possible_hits":"3",},
{"lineNum":"  281","line":"        if (c == \'\\n\') {","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"  282","line":"            _ = try writer.write(\"// \");","class":"lineNoCov","hits":"0","possible_hits":"3",},
{"lineNum":"  283","line":"        }"},
{"lineNum":"  284","line":"    }","class":"lineNoCov","hits":"0","possible_hits":"3",},
{"lineNum":"  285","line":""},
{"lineNum":"  286","line":"    _ = try writer.write(&[1]u8{\'\\n\'});","class":"lineNoCov","hits":"0","possible_hits":"3",},
{"lineNum":"  287","line":"    _ = try writer.write(body);","class":"lineNoCov","hits":"0","possible_hits":"2",},
{"lineNum":"  288","line":""},
{"lineNum":"  289","line":"    _ = file.write(file_contents.str()) catch unreachable;","class":"lineNoCov","hits":"0","possible_hits":"2",},
{"lineNum":"  290","line":"}"},
{"lineNum":"  291","line":""},
{"lineNum":"  292","line":"// Great std lib function candidate! Holy hell..."},
{"lineNum":"  293","line":"fn index_of(str: []const u8, c: u8) ?usize {"},
{"lineNum":"  294","line":"    for (0..str.len) |i| {"},
{"lineNum":"  295","line":"        if (str[i] == c) {"},
{"lineNum":"  296","line":"            return i;"},
{"lineNum":"  297","line":"        }"},
{"lineNum":"  298","line":"    }"},
{"lineNum":"  299","line":"    return null;"},
{"lineNum":"  300","line":"}"},
{"lineNum":"  301","line":""},
{"lineNum":"  302","line":"fn last_index_of(str: []const u8, c: u8) ?usize {"},
{"lineNum":"  303","line":"    var i: usize = str.len - 1;"},
{"lineNum":"  304","line":"    while (i >= 0) : (i -= 1) {"},
{"lineNum":"  305","line":"        if (str[i] == c) {"},
{"lineNum":"  306","line":"            return i;"},
{"lineNum":"  307","line":"        }"},
{"lineNum":"  308","line":"    }"},
{"lineNum":"  309","line":"    return null;"},
{"lineNum":"  310","line":"}"},
{"lineNum":"  311","line":""},
{"lineNum":"  312","line":"fn nth_last_index_of(str: []const u8, c: u8, n: usize) ?usize {","class":"lineCov","hits":"2","order":"30","possible_hits":"2",},
{"lineNum":"  313","line":"    var i: usize = str.len - 1;","class":"lineCov","hits":"1","order":"31","possible_hits":"1",},
{"lineNum":"  314","line":"    var m = n;","class":"lineCov","hits":"1","order":"32","possible_hits":"1",},
{"lineNum":"  315","line":"    while (i >= 0) : (i -= 1) {","class":"linePartCov","hits":"1","order":"35","possible_hits":"2",},
{"lineNum":"  316","line":"        if (str[i] == c) {","class":"lineCov","hits":"2","order":"33","possible_hits":"2",},
{"lineNum":"  317","line":"            if (m == 1) {","class":"lineCov","hits":"1","order":"36","possible_hits":"1",},
{"lineNum":"  318","line":"                return i;","class":"lineCov","hits":"1","order":"37","possible_hits":"1",},
{"lineNum":"  319","line":"            } else {"},
{"lineNum":"  320","line":"                m -= 1;","class":"lineCov","hits":"2","order":"34","possible_hits":"2",},
{"lineNum":"  321","line":"            }"},
{"lineNum":"  322","line":"        }"},
{"lineNum":"  323","line":"    }"},
{"lineNum":"  324","line":"    return null;"},
{"lineNum":"  325","line":"}"},
{"lineNum":"  326","line":""},
{"lineNum":"  327","line":"fn get_test_name(filename: []const u8) ?[]const u8 {","class":"lineCov","hits":"2","order":"28","possible_hits":"2",},
{"lineNum":"  328","line":"    const slash_index = nth_last_index_of(filename, std.fs.path.sep, 2) orelse {","class":"lineCov","hits":"2","order":"29","possible_hits":"2",},
{"lineNum":"  329","line":"        std.debug.print(\"filename {s} doens\'t contain a \'/\'\", .{filename});","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"  330","line":"        return null;","class":"linePartCov","hits":"1","order":"38","possible_hits":"2",},
{"lineNum":"  331","line":"    };"},
{"lineNum":"  332","line":"    return filename[slash_index + 1 ..];","class":"linePartCov","hits":"1","order":"39","possible_hits":"2",},
{"lineNum":"  333","line":"}"},
{"lineNum":"  334","line":""},
{"lineNum":"  335","line":"/// Given the contents string, returns a slice of strings representing the content of the header comment of a file. User is responsible for deallocating the slice."},
{"lineNum":"  336","line":"fn header_comment(contents: []const u8, alloc: std.mem.Allocator) ![][]const u8 {","class":"lineCov","hits":"2","order":"4312","possible_hits":"2",},
{"lineNum":"  337","line":"    var lines = std.array_list.Managed([]const u8).init(alloc);","class":"lineCov","hits":"1","order":"4313","possible_hits":"1",},
{"lineNum":"  338","line":"    var cursor: usize = 0;","class":"lineCov","hits":"1","order":"4314","possible_hits":"1",},
{"lineNum":"  339","line":"    var next_newline = until_newline(contents);","class":"lineCov","hits":"1","order":"4315","possible_hits":"1",},
{"lineNum":"  340","line":"    var line: []const u8 = contents[cursor..next_newline];","class":"lineCov","hits":"1","order":"4320","possible_hits":"1",},
{"lineNum":"  341","line":"    while (line.len >= 3 and line[0] == \'/\' and line[1] == \'/\' and line[2] == \' \') {","class":"lineCov","hits":"2","order":"4321","possible_hits":"2",},
{"lineNum":"  342","line":"        try lines.append(line[3..]);","class":"lineCov","hits":"2","order":"4322","possible_hits":"2",},
{"lineNum":"  343","line":""},
{"lineNum":"  344","line":"        cursor = next_newline + 1;","class":"lineCov","hits":"1","order":"4323","possible_hits":"1",},
{"lineNum":"  345","line":"        next_newline += until_newline(contents[cursor..]) + 1;","class":"lineCov","hits":"1","order":"4324","possible_hits":"1",},
{"lineNum":"  346","line":"        line = contents[cursor..next_newline];","class":"lineCov","hits":"2","order":"4325","possible_hits":"2",},
{"lineNum":"  347","line":"    }","class":"lineCov","hits":"3","order":"4326","possible_hits":"3",},
{"lineNum":"  348","line":""},
{"lineNum":"  349","line":"    return lines.toOwnedSlice();","class":"lineCov","hits":"2","order":"4327","possible_hits":"2",},
{"lineNum":"  350","line":"}"},
{"lineNum":"  351","line":""},
{"lineNum":"  352","line":"fn flatten_header_comment(lines: [][]const u8, alloc: std.mem.Allocator) !String {","class":"lineCov","hits":"2","order":"4329","possible_hits":"2",},
{"lineNum":"  353","line":"    var line = String.init_with_contents(alloc, \"\") catch unreachable;","class":"lineCov","hits":"2","order":"4330","possible_hits":"2",},
{"lineNum":"  354","line":"    var line_writer = line.writer(line.buffer.?);","class":"lineCov","hits":"3","order":"4359","possible_hits":"3",},
{"lineNum":"  355","line":"    const writer = &line_writer.interface;","class":"lineCov","hits":"1","order":"4363","possible_hits":"1",},
{"lineNum":"  356","line":"    var i: usize = 0;","class":"lineCov","hits":"1","order":"4364","possible_hits":"1",},
{"lineNum":"  357","line":"    for (lines) |l| {","class":"lineCov","hits":"3","order":"4365","possible_hits":"3",},
{"lineNum":"  358","line":"        try writer.print(\"{s}\", .{l});","class":"linePartCov","hits":"1","order":"4366","possible_hits":"2",},
{"lineNum":"  359","line":"        if (i < lines.len -| 1) {","class":"lineCov","hits":"1","order":"4367","possible_hits":"1",},
{"lineNum":"  360","line":"            try writer.print(\"\\n\", .{});","class":"lineCov","hits":"1","order":"4727","possible_hits":"1",},
{"lineNum":"  361","line":"        }"},
{"lineNum":"  362","line":"        i += 1;","class":"linePartCov","hits":"1","order":"4368","possible_hits":"2",},
{"lineNum":"  363","line":"    }","class":"lineCov","hits":"3","order":"4369","possible_hits":"3",},
{"lineNum":"  364","line":"    return line;","class":"lineCov","hits":"1","order":"4370","possible_hits":"1",},
{"lineNum":"  365","line":"}"},
{"lineNum":"  366","line":""},
{"lineNum":"  367","line":"/// Retrives the content of a test file after the header comment"},
{"lineNum":"  368","line":"fn test_body(contents: []const u8) []const u8 {","class":"lineCov","hits":"2","order":"4372","possible_hits":"2",},
{"lineNum":"  369","line":"    var cursor: usize = 0;","class":"lineCov","hits":"1","order":"4373","possible_hits":"1",},
{"lineNum":"  370","line":"    var next_newline = until_newline(contents);","class":"lineCov","hits":"1","order":"4374","possible_hits":"1",},
{"lineNum":"  371","line":"    var line: []const u8 = contents[cursor..next_newline];","class":"lineCov","hits":"1","order":"4375","possible_hits":"1",},
{"lineNum":"  372","line":"    while (line.len >= 3 and line[0] == \'/\' and line[1] == \'/\' and line[2] == \' \') {","class":"lineCov","hits":"2","order":"4376","possible_hits":"2",},
{"lineNum":"  373","line":"        cursor = next_newline + 1;","class":"linePartCov","hits":"1","order":"4377","possible_hits":"2",},
{"lineNum":"  374","line":"        next_newline += until_newline(contents[cursor..]) + 1;","class":"lineCov","hits":"1","order":"4378","possible_hits":"1",},
{"lineNum":"  375","line":"        line = contents[cursor..next_newline];","class":"lineCov","hits":"2","order":"4379","possible_hits":"2",},
{"lineNum":"  376","line":"    }","class":"lineCov","hits":"3","order":"4380","possible_hits":"3",},
{"lineNum":"  377","line":"    return contents[cursor..];","class":"lineCov","hits":"2","order":"4381","possible_hits":"2",},
{"lineNum":"  378","line":"}"},
{"lineNum":"  379","line":""},
{"lineNum":"  380","line":"fn until_newline(str: []const u8) usize {","class":"lineCov","hits":"2","order":"4316","possible_hits":"2",},
{"lineNum":"  381","line":"    var i: usize = 0;","class":"lineCov","hits":"1","order":"4317","possible_hits":"1",},
{"lineNum":"  382","line":"    while (i < str.len and str[i] != \'\\n\') : (i += 1) {}","class":"lineCov","hits":"1","order":"4318","possible_hits":"1",},
{"lineNum":"  383","line":"    return i;","class":"lineCov","hits":"1","order":"4319","possible_hits":"1",},
{"lineNum":"  384","line":"}"},
]};
var percent_low = 25;var percent_high = 75;
var header = { "command" : "orng-test", "date" : "2025-11-10 15:43:08", "instrumented" : 224, "covered" : 117,};
var merged_data = [];
