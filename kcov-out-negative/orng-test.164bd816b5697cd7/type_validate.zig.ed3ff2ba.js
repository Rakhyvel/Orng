var data = {lines:[
{"lineNum":"    1","line":"//! This file contains the semantic validation logic for types."},
{"lineNum":"    2","line":"const std = @import(\"std\");"},
{"lineNum":"    3","line":"const Const_Eval = @import(\"../semantic/const_eval.zig\");"},
{"lineNum":"    4","line":"const Type_Decorate = @import(\"../ast/type_decorate.zig\");"},
{"lineNum":"    5","line":"const Compiler_Context = @import(\"../hierarchy/compiler.zig\");"},
{"lineNum":"    6","line":"const errs_ = @import(\"../util/errors.zig\");"},
{"lineNum":"    7","line":"const Type_AST = @import(\"type.zig\").Type_AST;"},
{"lineNum":"    8","line":"const Symbol = @import(\"../symbol/symbol.zig\");"},
{"lineNum":"    9","line":"const prelude_ = @import(\"../hierarchy/prelude.zig\");"},
{"lineNum":"   10","line":"const walk_ = @import(\"../ast/walker.zig\");"},
{"lineNum":"   11","line":""},
{"lineNum":"   12","line":"const Validate_Error_Enum = error{ OutOfMemory, CompileError };"},
{"lineNum":"   13","line":"const Self: type = @This();"},
{"lineNum":"   14","line":""},
{"lineNum":"   15","line":"ctx: *Compiler_Context,"},
{"lineNum":"   16","line":""},
{"lineNum":"   17","line":"pub fn init(ctx: *Compiler_Context) Self {","class":"lineCov","hits":"2","order":"107","possible_hits":"2",},
{"lineNum":"   18","line":"    return Self{ .ctx = ctx };","class":"lineCov","hits":"1","order":"108","possible_hits":"1",},
{"lineNum":"   19","line":"}"},
{"lineNum":"   20","line":""},
{"lineNum":"   21","line":"pub fn validate_type(self: *Self, @\"type\": *Type_AST) Validate_Error_Enum!void {","class":"lineCov","hits":"2","order":"2079","possible_hits":"2",},
{"lineNum":"   22","line":"    switch (@\"type\".*) {","class":"lineCov","hits":"4","order":"2080","possible_hits":"4",},
{"lineNum":"   23","line":"        .generic_apply => {"},
{"lineNum":"   24","line":"            try self.validate_type(@\"type\".lhs());","class":"linePartCov","hits":"1","order":"5383","possible_hits":"2",},
{"lineNum":"   25","line":""},
{"lineNum":"   26","line":"            const sym = @\"type\".lhs().symbol().?;","class":"lineCov","hits":"2","order":"5384","possible_hits":"2",},
{"lineNum":"   27","line":"            const params = sym.decl.?.generic_params();","class":"lineCov","hits":"3","order":"5385","possible_hits":"3",},
{"lineNum":"   28","line":"            if (params.items.len != @\"type\".children().items.len) {","class":"lineCov","hits":"1","order":"5386","possible_hits":"1",},
{"lineNum":"   29","line":"                self.ctx.errors.add_error(errs_.Error{ .mismatch_arity = .{","class":"lineNoCov","hits":"0","possible_hits":"2",},
{"lineNum":"   30","line":"                    .span = @\"type\".token().span,","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"   31","line":"                    .takes = params.items.len,","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"   32","line":"                    .given = @\"type\".children().items.len,","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"   33","line":"                    .thing_name = sym.name,","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"   34","line":"                    .takes_name = \"type parameter\","},
{"lineNum":"   35","line":"                    .given_name = \"argument\","},
{"lineNum":"   36","line":"                } });"},
{"lineNum":"   37","line":"                return error.CompileError;","class":"linePartCov","hits":"1","order":"5387","possible_hits":"2",},
{"lineNum":"   38","line":"            }"},
{"lineNum":"   39","line":""},
{"lineNum":"   40","line":"            for (@\"type\".children().items) |child| {","class":"lineCov","hits":"3","order":"5388","possible_hits":"3",},
{"lineNum":"   41","line":"                try self.validate_type(child);","class":"linePartCov","hits":"1","order":"5389","possible_hits":"2",},
{"lineNum":"   42","line":"            }","class":"lineCov","hits":"3","order":"5390","possible_hits":"3",},
{"lineNum":"   43","line":""},
{"lineNum":"   44","line":"            if (@\"type\".generic_apply.state == .unmorphed) {","class":"lineCov","hits":"2","order":"5391","possible_hits":"2",},
{"lineNum":"   45","line":"                @\"type\".generic_apply.state = .morphing;","class":"lineCov","hits":"3","order":"5392","possible_hits":"3",},
{"lineNum":"   46","line":"                @\"type\".generic_apply._symbol = try sym.monomorphize(@\"type\".generic_apply.args, self.ctx);","class":"lineCov","hits":"2","order":"5393","possible_hits":"2",},
{"lineNum":"   47","line":"                @\"type\".generic_apply.state = .morphed;","class":"lineCov","hits":"2","order":"5402","possible_hits":"2",},
{"lineNum":"   48","line":"                try self.validate_type(@\"type\".generic_apply._symbol.?.init_typedef().?);","class":"lineCov","hits":"4","order":"5403","possible_hits":"4",},
{"lineNum":"   49","line":"            }"},
{"lineNum":"   50","line":"        },"},
{"lineNum":"   51","line":""},
{"lineNum":"   52","line":"        .identifier => {"},
{"lineNum":"   53","line":"            const type_symbol = @\"type\".symbol().?;","class":"lineCov","hits":"3","order":"2084","possible_hits":"3",},
{"lineNum":"   54","line":"            if (!(type_symbol.is_type() or type_symbol.kind == .context)) {","class":"lineCov","hits":"2","order":"2085","possible_hits":"2",},
{"lineNum":"   55","line":"                self.ctx.errors.add_error(errs_.Error{ .basic = .{ .msg = \"expected a type\", .span = @\"type\".token().span } });","class":"lineCov","hits":"1","order":"6206","possible_hits":"1",},
{"lineNum":"   56","line":"                return error.CompileError;","class":"lineCov","hits":"2","order":"2086","possible_hits":"2",},
{"lineNum":"   57","line":"            }"},
{"lineNum":"   58","line":"        },"},
{"lineNum":"   59","line":""},
{"lineNum":"   60","line":"        .array_of => {"},
{"lineNum":"   61","line":"            _ = self.ctx.typecheck.typecheck_AST(@\"type\".array_of.len, prelude_.int_type) catch return error.CompileError;","class":"lineCov","hits":"2","order":"2088","possible_hits":"2",},
{"lineNum":"   62","line":"            try walk_.walk_ast(@\"type\".array_of.len, Const_Eval.new(self.ctx));","class":"lineCov","hits":"2","order":"2156","possible_hits":"2",},
{"lineNum":"   63","line":"            if (@\"type\".array_of.len.* != .int) {","class":"lineCov","hits":"2","order":"2169","possible_hits":"2",},
{"lineNum":"   64","line":"                self.ctx.errors.add_error(errs_.Error{ .basic = .{ .span = @\"type\".token().span, .msg = \"not a constant integer\" } });","class":"lineCov","hits":"1","order":"6193","possible_hits":"1",},
{"lineNum":"   65","line":"                return error.CompileError;","class":"lineCov","hits":"1","order":"6194","possible_hits":"1",},
{"lineNum":"   66","line":"            }"},
{"lineNum":"   67","line":"            try self.validate_type(@\"type\".child());","class":"linePartCov","hits":"1","order":"2170","possible_hits":"2",},
{"lineNum":"   68","line":"        },"},
{"lineNum":"   69","line":""},
{"lineNum":"   70","line":"        .untagged_sum_type => {"},
{"lineNum":"   71","line":"            if (@\"type\".child().expand_identifier().* != .enum_type) { // TODO: What if the identifier is cyclic?","class":"lineCov","hits":"1","order":"4887","possible_hits":"1",},
{"lineNum":"   72","line":"                self.ctx.errors.add_error(errs_.Error{ .basic = .{ .span = @\"type\".token().span, .msg = \"not an enum type\" } });","class":"lineCov","hits":"1","order":"6892","possible_hits":"1",},
{"lineNum":"   73","line":"                return error.CompileError;","class":"lineCov","hits":"1","order":"6893","possible_hits":"1",},
{"lineNum":"   74","line":"            }"},
{"lineNum":"   75","line":"            try self.validate_type(@\"type\".child());","class":"linePartCov","hits":"1","order":"4888","possible_hits":"2",},
{"lineNum":"   76","line":"        },"},
{"lineNum":"   77","line":""},
{"lineNum":"   78","line":"        .dyn_type => {"},
{"lineNum":"   79","line":"            if ((@\"type\".child().* != .identifier and @\"type\".child().* != .access) or @\"type\".child().symbol().?.kind != .trait) {","class":"lineCov","hits":"2","order":"2263","possible_hits":"2",},
{"lineNum":"   80","line":"                self.ctx.errors.add_error(errs_.Error{ .basic = .{ .span = @\"type\".child().token().span, .msg = \"not a trait\" } });","class":"lineCov","hits":"1","order":"6717","possible_hits":"1",},
{"lineNum":"   81","line":"                return error.CompileError;","class":"lineCov","hits":"2","order":"2264","possible_hits":"2",},
{"lineNum":"   82","line":"            }"},
{"lineNum":"   83","line":"        },"},
{"lineNum":"   84","line":""},
{"lineNum":"   85","line":"        .type_of => {"},
{"lineNum":"   86","line":"            try walk_.walk_type(@\"type\", Type_Decorate.new(self.ctx));","class":"lineCov","hits":"2","order":"4845","possible_hits":"2",},
{"lineNum":"   87","line":"        },"},
{"lineNum":"   88","line":""},
{"lineNum":"   89","line":"        .domain_of => {"},
{"lineNum":"   90","line":"            try self.validate_type(@\"type\".child());","class":"lineNoCov","hits":"0","possible_hits":"2",},
{"lineNum":"   91","line":"            try walk_.walk_type(@\"type\", Type_Decorate.new(self.ctx));","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"   92","line":"        },"},
{"lineNum":"   93","line":""},
{"lineNum":"   94","line":"        .annotation,"},
{"lineNum":"   95","line":"        .addr_of,"},
{"lineNum":"   96","line":"        .index,"},
{"lineNum":"   97","line":"        => {"},
{"lineNum":"   98","line":"            try self.validate_type(@\"type\".child());","class":"lineCov","hits":"3","order":"2081","possible_hits":"3",},
{"lineNum":"   99","line":"        },"},
{"lineNum":"  100","line":""},
{"lineNum":"  101","line":"        .function => {"},
{"lineNum":"  102","line":"            try self.validate_type(@\"type\".lhs());","class":"linePartCov","hits":"1","order":"2245","possible_hits":"2",},
{"lineNum":"  103","line":"            try self.validate_type(@\"type\".rhs());","class":"lineCov","hits":"1","order":"2246","possible_hits":"1",},
{"lineNum":"  104","line":"        },"},
{"lineNum":"  105","line":""},
{"lineNum":"  106","line":"        .enum_type,"},
{"lineNum":"  107","line":"        .struct_type,"},
{"lineNum":"  108","line":"        .tuple_type,"},
{"lineNum":"  109","line":"        => {"},
{"lineNum":"  110","line":"            for (@\"type\".children().items) |child| {","class":"lineCov","hits":"3","order":"2082","possible_hits":"3",},
{"lineNum":"  111","line":"                try self.validate_type(child);","class":"linePartCov","hits":"1","order":"2083","possible_hits":"2",},
{"lineNum":"  112","line":"            }","class":"lineCov","hits":"4","order":"2087","possible_hits":"4",},
{"lineNum":"  113","line":"        },"},
{"lineNum":"  114","line":""},
{"lineNum":"  115","line":"        else => {},"},
{"lineNum":"  116","line":"    }"},
{"lineNum":"  117","line":"}"},
{"lineNum":"  118","line":""},
{"lineNum":"  119","line":"pub fn detect_cycle(self: *Self, ty: *Type_AST, append_me: ?*Symbol) bool {","class":"lineCov","hits":"2","order":"2172","possible_hits":"2",},
{"lineNum":"  120","line":"    _ = append_me;"},
{"lineNum":"  121","line":"    var visiting = std.AutoArrayHashMap(*Type_AST, bool).init(self.ctx.allocator());","class":"lineCov","hits":"1","order":"2173","possible_hits":"1",},
{"lineNum":"  122","line":"    defer visiting.deinit();","class":"lineCov","hits":"1","order":"2198","possible_hits":"1",},
{"lineNum":"  123","line":""},
{"lineNum":"  124","line":"    var visited = std.AutoArrayHashMap(*Type_AST, bool).init(self.ctx.allocator());","class":"lineCov","hits":"1","order":"2174","possible_hits":"1",},
{"lineNum":"  125","line":"    defer visited.deinit();","class":"lineCov","hits":"1","order":"2197","possible_hits":"1",},
{"lineNum":"  126","line":""},
{"lineNum":"  127","line":"    var path = std.AutoArrayHashMap(*Symbol, bool).init(self.ctx.allocator());","class":"lineCov","hits":"1","order":"2175","possible_hits":"1",},
{"lineNum":"  128","line":"    defer path.deinit();","class":"lineCov","hits":"1","order":"2196","possible_hits":"1",},
{"lineNum":"  129","line":""},
{"lineNum":"  130","line":"    // if (append_me) |to_append| {"},
{"lineNum":"  131","line":"    // path.put(to_append, true) catch unreachable;"},
{"lineNum":"  132","line":"    // }"},
{"lineNum":"  133","line":""},
{"lineNum":"  134","line":"    return dfs(ty, &visiting, &path, &visited, false);","class":"lineCov","hits":"2","order":"2176","possible_hits":"2",},
{"lineNum":"  135","line":"}"},
{"lineNum":"  136","line":""},
{"lineNum":"  137","line":"fn dfs("},
{"lineNum":"  138","line":"    ty: *Type_AST,"},
{"lineNum":"  139","line":"    visiting: *std.AutoArrayHashMap(*Type_AST, bool),"},
{"lineNum":"  140","line":"    path: *std.AutoArrayHashMap(*Symbol, bool),"},
{"lineNum":"  141","line":"    visited: *std.AutoArrayHashMap(*Type_AST, bool),"},
{"lineNum":"  142","line":"    has_indirection: bool,"},
{"lineNum":"  143","line":") bool {","class":"lineCov","hits":"2","order":"2177","possible_hits":"2",},
{"lineNum":"  144","line":"    if (visited.contains(ty)) return false;","class":"lineCov","hits":"2","order":"2178","possible_hits":"2",},
{"lineNum":"  145","line":""},
{"lineNum":"  146","line":"    if (visiting.contains(ty) and ty.* == .identifier and ty.symbol().?.decl.?.* == .type_alias) return true; // unsafe cycle detected","class":"lineCov","hits":"2","order":"2179","possible_hits":"2",},
{"lineNum":"  147","line":"    if (visiting.contains(ty) and ty.* == .identifier) return !has_indirection; // unsafe cycle detected","class":"lineCov","hits":"2","order":"2180","possible_hits":"2",},
{"lineNum":"  148","line":""},
{"lineNum":"  149","line":"    visiting.put(ty, true) catch unreachable;","class":"lineCov","hits":"2","order":"2181","possible_hits":"2",},
{"lineNum":"  150","line":""},
{"lineNum":"  151","line":"    switch (ty.*) {","class":"lineCov","hits":"3","order":"2182","possible_hits":"3",},
{"lineNum":"  152","line":"        .identifier => if (ty.symbol()) |sym| {","class":"lineCov","hits":"2","order":"2187","possible_hits":"2",},
{"lineNum":"  153","line":"            if (path.contains(sym)) {","class":"lineCov","hits":"1","order":"2188","possible_hits":"1",},
{"lineNum":"  154","line":"                if (sym.decl.?.* == .type_alias) {","class":"lineCov","hits":"2","order":"2272","possible_hits":"2",},
{"lineNum":"  155","line":"                    return true; // invalid alias cycle","class":"linePartCov","hits":"1","order":"2273","possible_hits":"2",},
{"lineNum":"  156","line":"                }"},
{"lineNum":"  157","line":"            } else {"},
{"lineNum":"  158","line":"                path.put(sym, true) catch unreachable;","class":"lineCov","hits":"2","order":"2189","possible_hits":"2",},
{"lineNum":"  159","line":"                if (ty.symbol().?.init_typedef()) |inner| {","class":"lineCov","hits":"2","order":"2190","possible_hits":"2",},
{"lineNum":"  160","line":"                    if (dfs(inner, visiting, path, visited, has_indirection)) return true;","class":"lineCov","hits":"2","order":"2191","possible_hits":"2",},
{"lineNum":"  161","line":"                }"},
{"lineNum":"  162","line":"                _ = path.swapRemove(sym);","class":"linePartCov","hits":"4","order":"2183","possible_hits":"5",},
{"lineNum":"  163","line":"            }"},
{"lineNum":"  164","line":"        },"},
{"lineNum":"  165","line":"        .struct_type, .tuple_type, .enum_type => {"},
{"lineNum":"  166","line":"            for (ty.children().items) |child| {","class":"lineCov","hits":"3","order":"2184","possible_hits":"3",},
{"lineNum":"  167","line":"                if (dfs(child, visiting, path, visited, has_indirection)) return true;","class":"lineCov","hits":"2","order":"2185","possible_hits":"2",},
{"lineNum":"  168","line":"            }","class":"lineCov","hits":"4","order":"2195","possible_hits":"4",},
{"lineNum":"  169","line":"        },"},
{"lineNum":"  170","line":"        .array_of, .index, .addr_of, .annotation => {"},
{"lineNum":"  171","line":"            if (dfs(ty.child(), visiting, path, visited, has_indirection or ty.* == .addr_of)) return true;","class":"lineCov","hits":"2","order":"2186","possible_hits":"2",},
{"lineNum":"  172","line":"        },"},
{"lineNum":"  173","line":"        else => {},"},
{"lineNum":"  174","line":"    }"},
{"lineNum":"  175","line":""},
{"lineNum":"  176","line":"    _ = visiting.swapRemove(ty);","class":"lineCov","hits":"1","order":"2192","possible_hits":"1",},
{"lineNum":"  177","line":"    visited.put(ty, true) catch unreachable;","class":"lineCov","hits":"2","order":"2193","possible_hits":"2",},
{"lineNum":"  178","line":"    return false;","class":"lineCov","hits":"1","order":"2194","possible_hits":"1",},
{"lineNum":"  179","line":"}"},
]};
var percent_low = 25;var percent_high = 75;
var header = { "command" : "orng-test", "date" : "2025-11-10 15:43:08", "instrumented" : 77, "covered" : 70,};
var merged_data = [];
