var data = {lines:[
{"lineNum":"    1","line":"//! This file contains the definition of a Control Flow Graph (Self) data structure."},
{"lineNum":"    2","line":""},
{"lineNum":"    3","line":"const std = @import(\"std\");"},
{"lineNum":"    4","line":"const ast_ = @import(\"../ast/ast.zig\");"},
{"lineNum":"    5","line":"const alignment_ = @import(\"../util/alignment.zig\");"},
{"lineNum":"    6","line":"const Basic_Block = @import(\"../ir/basic-block.zig\");"},
{"lineNum":"    7","line":"const Instruction = @import(\"../ir/instruction.zig\");"},
{"lineNum":"    8","line":"const lval_ = @import(\"../ir/lval.zig\");"},
{"lineNum":"    9","line":"const Span = @import(\"../util/span.zig\");"},
{"lineNum":"   10","line":"const Symbol = @import(\"../symbol/symbol.zig\");"},
{"lineNum":"   11","line":"const Symbol_Version = @import(\"symbol_version.zig\");"},
{"lineNum":"   12","line":"const Type_Set = @import(\"../ast/type-set.zig\");"},
{"lineNum":"   13","line":""},
{"lineNum":"   14","line":"const Self = @This();"},
{"lineNum":"   15","line":""},
{"lineNum":"   16","line":"// bp offset of a frame\'s retval address"},
{"lineNum":"   17","line":"pub const retval_offset: i64 = -3 * @sizeOf(i64);"},
{"lineNum":"   18","line":"pub const locals_starting_offset = 8;"},
{"lineNum":"   19","line":""},
{"lineNum":"   20","line":"/// Initial basic block in the basic block graph"},
{"lineNum":"   21","line":"block_graph_head: ?*Basic_Block,"},
{"lineNum":"   22","line":""},
{"lineNum":"   23","line":"/// Flat list of all basic blocks"},
{"lineNum":"   24","line":"basic_blocks: std.array_list.Managed(*Basic_Block),"},
{"lineNum":"   25","line":""},
{"lineNum":"   26","line":"/// All other functions called by this function"},
{"lineNum":"   27","line":"children: std.AutoArrayHashMap(*Self, void),"},
{"lineNum":"   28","line":""},
{"lineNum":"   29","line":"/// All symbol versions that are parameters to the function this Self defines"},
{"lineNum":"   30","line":"/// TODO: Make this it\'s own type, in it\'s own file, with `put` and `get` methods"},
{"lineNum":"   31","line":"parameters: std.array_list.Managed(*Symbol_Version),"},
{"lineNum":"   32","line":""},
{"lineNum":"   33","line":"/// All symbol versions that are used. Should be filled in after optimizations."},
{"lineNum":"   34","line":"/// TODO: Make this it\'s own type, in it\'s own file, with `put` and `get` methods"},
{"lineNum":"   35","line":"symbvers: std.array_list.Managed(*Symbol_Version),"},
{"lineNum":"   36","line":""},
{"lineNum":"   37","line":"/// The function that this Self represents"},
{"lineNum":"   38","line":"symbol: *Symbol,"},
{"lineNum":"   39","line":""},
{"lineNum":"   40","line":"/// The symbol that is used to store the return value of this function"},
{"lineNum":"   41","line":"return_symbol: *Symbol,"},
{"lineNum":"   42","line":""},
{"lineNum":"   43","line":"/// When true, Self is called from a runtime-context at least once, and should be generated"},
{"lineNum":"   44","line":"/// Set in the lowering stage when runtime access is needed"},
{"lineNum":"   45","line":"/// TODO: Remove for LCOM4"},
{"lineNum":"   46","line":"needed_at_runtime: bool,"},
{"lineNum":"   47","line":""},
{"lineNum":"   48","line":"/// Maps a module UID to the address of the first instruction of this CFG in the module\'s list of instructions"},
{"lineNum":"   49","line":"/// Used for Instruction interpretation"},
{"lineNum":"   50","line":"/// TODO: Remove for LCOM4"},
{"lineNum":"   51","line":"offset_table: std.array_hash_map.AutoArrayHashMap(u32, Instruction.Index),"},
{"lineNum":"   52","line":""},
{"lineNum":"   53","line":"/// Number of bytes required in order to store the local variables of the function"},
{"lineNum":"   54","line":"/// TODO: Remove for LCOM4"},
{"lineNum":"   55","line":"locals_size: ?i64,"},
{"lineNum":"   56","line":""},
{"lineNum":"   57","line":"allocator: std.mem.Allocator,"},
{"lineNum":"   58","line":""},
{"lineNum":"   59","line":"/// Initializes a Self"},
{"lineNum":"   60","line":"pub fn init(symbol: *Symbol, allocator: std.mem.Allocator) *Self {","class":"lineCov","hits":"2","order":"2463","possible_hits":"2",},
{"lineNum":"   61","line":"    if (symbol.cfg) |cfg| {","class":"linePartCov","hits":"1","order":"2464","possible_hits":"2",},
{"lineNum":"   62","line":"        return cfg;","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"   63","line":"    }"},
{"lineNum":"   64","line":"    var retval = allocator.create(Self) catch unreachable;","class":"lineCov","hits":"3","order":"2465","possible_hits":"3",},
{"lineNum":"   65","line":"    retval.block_graph_head = null;","class":"lineCov","hits":"1","order":"2466","possible_hits":"1",},
{"lineNum":"   66","line":"    retval.basic_blocks = std.array_list.Managed(*Basic_Block).init(allocator);","class":"lineCov","hits":"1","order":"2467","possible_hits":"1",},
{"lineNum":"   67","line":"    retval.children = std.AutoArrayHashMap(*Self, void).init(allocator);","class":"lineCov","hits":"1","order":"2468","possible_hits":"1",},
{"lineNum":"   68","line":"    retval.symbvers = std.array_list.Managed(*Symbol_Version).init(allocator);","class":"lineCov","hits":"1","order":"2469","possible_hits":"1",},
{"lineNum":"   69","line":"    retval.parameters = std.array_list.Managed(*Symbol_Version).init(allocator);","class":"lineCov","hits":"1","order":"2470","possible_hits":"1",},
{"lineNum":"   70","line":"    retval.symbol = symbol;","class":"lineCov","hits":"1","order":"2471","possible_hits":"1",},
{"lineNum":"   71","line":"    retval.return_symbol = Symbol.init(","class":"lineCov","hits":"2","order":"2472","possible_hits":"2",},
{"lineNum":"   72","line":"        symbol.scope,","class":"lineCov","hits":"1","order":"2473","possible_hits":"1",},
{"lineNum":"   73","line":"        \"_retval\","},
{"lineNum":"   74","line":"        ast_.AST.create_decl(","class":"lineCov","hits":"1","order":"2477","possible_hits":"1",},
{"lineNum":"   75","line":"            symbol.decl.?.token(),","class":"lineCov","hits":"3","order":"2474","possible_hits":"3",},
{"lineNum":"   76","line":"            ast_.AST.create_pattern_symbol(symbol.decl.?.token(), .mut, .local, \"_retval\", allocator),","class":"lineCov","hits":"3","order":"2475","possible_hits":"3",},
{"lineNum":"   77","line":"            symbol.type().rhs(),","class":"lineCov","hits":"1","order":"2476","possible_hits":"1",},
{"lineNum":"   78","line":"            null,"},
{"lineNum":"   79","line":"            allocator,"},
{"lineNum":"   80","line":"        ),"},
{"lineNum":"   81","line":"        .mut,"},
{"lineNum":"   82","line":"        .local,"},
{"lineNum":"   83","line":"        allocator,"},
{"lineNum":"   84","line":"    );"},
{"lineNum":"   85","line":"    _ = retval.return_symbol.type().expand_identifier();","class":"lineCov","hits":"1","order":"2478","possible_hits":"1",},
{"lineNum":"   86","line":"    _ = symbol.type().expand_identifier();","class":"lineCov","hits":"1","order":"2479","possible_hits":"1",},
{"lineNum":"   87","line":"    retval.needed_at_runtime = false;","class":"lineCov","hits":"1","order":"2480","possible_hits":"1",},
{"lineNum":"   88","line":"    retval.offset_table = std.array_hash_map.AutoArrayHashMap(u32, Instruction.Index).init(allocator);","class":"lineCov","hits":"1","order":"2481","possible_hits":"1",},
{"lineNum":"   89","line":"    retval.locals_size = null;","class":"lineCov","hits":"1","order":"2482","possible_hits":"1",},
{"lineNum":"   90","line":"    retval.allocator = allocator;","class":"lineCov","hits":"1","order":"2483","possible_hits":"1",},
{"lineNum":"   91","line":"    symbol.cfg = retval;","class":"lineCov","hits":"1","order":"2484","possible_hits":"1",},
{"lineNum":"   92","line":""},
{"lineNum":"   93","line":"    return retval;","class":"lineCov","hits":"1","order":"2485","possible_hits":"1",},
{"lineNum":"   94","line":"}"},
{"lineNum":"   95","line":""},
{"lineNum":"   96","line":"/// Deinitializes a Self"},
{"lineNum":"   97","line":"pub fn deinit(self: *Self) void {","class":"lineCov","hits":"2","order":"3190","possible_hits":"2",},
{"lineNum":"   98","line":"    for (self.basic_blocks.items) |bb| {","class":"lineCov","hits":"3","order":"3191","possible_hits":"3",},
{"lineNum":"   99","line":"        bb.deinit();","class":"lineCov","hits":"1","order":"3192","possible_hits":"1",},
{"lineNum":"  100","line":"    }","class":"lineCov","hits":"3","order":"3212","possible_hits":"3",},
{"lineNum":"  101","line":"    self.basic_blocks.deinit();","class":"lineCov","hits":"1","order":"3213","possible_hits":"1",},
{"lineNum":"  102","line":""},
{"lineNum":"  103","line":"    self.symbvers.deinit();","class":"lineCov","hits":"1","order":"3214","possible_hits":"1",},
{"lineNum":"  104","line":""},
{"lineNum":"  105","line":"    for (self.parameters.items) |param| {","class":"linePartCov","hits":"2","order":"3215","possible_hits":"3",},
{"lineNum":"  106","line":"        param.deinit();","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"  107","line":"    }","class":"linePartCov","hits":"1","order":"3216","possible_hits":"3",},
{"lineNum":"  108","line":"    self.parameters.deinit();","class":"lineCov","hits":"1","order":"3217","possible_hits":"1",},
{"lineNum":"  109","line":""},
{"lineNum":"  110","line":"    self.allocator.destroy(self);","class":"lineCov","hits":"1","order":"3218","possible_hits":"1",},
{"lineNum":"  111","line":"}"},
{"lineNum":"  112","line":""},
{"lineNum":"  113","line":"pub fn assert_needed_at_runtime(self: *Self) void {","class":"lineCov","hits":"2","order":"3690","possible_hits":"2",},
{"lineNum":"  114","line":"    if (self.needed_at_runtime) {","class":"lineCov","hits":"1","order":"3691","possible_hits":"1",},
{"lineNum":"  115","line":"        return;","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"  116","line":"    }"},
{"lineNum":"  117","line":"    self.needed_at_runtime = true;","class":"lineCov","hits":"1","order":"3692","possible_hits":"1",},
{"lineNum":"  118","line":""},
{"lineNum":"  119","line":"    for (self.children.keys()) |child| {","class":"linePartCov","hits":"2","order":"3693","possible_hits":"3",},
{"lineNum":"  120","line":"        child.assert_needed_at_runtime();","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"  121","line":"    }","class":"linePartCov","hits":"2","order":"3694","possible_hits":"4",},
{"lineNum":"  122","line":"}"},
{"lineNum":"  123","line":""},
{"lineNum":"  124","line":"/// Sets the `visited` flag for all basic-blocks in this Self to false."},
{"lineNum":"  125","line":"///"},
{"lineNum":"  126","line":"/// BBs aren\'t trees, so `defer self.visited = false` won\'t work"},
{"lineNum":"  127","line":"/// Use this function instead"},
{"lineNum":"  128","line":"pub fn clear_visited_BBs(self: *Self) void {","class":"lineCov","hits":"2","order":"2919","possible_hits":"2",},
{"lineNum":"  129","line":"    for (self.basic_blocks.items) |bb| {","class":"lineCov","hits":"3","order":"2920","possible_hits":"3",},
{"lineNum":"  130","line":"        bb.visited = false;","class":"lineCov","hits":"1","order":"2921","possible_hits":"1",},
{"lineNum":"  131","line":"    }","class":"lineCov","hits":"4","order":"2922","possible_hits":"4",},
{"lineNum":"  132","line":"}"},
{"lineNum":"  133","line":""},
{"lineNum":"  134","line":"/// Fills in a the `symbvers` list with the symbol versions which are used in the Self"},
{"lineNum":"  135","line":"pub fn collect_generated_symbvers(self: *Self) void {","class":"lineCov","hits":"2","order":"2965","possible_hits":"2",},
{"lineNum":"  136","line":"    for (self.basic_blocks.items) |bb| {","class":"lineCov","hits":"3","order":"2966","possible_hits":"3",},
{"lineNum":"  137","line":"        for (bb.instructions.items) |instr| {","class":"lineCov","hits":"3","order":"2967","possible_hits":"3",},
{"lineNum":"  138","line":"            if (instr.dest != null and","class":"lineCov","hits":"1","order":"2968","possible_hits":"1",},
{"lineNum":"  139","line":"                instr.dest.?.extract_symbver().find_symbol_version_set(&self.parameters) == null)","class":"lineCov","hits":"3","order":"2969","possible_hits":"3",},
{"lineNum":"  140","line":"            {"},
{"lineNum":"  141","line":"                _ = instr.dest.?.extract_symbver().put_symbol_version_set(&self.symbvers);","class":"lineCov","hits":"2","order":"2974","possible_hits":"2",},
{"lineNum":"  142","line":"            }"},
{"lineNum":"  143","line":"        }","class":"lineCov","hits":"3","order":"2980","possible_hits":"3",},
{"lineNum":"  144","line":"    }","class":"lineCov","hits":"4","order":"2982","possible_hits":"4",},
{"lineNum":"  145","line":"}"},
{"lineNum":"  146","line":""},
{"lineNum":"  147","line":"pub fn collect_cfg_types(self: *Self, type_set: *Type_Set) void {","class":"lineCov","hits":"2","order":"4204","possible_hits":"2",},
{"lineNum":"  148","line":"    // Don\'t collect types from generic CFGs"},
{"lineNum":"  149","line":"    if (self.symbol.decl.?.* == .fn_decl and self.symbol.decl.?.num_generic_params() > 0) {","class":"lineCov","hits":"2","order":"4205","possible_hits":"2",},
{"lineNum":"  150","line":"        return;","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"  151","line":"    }"},
{"lineNum":"  152","line":"    if (self.symbol.decl.?.* == .method_decl and self.symbol.decl.?.method_decl.impl.?.num_generic_params() > 0) {","class":"lineCov","hits":"2","order":"4206","possible_hits":"2",},
{"lineNum":"  153","line":"        return;","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"  154","line":"    }"},
{"lineNum":"  155","line":""},
{"lineNum":"  156","line":"    // Add parameter types to type set"},
{"lineNum":"  157","line":"    const decl = self.symbol.decl.?;","class":"lineCov","hits":"3","order":"4207","possible_hits":"3",},
{"lineNum":"  158","line":"    const param_symbols = decl.param_symbols();","class":"lineCov","hits":"1","order":"4208","possible_hits":"1",},
{"lineNum":"  159","line":"    if (param_symbols != null) {","class":"lineCov","hits":"2","order":"4209","possible_hits":"2",},
{"lineNum":"  160","line":"        for (param_symbols.?.items) |param| {","class":"lineCov","hits":"4","order":"4210","possible_hits":"4",},
{"lineNum":"  161","line":"            _ = type_set.add_type(param.expanded_type());","class":"lineCov","hits":"1","order":"4211","possible_hits":"1",},
{"lineNum":"  162","line":"        }","class":"linePartCov","hits":"4","order":"4212","possible_hits":"5",},
{"lineNum":"  163","line":"    }"},
{"lineNum":"  164","line":"    const context_param_symbols = decl.context_param_symbols();","class":"lineCov","hits":"1","order":"4213","possible_hits":"1",},
{"lineNum":"  165","line":"    if (context_param_symbols != null) {","class":"lineCov","hits":"2","order":"4217","possible_hits":"2",},
{"lineNum":"  166","line":"        for (context_param_symbols.?.items) |context_param| {","class":"linePartCov","hits":"3","order":"4218","possible_hits":"4",},
{"lineNum":"  167","line":"            _ = type_set.add_type(context_param.expanded_type());","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"  168","line":"        }","class":"linePartCov","hits":"2","order":"4219","possible_hits":"5",},
{"lineNum":"  169","line":"    }"},
{"lineNum":"  170","line":"    _ = type_set.add_type(self.return_symbol.expanded_type());","class":"lineCov","hits":"1","order":"4220","possible_hits":"1",},
{"lineNum":"  171","line":""},
{"lineNum":"  172","line":"    // For all basic blocks in the cfg..."},
{"lineNum":"  173","line":"    for (self.basic_blocks.items) |bb| {","class":"lineCov","hits":"3","order":"4229","possible_hits":"3",},
{"lineNum":"  174","line":"        bb.collect_basic_block_types(type_set);","class":"lineCov","hits":"1","order":"4230","possible_hits":"1",},
{"lineNum":"  175","line":"    }","class":"lineCov","hits":"4","order":"4237","possible_hits":"4",},
{"lineNum":"  176","line":"}"},
{"lineNum":"  177","line":""},
{"lineNum":"  178","line":"/// Converts the list of Instruction to a web of BB\'s"},
{"lineNum":"  179","line":"///"},
{"lineNum":"  180","line":"/// ### Parameters"},
{"lineNum":"  181","line":"/// - `self`: The CFG to fill the basic blocks for"},
{"lineNum":"  182","line":"/// - `instructions`: The list of instructions to convert to basic blocks"},
{"lineNum":"  183","line":"/// - `start_index`: The index into the instructions list to start the basic block at"},
{"lineNum":"  184","line":"/// - `allocator`: The allocator to use for the basic blocks"},
{"lineNum":"  185","line":"pub fn basic_block_from_instructions(self: *Self, instructions: std.array_list.Managed(*Instruction), start_index: ?usize) ?*Basic_Block {","class":"lineCov","hits":"2","order":"2594","possible_hits":"2",},
{"lineNum":"  186","line":"    if (instructions.items.len == 0 or start_index == null) {","class":"lineCov","hits":"2","order":"2595","possible_hits":"2",},
{"lineNum":"  187","line":"        return null;","class":"lineCov","hits":"1","order":"2625","possible_hits":"1",},
{"lineNum":"  188","line":"    } else if (instructions.items[start_index.?].in_block) |in_block| {","class":"lineCov","hits":"2","order":"2596","possible_hits":"2",},
{"lineNum":"  189","line":"        return in_block;","class":"lineCov","hits":"2","order":"2597","possible_hits":"2",},
{"lineNum":"  190","line":"    }"},
{"lineNum":"  191","line":""},
{"lineNum":"  192","line":"    // Create block without instructions yet"},
{"lineNum":"  193","line":"    var block = Basic_Block.init(self.allocator);","class":"lineCov","hits":"1","order":"2598","possible_hits":"1",},
{"lineNum":"  194","line":"    self.basic_blocks.append(block) catch unreachable;","class":"lineCov","hits":"2","order":"2610","possible_hits":"2",},
{"lineNum":"  195","line":""},
{"lineNum":"  196","line":"    // Identify the end of the block"},
{"lineNum":"  197","line":"    var end_index: usize = start_index.?;","class":"lineCov","hits":"2","order":"2611","possible_hits":"2",},
{"lineNum":"  198","line":"    while (end_index < instructions.items.len) {","class":"lineCov","hits":"1","order":"2612","possible_hits":"1",},
{"lineNum":"  199","line":"        const instr = instructions.items[end_index];","class":"lineCov","hits":"3","order":"2613","possible_hits":"3",},
{"lineNum":"  200","line":"        end_index += 1;","class":"linePartCov","hits":"1","order":"2614","possible_hits":"2",},
{"lineNum":"  201","line":"        instr.in_block = block;","class":"lineCov","hits":"1","order":"2615","possible_hits":"1",},
{"lineNum":"  202","line":"        if (instr.kind == .label) {","class":"lineCov","hits":"1","order":"2616","possible_hits":"1",},
{"lineNum":"  203","line":"            // Fallthrough to next basic block"},
{"lineNum":"  204","line":"            const next_block = self.basic_block_from_instructions(instructions, end_index);","class":"lineCov","hits":"1","order":"3981","possible_hits":"1",},
{"lineNum":"  205","line":"            block.terminator = .{ .unconditional = next_block };","class":"lineCov","hits":"1","order":"3986","possible_hits":"1",},
{"lineNum":"  206","line":"            break;","class":"lineCov","hits":"1","order":"3987","possible_hits":"1",},
{"lineNum":"  207","line":"        } else if (instr.kind == .jump) {","class":"lineCov","hits":"1","order":"2617","possible_hits":"1",},
{"lineNum":"  208","line":"            // Unconditional jump to other block"},
{"lineNum":"  209","line":"            const branch_next = instr.data.branch;","class":"lineCov","hits":"3","order":"2622","possible_hits":"3",},
{"lineNum":"  210","line":"            const bb_index = if (branch_next != null) std.mem.indexOfScalar(*Instruction, instructions.items, branch_next.?).? + 1 else null;","class":"lineCov","hits":"2","order":"2623","possible_hits":"2",},
{"lineNum":"  211","line":"            const next_block = self.basic_block_from_instructions(instructions, bb_index);","class":"lineCov","hits":"1","order":"2624","possible_hits":"1",},
{"lineNum":"  212","line":"            block.terminator = .{ .unconditional = next_block };","class":"lineCov","hits":"1","order":"2626","possible_hits":"1",},
{"lineNum":"  213","line":"            break;","class":"lineCov","hits":"1","order":"2627","possible_hits":"1",},
{"lineNum":"  214","line":"        } else if (instr.kind == .panic) {","class":"lineCov","hits":"1","order":"2618","possible_hits":"1",},
{"lineNum":"  215","line":"            // Block ends in a panic"},
{"lineNum":"  216","line":"            end_index += 1; // panics are kept as an instruction because they store the error message","class":"linePartCov","hits":"1","order":"3762","possible_hits":"2",},
{"lineNum":"  217","line":"            block.terminator = .panic;","class":"lineCov","hits":"1","order":"3763","possible_hits":"1",},
{"lineNum":"  218","line":"            break;","class":"lineCov","hits":"1","order":"3764","possible_hits":"1",},
{"lineNum":"  219","line":"        } else if (instr.kind == .branch_if_false) {","class":"lineCov","hits":"1","order":"2619","possible_hits":"1",},
{"lineNum":"  220","line":"            // Branch only if condition is false else fallthrough"},
{"lineNum":"  221","line":"            const branch_next = instr.data.branch;","class":"lineCov","hits":"3","order":"3982","possible_hits":"3",},
{"lineNum":"  222","line":"            const false_target_index = if (branch_next != null) std.mem.indexOfScalar(*Instruction, instructions.items, branch_next.?).? + 1 else null;","class":"lineCov","hits":"2","order":"3983","possible_hits":"2",},
{"lineNum":"  223","line":"            const next_block = self.basic_block_from_instructions(instructions, end_index);","class":"lineCov","hits":"1","order":"3984","possible_hits":"1",},
{"lineNum":"  224","line":"            const branch_block = self.basic_block_from_instructions(instructions, false_target_index);","class":"lineCov","hits":"1","order":"3985","possible_hits":"1",},
{"lineNum":"  225","line":"            block.terminator = .{ .conditional = .{","class":"lineCov","hits":"1","order":"3988","possible_hits":"1",},
{"lineNum":"  226","line":"                .condition = instr.src1.?,","class":"lineCov","hits":"3","order":"3989","possible_hits":"3",},
{"lineNum":"  227","line":"                .true_target = next_block,"},
{"lineNum":"  228","line":"                .false_target = branch_block,"},
{"lineNum":"  229","line":"            } };"},
{"lineNum":"  230","line":"            break;","class":"lineCov","hits":"5","order":"2620","possible_hits":"5",},
{"lineNum":"  231","line":"        }"},
{"lineNum":"  232","line":"    }","class":"linePartCov","hits":"2","order":"2621","possible_hits":"3",},
{"lineNum":"  233","line":""},
{"lineNum":"  234","line":"    // Assign instructions to the block"},
{"lineNum":"  235","line":"    block.instructions.appendSlice(instructions.items[start_index.? .. end_index - 1]) catch unreachable;","class":"lineCov","hits":"2","order":"2628","possible_hits":"2",},
{"lineNum":"  236","line":""},
{"lineNum":"  237","line":"    return block;","class":"lineCov","hits":"1","order":"2629","possible_hits":"1",},
{"lineNum":"  238","line":"}"},
{"lineNum":"  239","line":""},
{"lineNum":"  240","line":"pub fn calculate_usage(self: *Self) void {","class":"lineCov","hits":"2","order":"2634","possible_hits":"2",},
{"lineNum":"  241","line":"    // FIXME: High Cyclo"},
{"lineNum":"  242","line":"    if (self.symbol.decl.?.* == .fn_decl or self.symbol.decl.?.* == .method_decl) {","class":"lineCov","hits":"2","order":"2635","possible_hits":"2",},
{"lineNum":"  243","line":"        const param_symbols = self.symbol.decl.?.param_symbols();","class":"lineCov","hits":"3","order":"3644","possible_hits":"3",},
{"lineNum":"  244","line":"        if (param_symbols != null) {","class":"lineCov","hits":"2","order":"3645","possible_hits":"2",},
{"lineNum":"  245","line":"            for (param_symbols.?.items) |param_symbol| {","class":"lineCov","hits":"4","order":"3646","possible_hits":"4",},
{"lineNum":"  246","line":"                param_symbol.uses = 0;","class":"lineCov","hits":"1","order":"3647","possible_hits":"1",},
{"lineNum":"  247","line":"            }","class":"linePartCov","hits":"7","order":"2636","possible_hits":"8",},
{"lineNum":"  248","line":"        }"},
{"lineNum":"  249","line":"    }"},
{"lineNum":"  250","line":""},
{"lineNum":"  251","line":"    for (self.basic_blocks.items) |bb| {","class":"lineCov","hits":"3","order":"2637","possible_hits":"3",},
{"lineNum":"  252","line":"        // Clear all used flags"},
{"lineNum":"  253","line":"        for (bb.instructions.items) |instr| {","class":"lineCov","hits":"3","order":"2638","possible_hits":"3",},
{"lineNum":"  254","line":"            if (instr.dest != null) {","class":"lineCov","hits":"1","order":"2639","possible_hits":"1",},
{"lineNum":"  255","line":"                instr.dest.?.reset_usage();","class":"lineCov","hits":"2","order":"2640","possible_hits":"2",},
{"lineNum":"  256","line":"            }"},
{"lineNum":"  257","line":"        }","class":"lineCov","hits":"3","order":"2645","possible_hits":"3",},
{"lineNum":"  258","line":"    }","class":"lineCov","hits":"4","order":"2646","possible_hits":"4",},
{"lineNum":"  259","line":""},
{"lineNum":"  260","line":"    for (self.basic_blocks.items) |bb| {","class":"lineCov","hits":"3","order":"2647","possible_hits":"3",},
{"lineNum":"  261","line":"        // Go through and see if each symbol is used"},
{"lineNum":"  262","line":"        for (bb.instructions.items) |instr| {","class":"lineCov","hits":"3","order":"2648","possible_hits":"3",},
{"lineNum":"  263","line":"            if (instr.dest != null and instr.dest.?.* != .symbver) {","class":"lineCov","hits":"2","order":"2649","possible_hits":"2",},
{"lineNum":"  264","line":"                instr.dest.?.increment_usage();","class":"lineCov","hits":"2","order":"2650","possible_hits":"2",},
{"lineNum":"  265","line":"            }"},
{"lineNum":"  266","line":"            if (instr.src1 != null) {","class":"lineCov","hits":"1","order":"2651","possible_hits":"1",},
{"lineNum":"  267","line":"                instr.src1.?.increment_usage();","class":"lineCov","hits":"2","order":"2652","possible_hits":"2",},
{"lineNum":"  268","line":"            }"},
{"lineNum":"  269","line":"            if (instr.src2 != null) {","class":"lineCov","hits":"1","order":"2653","possible_hits":"1",},
{"lineNum":"  270","line":"                instr.src2.?.increment_usage();","class":"lineCov","hits":"2","order":"2654","possible_hits":"2",},
{"lineNum":"  271","line":"            }"},
{"lineNum":"  272","line":"            if (instr.data == .lval_list) {","class":"lineCov","hits":"2","order":"2655","possible_hits":"2",},
{"lineNum":"  273","line":"                for (instr.data.lval_list.items) |lval| {","class":"lineCov","hits":"4","order":"2662","possible_hits":"4",},
{"lineNum":"  274","line":"                    lval.increment_usage();","class":"lineCov","hits":"1","order":"2663","possible_hits":"1",},
{"lineNum":"  275","line":"                }","class":"lineCov","hits":"5","order":"2656","possible_hits":"5",},
{"lineNum":"  276","line":"            }"},
{"lineNum":"  277","line":"            if (instr.data == .call) {","class":"lineCov","hits":"2","order":"2657","possible_hits":"2",},
{"lineNum":"  278","line":"                for (instr.data.call.arg_lval_list.items) |lval| {","class":"lineCov","hits":"4","order":"4560","possible_hits":"4",},
{"lineNum":"  279","line":"                    lval.increment_usage();","class":"lineCov","hits":"1","order":"4561","possible_hits":"1",},
{"lineNum":"  280","line":"                }","class":"lineCov","hits":"4","order":"4562","possible_hits":"4",},
{"lineNum":"  281","line":"                for (instr.data.call.context_arg_lval_list.items) |lval| {","class":"linePartCov","hits":"3","order":"4563","possible_hits":"4",},
{"lineNum":"  282","line":"                    lval.increment_usage();","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"  283","line":"                }","class":"linePartCov","hits":"3","order":"2658","possible_hits":"5",},
{"lineNum":"  284","line":"            }"},
{"lineNum":"  285","line":"            if (instr.data == .invoke) {","class":"lineCov","hits":"1","order":"2659","possible_hits":"1",},
{"lineNum":"  286","line":"                if (instr.data.invoke.dyn_value != null) {","class":"lineCov","hits":"2","order":"6312","possible_hits":"2",},
{"lineNum":"  287","line":"                    instr.data.invoke.dyn_value.?.increment_usage();","class":"lineCov","hits":"2","order":"6313","possible_hits":"2",},
{"lineNum":"  288","line":"                }"},
{"lineNum":"  289","line":"                if (instr.data.invoke.method_decl_lval != null and !instr.data.invoke.method_decl.method_decl.is_virtual) {","class":"lineCov","hits":"2","order":"6314","possible_hits":"2",},
{"lineNum":"  290","line":"                    instr.data.invoke.method_decl_lval.?.increment_usage();","class":"lineCov","hits":"3","order":"6315","possible_hits":"3",},
{"lineNum":"  291","line":"                }"},
{"lineNum":"  292","line":"                for (instr.data.invoke.arg_lval_list.items) |lval| {","class":"lineCov","hits":"4","order":"6316","possible_hits":"4",},
{"lineNum":"  293","line":"                    lval.increment_usage();","class":"lineCov","hits":"1","order":"6317","possible_hits":"1",},
{"lineNum":"  294","line":"                }","class":"lineCov","hits":"4","order":"6318","possible_hits":"4",},
{"lineNum":"  295","line":"                for (instr.data.invoke.context_arg_lval_list.items) |lval| {","class":"linePartCov","hits":"3","order":"6319","possible_hits":"4",},
{"lineNum":"  296","line":"                    lval.increment_usage();","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"  297","line":"                }","class":"linePartCov","hits":"3","order":"2660","possible_hits":"5",},
{"lineNum":"  298","line":"            }"},
{"lineNum":"  299","line":"        }","class":"lineCov","hits":"3","order":"2661","possible_hits":"3",},
{"lineNum":"  300","line":""},
{"lineNum":"  301","line":"        // Conditions are used"},
{"lineNum":"  302","line":"        if (bb.terminator == .conditional) {","class":"lineCov","hits":"1","order":"2668","possible_hits":"1",},
{"lineNum":"  303","line":"            bb.terminator.conditional.condition.extract_symbver().uses += 1;","class":"lineCov","hits":"2","order":"3990","possible_hits":"2",},
{"lineNum":"  304","line":"            bb.terminator.conditional.condition.extract_symbver().symbol.uses += 1;","class":"lineCov","hits":"2","order":"2669","possible_hits":"2",},
{"lineNum":"  305","line":"        }"},
{"lineNum":"  306","line":"    }","class":"lineCov","hits":"4","order":"2670","possible_hits":"4",},
{"lineNum":"  307","line":"}"},
{"lineNum":"  308","line":""},
{"lineNum":"  309","line":"pub fn calculate_definitions(self: *Self) void {","class":"lineCov","hits":"2","order":"2672","possible_hits":"2",},
{"lineNum":"  310","line":"    // FIXME: High Cyclo"},
{"lineNum":"  311","line":"    for (self.basic_blocks.items) |bb| {","class":"lineCov","hits":"3","order":"2673","possible_hits":"3",},
{"lineNum":"  312","line":"        // Reset all reachable symbol verison counts to 0"},
{"lineNum":"  313","line":"        for (bb.instructions.items) |instr| {","class":"lineCov","hits":"3","order":"2674","possible_hits":"3",},
{"lineNum":"  314","line":"            reset_defs(instr.dest);","class":"lineCov","hits":"1","order":"2675","possible_hits":"1",},
{"lineNum":"  315","line":"            reset_defs(instr.src1);","class":"lineCov","hits":"1","order":"2680","possible_hits":"1",},
{"lineNum":"  316","line":"            reset_defs(instr.src2);","class":"lineCov","hits":"1","order":"2682","possible_hits":"1",},
{"lineNum":"  317","line":"            if (instr.data == .lval_list) {","class":"lineCov","hits":"2","order":"2683","possible_hits":"2",},
{"lineNum":"  318","line":"                for (instr.data.lval_list.items) |lval| {","class":"lineCov","hits":"4","order":"2690","possible_hits":"4",},
{"lineNum":"  319","line":"                    reset_defs(lval);","class":"lineCov","hits":"1","order":"2691","possible_hits":"1",},
{"lineNum":"  320","line":"                }","class":"lineCov","hits":"5","order":"2684","possible_hits":"5",},
{"lineNum":"  321","line":"            }"},
{"lineNum":"  322","line":"            if (instr.data == .call) {","class":"lineCov","hits":"2","order":"2685","possible_hits":"2",},
{"lineNum":"  323","line":"                for (instr.data.call.arg_lval_list.items) |lval| {","class":"lineCov","hits":"4","order":"4564","possible_hits":"4",},
{"lineNum":"  324","line":"                    reset_defs(lval);","class":"lineCov","hits":"1","order":"4565","possible_hits":"1",},
{"lineNum":"  325","line":"                }","class":"lineCov","hits":"4","order":"4566","possible_hits":"4",},
{"lineNum":"  326","line":"                for (instr.data.call.context_arg_lval_list.items) |lval| {","class":"linePartCov","hits":"3","order":"4567","possible_hits":"4",},
{"lineNum":"  327","line":"                    reset_defs(lval);","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"  328","line":"                }","class":"linePartCov","hits":"3","order":"2686","possible_hits":"5",},
{"lineNum":"  329","line":"            }"},
{"lineNum":"  330","line":"            if (instr.data == .invoke) {","class":"lineCov","hits":"1","order":"2687","possible_hits":"1",},
{"lineNum":"  331","line":"                reset_defs(instr.data.invoke.dyn_value);","class":"lineCov","hits":"3","order":"6320","possible_hits":"3",},
{"lineNum":"  332","line":"                reset_defs(instr.data.invoke.method_decl_lval);","class":"lineCov","hits":"3","order":"6321","possible_hits":"3",},
{"lineNum":"  333","line":"                for (instr.data.invoke.arg_lval_list.items) |lval| {","class":"lineCov","hits":"4","order":"6322","possible_hits":"4",},
{"lineNum":"  334","line":"                    reset_defs(lval);","class":"lineCov","hits":"1","order":"6323","possible_hits":"1",},
{"lineNum":"  335","line":"                }","class":"lineCov","hits":"4","order":"6324","possible_hits":"4",},
{"lineNum":"  336","line":"                for (instr.data.invoke.context_arg_lval_list.items) |lval| {","class":"linePartCov","hits":"3","order":"6325","possible_hits":"4",},
{"lineNum":"  337","line":"                    reset_defs(lval);","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"  338","line":"                }","class":"linePartCov","hits":"3","order":"2688","possible_hits":"5",},
{"lineNum":"  339","line":"            }"},
{"lineNum":"  340","line":"        }","class":"lineCov","hits":"3","order":"2689","possible_hits":"3",},
{"lineNum":"  341","line":"        self.return_symbol.defs = 0;","class":"lineCov","hits":"1","order":"2692","possible_hits":"1",},
{"lineNum":"  342","line":"    }","class":"lineCov","hits":"4","order":"2693","possible_hits":"4",},
{"lineNum":"  343","line":""},
{"lineNum":"  344","line":"    for (self.basic_blocks.items) |bb| {","class":"lineCov","hits":"3","order":"2694","possible_hits":"3",},
{"lineNum":"  345","line":"        // Go through sum up each definition"},
{"lineNum":"  346","line":"        for (bb.instructions.items) |instr| {","class":"lineCov","hits":"3","order":"2695","possible_hits":"3",},
{"lineNum":"  347","line":"            if (instr.dest != null) {","class":"lineCov","hits":"1","order":"2696","possible_hits":"1",},
{"lineNum":"  348","line":"                var symbver = instr.dest.?.extract_symbver();","class":"lineCov","hits":"3","order":"2697","possible_hits":"3",},
{"lineNum":"  349","line":"                symbver.set_def(instr);","class":"lineCov","hits":"2","order":"2701","possible_hits":"2",},
{"lineNum":"  350","line":"            }"},
{"lineNum":"  351","line":"            if (instr.dest != null) {","class":"lineCov","hits":"1","order":"2706","possible_hits":"1",},
{"lineNum":"  352","line":"                instr.dest.?.extract_symbver().symbol.roots += 1;","class":"lineCov","hits":"2","order":"2707","possible_hits":"2",},
{"lineNum":"  353","line":"            }"},
{"lineNum":"  354","line":"            if (instr.kind == .mut_addr_of) {","class":"lineCov","hits":"1","order":"2708","possible_hits":"1",},
{"lineNum":"  355","line":"                instr.src1.?.extract_symbver().symbol.aliases += 1;","class":"linePartCov","hits":"1","order":"2709","possible_hits":"2",},
{"lineNum":"  356","line":"            }"},
{"lineNum":"  357","line":"        }","class":"lineCov","hits":"3","order":"2710","possible_hits":"3",},
{"lineNum":"  358","line":"    }","class":"lineCov","hits":"4","order":"2711","possible_hits":"4",},
{"lineNum":"  359","line":"}"},
{"lineNum":"  360","line":""},
{"lineNum":"  361","line":"pub fn reset_defs(maybe_lval: ?*lval_.L_Value) void {","class":"lineCov","hits":"2","order":"2676","possible_hits":"2",},
{"lineNum":"  362","line":"    if (maybe_lval == null) {","class":"lineCov","hits":"1","order":"2677","possible_hits":"1",},
{"lineNum":"  363","line":"        return;","class":"lineCov","hits":"1","order":"2681","possible_hits":"1",},
{"lineNum":"  364","line":"    }"},
{"lineNum":"  365","line":""},
{"lineNum":"  366","line":"    switch (maybe_lval.?.*) {","class":"linePartCov","hits":"3","order":"2678","possible_hits":"4",},
{"lineNum":"  367","line":"        .symbver => {"},
{"lineNum":"  368","line":"            maybe_lval.?.symbver.symbol.defs = 0;","class":"lineCov","hits":"2","order":"2679","possible_hits":"2",},
{"lineNum":"  369","line":"        },"},
{"lineNum":"  370","line":"        .dereference => reset_defs(maybe_lval.?.dereference.expr),","class":"lineCov","hits":"2","order":"3863","possible_hits":"2",},
{"lineNum":"  371","line":"        .index => {"},
{"lineNum":"  372","line":"            reset_defs(maybe_lval.?.index.length);","class":"lineCov","hits":"3","order":"3859","possible_hits":"3",},
{"lineNum":"  373","line":"            reset_defs(maybe_lval.?.index.lhs);","class":"lineCov","hits":"3","order":"3860","possible_hits":"3",},
{"lineNum":"  374","line":"            reset_defs(maybe_lval.?.index.rhs);","class":"lineCov","hits":"2","order":"3864","possible_hits":"2",},
{"lineNum":"  375","line":"        },"},
{"lineNum":"  376","line":"        .select => {"},
{"lineNum":"  377","line":"            reset_defs(maybe_lval.?.select.tag);","class":"lineCov","hits":"3","order":"3861","possible_hits":"3",},
{"lineNum":"  378","line":"            reset_defs(maybe_lval.?.select.lhs);","class":"lineCov","hits":"2","order":"3862","possible_hits":"2",},
{"lineNum":"  379","line":"        },"},
{"lineNum":"  380","line":"        .raw_address => std.debug.panic(\"compiler error: undefined reset_defs for raw_address\", .{}),","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"  381","line":"    }"},
{"lineNum":"  382","line":"}"},
{"lineNum":"  383","line":""},
{"lineNum":"  384","line":"pub fn count_bb_predecessors(self: *Self) void {","class":"lineCov","hits":"2","order":"2914","possible_hits":"2",},
{"lineNum":"  385","line":"    // Reset all basic block predecessors to 0"},
{"lineNum":"  386","line":"    for (self.basic_blocks.items) |bb| {","class":"lineCov","hits":"3","order":"2915","possible_hits":"3",},
{"lineNum":"  387","line":"        bb.number_predecessors = 0;","class":"lineCov","hits":"1","order":"2916","possible_hits":"1",},
{"lineNum":"  388","line":"    }","class":"lineCov","hits":"3","order":"2917","possible_hits":"3",},
{"lineNum":"  389","line":"    self.clear_visited_BBs();","class":"lineCov","hits":"1","order":"2918","possible_hits":"1",},
{"lineNum":"  390","line":"    if (self.block_graph_head) |head| {","class":"lineCov","hits":"2","order":"2923","possible_hits":"2",},
{"lineNum":"  391","line":"        // start predecessor count walk at head"},
{"lineNum":"  392","line":"        head.count_predecessors();","class":"linePartCov","hits":"2","order":"2924","possible_hits":"3",},
{"lineNum":"  393","line":"    }"},
{"lineNum":"  394","line":"}"},
{"lineNum":"  395","line":""},
{"lineNum":"  396","line":"pub fn remove_basic_block(self: *Self, bb: *Basic_Block) void {","class":"lineCov","hits":"2","order":"3671","possible_hits":"2",},
{"lineNum":"  397","line":"    _ = self.basic_blocks.swapRemove(self.index_of_basic_block(bb));","class":"lineCov","hits":"1","order":"3672","possible_hits":"1",},
{"lineNum":"  398","line":"}"},
{"lineNum":"  399","line":""},
{"lineNum":"  400","line":"fn index_of_basic_block(self: *Self, bb: *Basic_Block) usize {","class":"lineCov","hits":"2","order":"3673","possible_hits":"2",},
{"lineNum":"  401","line":"    for (0..self.basic_blocks.items.len) |i| {","class":"lineCov","hits":"3","order":"3674","possible_hits":"3",},
{"lineNum":"  402","line":"        if (bb == self.basic_blocks.items[i]) {","class":"lineCov","hits":"2","order":"3675","possible_hits":"2",},
{"lineNum":"  403","line":"            return i;","class":"lineCov","hits":"1","order":"3678","possible_hits":"1",},
{"lineNum":"  404","line":"        }"},
{"lineNum":"  405","line":"    } else {","class":"lineCov","hits":"1","order":"3676","possible_hits":"1",},
{"lineNum":"  406","line":"        unreachable;","class":"linePartCov","hits":"1","order":"3677","possible_hits":"2",},
{"lineNum":"  407","line":"    }"},
{"lineNum":"  408","line":"}"},
{"lineNum":"  409","line":""},
{"lineNum":"  410","line":"/// Flattens all CFG\'s instructions to the module\'s list of instructions, recursively."},
{"lineNum":"  411","line":"///"},
{"lineNum":"  412","line":"/// This also then adds the CFG to the list of CFGs in this module."},
{"lineNum":"  413","line":"///"},
{"lineNum":"  414","line":"/// Also sets the `offset` flag of a CFG, which is the address in the instructions list that the"},
{"lineNum":"  415","line":"/// instructions for the CFG start."},
{"lineNum":"  416","line":"///"},
{"lineNum":"  417","line":"/// Returns the index in the cfg in the cfgs list."},
{"lineNum":"  418","line":"pub fn emplace_cfg(self: *Self, module_uid: u32, cfgs: *std.array_list.Managed(*Self), instructions_list: *std.array_list.Managed(*Instruction)) i64 {","class":"lineCov","hits":"2","order":"2985","possible_hits":"2",},
{"lineNum":"  419","line":"    const len = @as(i64, @intCast(cfgs.items.len));","class":"lineCov","hits":"1","order":"2986","possible_hits":"1",},
{"lineNum":"  420","line":"    if (self.offset_table.contains(module_uid)) {","class":"lineCov","hits":"1","order":"2987","possible_hits":"1",},
{"lineNum":"  421","line":"        // Already visited, do nothing"},
{"lineNum":"  422","line":"        return len;","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"  423","line":"    } else if (self.block_graph_head == null) {","class":"lineCov","hits":"1","order":"2988","possible_hits":"1",},
{"lineNum":"  424","line":"        // CFG doesn\'t have any real instructions. Insert phony BB."},
{"lineNum":"  425","line":"        self.offset_table.put(module_uid, self.append_phony_block(instructions_list)) catch unreachable;","class":"lineNoCov","hits":"0","possible_hits":"2",},
{"lineNum":"  426","line":"        cfgs.append(self) catch unreachable;","class":"lineNoCov","hits":"0","possible_hits":"2",},
{"lineNum":"  427","line":"    } else {"},
{"lineNum":"  428","line":"        // Normal CFG with instructions, append BBs to instructions list, recursively append children"},
{"lineNum":"  429","line":"        self.offset_table.put(module_uid, self.append_basic_block(self.block_graph_head.?, module_uid, instructions_list)) catch unreachable;","class":"lineCov","hits":"2","order":"2989","possible_hits":"2",},
{"lineNum":"  430","line":"        cfgs.append(self) catch unreachable;","class":"lineCov","hits":"3","order":"3024","possible_hits":"3",},
{"lineNum":"  431","line":""},
{"lineNum":"  432","line":"        for (self.children.keys()) |child| {","class":"lineCov","hits":"3","order":"3025","possible_hits":"3",},
{"lineNum":"  433","line":"            _ = child.emplace_cfg(module_uid, cfgs, instructions_list);","class":"lineCov","hits":"1","order":"4572","possible_hits":"1",},
{"lineNum":"  434","line":"        }","class":"lineCov","hits":"5","order":"3026","possible_hits":"5",},
{"lineNum":"  435","line":"    }"},
{"lineNum":"  436","line":"    self.locals_size = self.calculate_offsets();","class":"lineCov","hits":"1","order":"3027","possible_hits":"1",},
{"lineNum":"  437","line":"    return len;","class":"lineCov","hits":"1","order":"3044","possible_hits":"1",},
{"lineNum":"  438","line":"}"},
{"lineNum":"  439","line":""},
{"lineNum":"  440","line":"/// Appends the instructions in a BasicBlock to the module\'s instructions."},
{"lineNum":"  441","line":"/// Returns the offset of the basic block"},
{"lineNum":"  442","line":"fn append_basic_block(self: *Self, first_bb: *Basic_Block, module_uid: u32, instructions_list: *std.array_list.Managed(*Instruction)) Instruction.Index {","class":"lineCov","hits":"2","order":"2990","possible_hits":"2",},
{"lineNum":"  443","line":"    var work_queue = std.array_list.Managed(*Basic_Block).init(self.allocator);","class":"lineCov","hits":"1","order":"2991","possible_hits":"1",},
{"lineNum":"  444","line":"    defer work_queue.deinit();","class":"lineCov","hits":"1","order":"3023","possible_hits":"1",},
{"lineNum":"  445","line":"    work_queue.append(first_bb) catch unreachable;","class":"lineCov","hits":"1","order":"2992","possible_hits":"1",},
{"lineNum":"  446","line":""},
{"lineNum":"  447","line":"    while (work_queue.items.len > 0) {","class":"lineCov","hits":"1","order":"2993","possible_hits":"1",},
{"lineNum":"  448","line":"        var bb = work_queue.orderedRemove(0); // Youch! Does this really have to be ordered?","class":"lineCov","hits":"1","order":"2994","possible_hits":"1",},
{"lineNum":"  449","line":""},
{"lineNum":"  450","line":"        if (bb.offset_table.contains(module_uid)) {","class":"lineCov","hits":"1","order":"2995","possible_hits":"1",},
{"lineNum":"  451","line":"            continue;","class":"lineCov","hits":"2","order":"2996","possible_hits":"2",},
{"lineNum":"  452","line":"        }"},
{"lineNum":"  453","line":""},
{"lineNum":"  454","line":"        var label = Instruction.init_label(\"bb\", Span.phony, self.allocator);","class":"lineCov","hits":"1","order":"2997","possible_hits":"1",},
{"lineNum":"  455","line":"        label.uid = bb.uid;","class":"lineCov","hits":"1","order":"3002","possible_hits":"1",},
{"lineNum":"  456","line":"        instructions_list.append(label) catch unreachable;","class":"lineCov","hits":"2","order":"3003","possible_hits":"2",},
{"lineNum":"  457","line":""},
{"lineNum":"  458","line":"        bb.append_instructions(module_uid, instructions_list, &work_queue);","class":"lineCov","hits":"1","order":"3004","possible_hits":"1",},
{"lineNum":"  459","line":"    }","class":"lineCov","hits":"4","order":"3021","possible_hits":"4",},
{"lineNum":"  460","line":"    return first_bb.offset_table.get(module_uid).?;","class":"lineCov","hits":"3","order":"3022","possible_hits":"3",},
{"lineNum":"  461","line":"}"},
{"lineNum":"  462","line":""},
{"lineNum":"  463","line":"/// This function inserts a label and a return instruction. It is needed for functions which do not have"},
{"lineNum":"  464","line":"/// instructions. The label is needed so that codegen_ can know there is a new function, and the return"},
{"lineNum":"  465","line":"/// instruction is for interpreting so that jumping to the function won\'t jump to some random function."},
{"lineNum":"  466","line":"fn append_phony_block(self: *Self, instructions_list: *std.array_list.Managed(*Instruction)) Instruction.Index {","class":"lineNoCov","hits":"0","possible_hits":"2",},
{"lineNum":"  467","line":"    const offset = @as(Instruction.Index, @intCast(instructions_list.items.len));","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"  468","line":"    // Append a label which has a back-reference to the CFG"},
{"lineNum":"  469","line":"    instructions_list.append(Instruction.init_label(","class":"lineNoCov","hits":"0","possible_hits":"3",},
{"lineNum":"  470","line":"        \"phony\","},
{"lineNum":"  471","line":"        Span.phony,"},
{"lineNum":"  472","line":"        self.allocator,","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"  473","line":"    )) catch unreachable;","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"  474","line":"    // Append a return instruction (a jump to null)"},
{"lineNum":"  475","line":"    instructions_list.append(Instruction.init_jump_addr(","class":"lineNoCov","hits":"0","possible_hits":"3",},
{"lineNum":"  476","line":"        null,"},
{"lineNum":"  477","line":"        Span.phony,"},
{"lineNum":"  478","line":"        self.allocator,","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"  479","line":"    )) catch unreachable;","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"  480","line":"    return offset;","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"  481","line":"}"},
{"lineNum":"  482","line":""},
{"lineNum":"  483","line":"pub fn get_adjacent(self: *Self) []*Self {","class":"lineCov","hits":"2","order":"3708","possible_hits":"2",},
{"lineNum":"  484","line":"    return self.children.keys();","class":"lineCov","hits":"1","order":"3709","possible_hits":"1",},
{"lineNum":"  485","line":"}"},
{"lineNum":"  486","line":""},
{"lineNum":"  487","line":"/// Fills in a CFG\'s local offsets"},
{"lineNum":"  488","line":"///"},
{"lineNum":"  489","line":"/// ## The Orange interpreter calling convention"},
{"lineNum":"  490","line":"/// (stack grows up btw, lmao)"},
{"lineNum":"  491","line":"/// ```"},
{"lineNum":"  492","line":"///       |         |"},
{"lineNum":"  493","line":"/// sp -> |         |"},
{"lineNum":"  494","line":"///       | ------- | \\"},
{"lineNum":"  495","line":"///       | local 2 |  |"},
{"lineNum":"  496","line":"///       | ------- |  |"},
{"lineNum":"  497","line":"///       | local 1 |  |"},
{"lineNum":"  498","line":"/// bp -> | ret-adr |  | - callee stack frame"},
{"lineNum":"  499","line":"///    -8 | prev-bp |  |"},
{"lineNum":"  500","line":"///   -16 | prev-sp |  |"},
{"lineNum":"  501","line":"///   -24 | &retval |  | \\"},
{"lineNum":"  502","line":"///       | ------- |  |  |"},
{"lineNum":"  503","line":"///       | - pad - |  |  |"},
{"lineNum":"  504","line":"///       | ------- |  |  |"},
{"lineNum":"  505","line":"///   -28 | arg 1   |  |  |"},
{"lineNum":"  506","line":"///       | arg 2   |  |  |"},
{"lineNum":"  507","line":"///   -30 | arg 2   | /   | - caller stack frame"},
{"lineNum":"  508","line":"///       | - pad - |     |"},
{"lineNum":"  509","line":"///   -32 | arg 3   |     |"},
{"lineNum":"  510","line":"///       | - pad - |     |"},
{"lineNum":"  511","line":"///       | local 2 |     |"},
{"lineNum":"  512","line":"/// ```"},
{"lineNum":"  513","line":"///"},
{"lineNum":"  514","line":"/// - Entry (caller)"},
{"lineNum":"  515","line":"///   * (save sp, will be pushed later)"},
{"lineNum":"  516","line":"///   - push args in reverse order"},
{"lineNum":"  517","line":"///   - push address to return-value slot"},
{"lineNum":"  518","line":"///   - `call` instruction"},
{"lineNum":"  519","line":"///     * push pre-arg sp"},
{"lineNum":"  520","line":"///     * push bp"},
{"lineNum":"  521","line":"///     * push ret-addr"},
{"lineNum":"  522","line":"///     * bp := sp"},
{"lineNum":"  523","line":"///   - sp += n  (allocate space for locals)"},
{"lineNum":"  524","line":"///"},
{"lineNum":"  525","line":"/// - Exit (callee)"},
{"lineNum":"  526","line":"///   - sp := bp   (deallocate locals)"},
{"lineNum":"  527","line":"///   - `ret` instruction"},
{"lineNum":"  528","line":"///     * ip := pop  (set ip to ret-addr)"},
{"lineNum":"  529","line":"///     * bp := pop  (set bp to prev-bp)"},
{"lineNum":"  530","line":"///     * sp := pop  (deallocate all params)"},
{"lineNum":"  531","line":"///"},
{"lineNum":"  532","line":"/// There is padding before, in between, and after parameters, locals, and tuple fields so that each"},
{"lineNum":"  533","line":"/// location is aligned to a multiple of it\'s size in bytes."},
{"lineNum":"  534","line":"pub fn calculate_offsets(self: *Self) i64 //< Number of bytes used for locals by the function."},
{"lineNum":"  535","line":"{","class":"lineCov","hits":"2","order":"3028","possible_hits":"2",},
{"lineNum":"  536","line":"    self.return_symbol.offset = null; // return value is set using an out-parameter","class":"lineCov","hits":"1","order":"3029","possible_hits":"1",},
{"lineNum":"  537","line":""},
{"lineNum":"  538","line":"    // Calculate parameters offsets, descending from retval address offset"},
{"lineNum":"  539","line":"    var phony_sp: i64 = 0;","class":"lineCov","hits":"1","order":"3030","possible_hits":"1",},
{"lineNum":"  540","line":"    if (self.symbol.decl.?.* == .fn_decl or self.symbol.decl.?.* == .method_decl) {","class":"lineCov","hits":"2","order":"3031","possible_hits":"2",},
{"lineNum":"  541","line":"        const param_symbols = self.symbol.decl.?.param_symbols().?.items;","class":"lineCov","hits":"3","order":"3722","possible_hits":"3",},
{"lineNum":"  542","line":"        // Go through params, as if we were pushing them"},
{"lineNum":"  543","line":"        var i: i64 = @as(i64, @intCast(param_symbols.len)) - 1;","class":"linePartCov","hits":"1","order":"3723","possible_hits":"2",},
{"lineNum":"  544","line":"        while (i >= 0) : (i -= 1) {","class":"linePartCov","hits":"3","order":"3724","possible_hits":"4",},
{"lineNum":"  545","line":"            var param: *Symbol = param_symbols[@as(usize, @intCast(i))];","class":"linePartCov","hits":"2","order":"3725","possible_hits":"3",},
{"lineNum":"  546","line":"            const size = param.expanded_type().sizeof();","class":"lineCov","hits":"1","order":"3726","possible_hits":"1",},
{"lineNum":"  547","line":"            const alignof = param.expanded_type().alignof();","class":"lineCov","hits":"1","order":"3727","possible_hits":"1",},
{"lineNum":"  548","line":"            phony_sp = alignment_.next_alignment(phony_sp, alignof);","class":"lineCov","hits":"1","order":"3728","possible_hits":"1",},
{"lineNum":"  549","line":"            param.offset = phony_sp;","class":"lineCov","hits":"1","order":"3729","possible_hits":"1",},
{"lineNum":"  550","line":"            phony_sp += size;","class":"linePartCov","hits":"1","order":"3730","possible_hits":"2",},
{"lineNum":"  551","line":"        }","class":"lineCov","hits":"1","order":"3731","possible_hits":"1",},
{"lineNum":"  552","line":""},
{"lineNum":"  553","line":"        // Push a \"header\" word of alignment 8. Pretend this has the offset of the header. Adjust the offsets"},
{"lineNum":"  554","line":"        // set before accordingly"},
{"lineNum":"  555","line":"        const header = alignment_.next_alignment(phony_sp, 8);","class":"lineCov","hits":"1","order":"3732","possible_hits":"1",},
{"lineNum":"  556","line":"        // Have to do this stupid round-a-bout way because we don\'t know how much padding to include after the"},
{"lineNum":"  557","line":"        // parameters until we get the offsets of each parameter."},
{"lineNum":"  558","line":"        for (param_symbols) |param| {","class":"lineCov","hits":"3","order":"3733","possible_hits":"3",},
{"lineNum":"  559","line":"            param.offset.? -= header - retval_offset;","class":"lineCov","hits":"2","order":"3734","possible_hits":"2",},
{"lineNum":"  560","line":"        }","class":"lineCov","hits":"5","order":"3032","possible_hits":"5",},
{"lineNum":"  561","line":"    }"},
{"lineNum":"  562","line":""},
{"lineNum":"  563","line":"    // Calculate locals offsets, ascending from local starting offset"},
{"lineNum":"  564","line":"    var local_offsets: i64 = locals_starting_offset;","class":"lineCov","hits":"1","order":"3033","possible_hits":"1",},
{"lineNum":"  565","line":"    for (self.symbvers.items) |symbver| {","class":"lineCov","hits":"3","order":"3034","possible_hits":"3",},
{"lineNum":"  566","line":"        if (symbver.symbol.offset == null and !std.mem.eql(u8, symbver.symbol.name, \"_retval\")) {","class":"lineCov","hits":"2","order":"3035","possible_hits":"2",},
{"lineNum":"  567","line":"            local_offsets = alignment_.next_alignment(local_offsets, symbver.symbol.expanded_type().alignof());","class":"lineCov","hits":"1","order":"3036","possible_hits":"1",},
{"lineNum":"  568","line":"            local_offsets += symbver.symbol.set_offset(local_offsets);","class":"lineCov","hits":"2","order":"3037","possible_hits":"2",},
{"lineNum":"  569","line":"        }"},
{"lineNum":"  570","line":"    }","class":"lineCov","hits":"3","order":"3041","possible_hits":"3",},
{"lineNum":"  571","line":"    local_offsets = alignment_.next_alignment(local_offsets, 8);","class":"lineCov","hits":"1","order":"3042","possible_hits":"1",},
{"lineNum":"  572","line":""},
{"lineNum":"  573","line":"    // The total number of bytes used for locals"},
{"lineNum":"  574","line":"    return local_offsets - locals_starting_offset;","class":"linePartCov","hits":"1","order":"3043","possible_hits":"2",},
{"lineNum":"  575","line":"}"},
{"lineNum":"  576","line":""},
{"lineNum":"  577","line":"pub fn print_instructions(self: *Self) void {"},
{"lineNum":"  578","line":"    // Print out the basic blocks"},
{"lineNum":"  579","line":"    std.debug.print(\"CFG {s}:\\n\", .{self.symbol.name});"},
{"lineNum":"  580","line":"    for (self.basic_blocks.items) |bb| {"},
{"lineNum":"  581","line":"        bb.pprint();"},
{"lineNum":"  582","line":"    }"},
{"lineNum":"  583","line":"}"},
]};
var percent_low = 25;var percent_high = 75;
var header = { "command" : "orng-test", "date" : "2025-11-10 15:43:08", "instrumented" : 291, "covered" : 267,};
var merged_data = [];
