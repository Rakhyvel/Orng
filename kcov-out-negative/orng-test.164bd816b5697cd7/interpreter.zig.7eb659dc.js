var data = {lines:[
{"lineNum":"    1","line":"const std = @import(\"std\");"},
{"lineNum":"    2","line":"const ast_ = @import(\"../ast/ast.zig\");"},
{"lineNum":"    3","line":"const builtin_ = @import(\"builtin.zig\");"},
{"lineNum":"    4","line":"const core_ = @import(\"../hierarchy/core.zig\");"},
{"lineNum":"    5","line":"const CFG = @import(\"../ir/cfg.zig\");"},
{"lineNum":"    6","line":"const Compiler_Context = @import(\"../hierarchy/compiler.zig\");"},
{"lineNum":"    7","line":"const errs_ = @import(\"../util/errors.zig\");"},
{"lineNum":"    8","line":"const Instruction = @import(\"../ir/instruction.zig\");"},
{"lineNum":"    9","line":"const Interned_String_Set = @import(\"../ir/interned_string_set.zig\");"},
{"lineNum":"   10","line":"const lval_ = @import(\"../ir/lval.zig\");"},
{"lineNum":"   11","line":"const Memory = @import(\"memory.zig\");"},
{"lineNum":"   12","line":"const module_ = @import(\"../hierarchy/module.zig\");"},
{"lineNum":"   13","line":"const prelude_ = @import(\"../hierarchy/prelude.zig\");"},
{"lineNum":"   14","line":"const alignment_ = @import(\"../util/alignment.zig\");"},
{"lineNum":"   15","line":"const Token = @import(\"../lexer/token.zig\");"},
{"lineNum":"   16","line":"const Type_AST = @import(\"../types/type.zig\").Type_AST;"},
{"lineNum":"   17","line":"const Span = @import(\"../util/span.zig\");"},
{"lineNum":"   18","line":"const Symbol = @import(\"../symbol/symbol.zig\");"},
{"lineNum":"   19","line":""},
{"lineNum":"   20","line":"const Self = @This();"},
{"lineNum":"   21","line":""},
{"lineNum":"   22","line":"const Error = error{CompileError};"},
{"lineNum":"   23","line":""},
{"lineNum":"   24","line":"/// Interpreter execution timeout in milliseconds"},
{"lineNum":"   25","line":"const timeout_ms = 1_000;"},
{"lineNum":"   26","line":"/// Size of the stack. 32 KiB, or around 1024 stack frames."},
{"lineNum":"   27","line":"const stack_limit = 0x8000; // 32 KiB"},
{"lineNum":"   28","line":""},
{"lineNum":"   29","line":"/// Executing an instruction at this address causes the interpreter to halt. This is used as the return address for the"},
{"lineNum":"   30","line":"/// entry point, so that if the entry returns, interpretation halts. Also allows for a way to halt interpretation from"},
{"lineNum":"   31","line":"/// anywhere, by simply jumping to here."},
{"lineNum":"   32","line":"const halt_trap_instruction: Instruction.Index = 0xFFFF_FFF0;"},
{"lineNum":"   33","line":""},
{"lineNum":"   34","line":"/// When true, interpreter runs each instruction at a time, printing the stack and registers for debugging purposes."},
{"lineNum":"   35","line":"/// I _think_ that VSCode language servers consume a JSON file representing the state of the debugger, so this could be"},
{"lineNum":"   36","line":"/// useful."},
{"lineNum":"   37","line":"const Debugger_Mode = enum {"},
{"lineNum":"   38","line":"    /// Interpreter does not emit debugging logs"},
{"lineNum":"   39","line":"    off,"},
{"lineNum":"   40","line":"    /// Interpreter emits debugging logs"},
{"lineNum":"   41","line":"    noninteractive,"},
{"lineNum":"   42","line":"    /// Interpreter emits debugging logs, waits for user to proceed to next instruction"},
{"lineNum":"   43","line":"    interactive,"},
{"lineNum":"   44","line":"};"},
{"lineNum":"   45","line":"const debugger: Debugger_Mode = .off;"},
{"lineNum":"   46","line":""},
{"lineNum":"   47","line":"const Instruction_Pointer = struct {"},
{"lineNum":"   48","line":"    /// The UID of the module currently being executed"},
{"lineNum":"   49","line":"    module_uid: module_.Module_UID,"},
{"lineNum":"   50","line":"    /// The index of the instruction currently being executed, relative to the current module"},
{"lineNum":"   51","line":"    inst_idx: Instruction.Index,"},
{"lineNum":"   52","line":"};"},
{"lineNum":"   53","line":""},
{"lineNum":"   54","line":"// These are signed to make offsets (which can be negative from the base pointer) easier"},
{"lineNum":"   55","line":"stack_pointer: i64,"},
{"lineNum":"   56","line":"base_pointer: i64,"},
{"lineNum":"   57","line":"bump_alloc_pointer: i64,"},
{"lineNum":"   58","line":"instruction_pointer: Instruction_Pointer,"},
{"lineNum":"   59","line":""},
{"lineNum":"   60","line":"memory: Memory,"},
{"lineNum":"   61","line":"modules: std.AutoArrayHashMap(module_.Module_UID, *module_.Module),"},
{"lineNum":"   62","line":"debug_call_stack: std.array_list.Managed(Span),"},
{"lineNum":"   63","line":"start_time: i64,"},
{"lineNum":"   64","line":""},
{"lineNum":"   65","line":"call_depth: i64,"},
{"lineNum":"   66","line":""},
{"lineNum":"   67","line":"ctx: *Compiler_Context,"},
{"lineNum":"   68","line":""},
{"lineNum":"   69","line":"/// Initializes a new interpreter context."},
{"lineNum":"   70","line":"pub fn init(ctx: *Compiler_Context) Self {","class":"lineCov","hits":"2","order":"3046","possible_hits":"2",},
{"lineNum":"   71","line":"    return Self{","class":"lineCov","hits":"1","order":"3053","possible_hits":"1",},
{"lineNum":"   72","line":"        .memory = Memory.init(ctx.allocator().alloc(u8, stack_limit) catch unreachable),","class":"lineCov","hits":"2","order":"3047","possible_hits":"2",},
{"lineNum":"   73","line":"        .bump_alloc_pointer = stack_limit,"},
{"lineNum":"   74","line":"        .stack_pointer = 0,"},
{"lineNum":"   75","line":"        .base_pointer = 0,"},
{"lineNum":"   76","line":""},
{"lineNum":"   77","line":"        .modules = std.AutoArrayHashMap(module_.Module_UID, *module_.Module).init(ctx.allocator()),","class":"lineCov","hits":"1","order":"3050","possible_hits":"1",},
{"lineNum":"   78","line":"        .instruction_pointer = .{ .module_uid = 0, .inst_idx = 0 },"},
{"lineNum":"   79","line":"        .debug_call_stack = std.array_list.Managed(Span).init(ctx.allocator()),","class":"lineCov","hits":"1","order":"3051","possible_hits":"1",},
{"lineNum":"   80","line":""},
{"lineNum":"   81","line":"        .start_time = std.time.milliTimestamp(),","class":"lineCov","hits":"1","order":"3052","possible_hits":"1",},
{"lineNum":"   82","line":""},
{"lineNum":"   83","line":"        .call_depth = 0,"},
{"lineNum":"   84","line":""},
{"lineNum":"   85","line":"        .ctx = ctx,"},
{"lineNum":"   86","line":"    };"},
{"lineNum":"   87","line":"}"},
{"lineNum":"   88","line":""},
{"lineNum":"   89","line":"pub fn set_entry_point("},
{"lineNum":"   90","line":"    self: *Self,"},
{"lineNum":"   91","line":"    entry: *CFG,"},
{"lineNum":"   92","line":"    ret_type: *Type_AST,"},
{"lineNum":"   93","line":") void {","class":"lineCov","hits":"2","order":"3055","possible_hits":"2",},
{"lineNum":"   94","line":"    const frame_address = alignment_.next_alignment(ret_type.sizeof(), 8);","class":"lineCov","hits":"1","order":"3056","possible_hits":"1",},
{"lineNum":"   95","line":"    const module = entry.symbol.scope.module.?;","class":"lineCov","hits":"2","order":"3057","possible_hits":"2",},
{"lineNum":"   96","line":""},
{"lineNum":"   97","line":"    self.stack_pointer = (5 * @sizeOf(i64)) + frame_address + entry.locals_size.?;","class":"linePartCov","hits":"1","order":"3058","possible_hits":"2",},
{"lineNum":"   98","line":"    self.base_pointer = (3 * @sizeOf(i64)) + frame_address;","class":"lineCov","hits":"1","order":"3059","possible_hits":"1",},
{"lineNum":"   99","line":"    self.instruction_pointer = .{ .module_uid = module.uid, .inst_idx = entry.offset_table.get(module.uid).? };","class":"lineCov","hits":"2","order":"3060","possible_hits":"2",},
{"lineNum":"  100","line":""},
{"lineNum":"  101","line":"    // First `ret_type.sizeof()` bytes are reserved for the return value"},
{"lineNum":"  102","line":"    // Initial stack frame is setup immediately after"},
{"lineNum":"  103","line":"    self.memory.store_int(frame_address + 0 * @sizeOf(i64), @sizeOf(i64), 0); // Set the return value address to 0","class":"linePartCov","hits":"1","order":"3061","possible_hits":"2",},
{"lineNum":"  104","line":"    self.memory.store_int(frame_address + 1 * @sizeOf(i64), @sizeOf(i64), 0); // Set the prev-bp to 0","class":"lineCov","hits":"1","order":"3070","possible_hits":"1",},
{"lineNum":"  105","line":"    self.memory.store_int(frame_address + 2 * @sizeOf(i64), @sizeOf(i64), 0); // Set the prev-sp to 0","class":"lineCov","hits":"1","order":"3071","possible_hits":"1",},
{"lineNum":"  106","line":"    self.memory.store(Instruction_Pointer, frame_address + 3 * @sizeOf(i64), .{ .module_uid = 0, .inst_idx = halt_trap_instruction }); // Set the return address to halt trap value","class":"lineCov","hits":"1","order":"3072","possible_hits":"1",},
{"lineNum":"  107","line":""},
{"lineNum":"  108","line":"    self.debug_call_stack.append(entry.symbol.span()) catch unreachable;","class":"lineCov","hits":"2","order":"3073","possible_hits":"2",},
{"lineNum":"  109","line":""},
{"lineNum":"  110","line":"    self.load_module(module);","class":"lineCov","hits":"1","order":"3074","possible_hits":"1",},
{"lineNum":"  111","line":"}"},
{"lineNum":"  112","line":""},
{"lineNum":"  113","line":"pub fn deinit(self: *Self) void {","class":"lineCov","hits":"2","order":"3182","possible_hits":"2",},
{"lineNum":"  114","line":"    self.modules.deinit();","class":"lineCov","hits":"1","order":"3183","possible_hits":"1",},
{"lineNum":"  115","line":"    self.debug_call_stack.deinit();","class":"lineCov","hits":"1","order":"3184","possible_hits":"1",},
{"lineNum":"  116","line":"    self.ctx.allocator().free(self.memory.memory);","class":"lineCov","hits":"1","order":"3185","possible_hits":"1",},
{"lineNum":"  117","line":"}"},
{"lineNum":"  118","line":""},
{"lineNum":"  119","line":"/// Interprets the interpreter\'s instructions until the interpreter has executed more return instructions than call"},
{"lineNum":"  120","line":"/// instructions, and the instruction pointer isn\'t a trap representation."},
{"lineNum":"  121","line":"pub fn run(self: *Self) error{CompileError}!void {","class":"lineCov","hits":"2","order":"3079","possible_hits":"2",},
{"lineNum":"  122","line":"    const initial_call_depth = self.call_depth;","class":"lineCov","hits":"1","order":"3080","possible_hits":"1",},
{"lineNum":"  123","line":"    // Stop whenever has returned more than called, or instruction pointer is not a halt trap representation"},
{"lineNum":"  124","line":"    while (self.call_depth >= initial_call_depth and self.instruction_pointer.inst_idx < halt_trap_instruction) : (self.instruction_pointer.inst_idx += 1) {","class":"linePartCov","hits":"4","order":"3081","possible_hits":"5",},
{"lineNum":"  125","line":"        const instr: *Instruction = try self.curr_instruction();","class":"linePartCov","hits":"1","order":"3082","possible_hits":"2",},
{"lineNum":"  126","line":"        if (debugger != .off) {"},
{"lineNum":"  127","line":"            std.debug.print(\"\\n\", .{});"},
{"lineNum":"  128","line":"            self.print_registers();"},
{"lineNum":"  129","line":"            self.print_stack();"},
{"lineNum":"  130","line":"            std.debug.print(\"\\n\\n\\n\\n// {s}\\n{}=> \", .{ instr.span.line_text, instr });"},
{"lineNum":"  131","line":"        }"},
{"lineNum":"  132","line":"        const time_now = std.time.milliTimestamp();","class":"lineCov","hits":"1","order":"3088","possible_hits":"1",},
{"lineNum":"  133","line":"        if (debugger == .off and time_now - self.start_time > timeout_ms) {","class":"linePartCov","hits":"1","order":"3089","possible_hits":"2",},
{"lineNum":"  134","line":"            return self.interpreter_panic(\"interpreter error: compile-time interpreter timeout\\n\", .{});","class":"lineCov","hits":"1","order":"6197","possible_hits":"1",},
{"lineNum":"  135","line":"        }"},
{"lineNum":"  136","line":"        if (debugger == .interactive) {"},
{"lineNum":"  137","line":"            var in_buffer: [256]u8 = undefined;"},
{"lineNum":"  138","line":"            _ = std.io.getStdIn().read(&in_buffer) catch unreachable;"},
{"lineNum":"  139","line":"        }"},
{"lineNum":"  140","line":"        try self.execute_instruction(instr);","class":"lineCov","hits":"3","order":"3090","possible_hits":"3",},
{"lineNum":"  141","line":"    }","class":"lineCov","hits":"1","order":"3095","possible_hits":"1",},
{"lineNum":"  142","line":"}"},
{"lineNum":"  143","line":""},
{"lineNum":"  144","line":"/// Executes an instruction within the interpreter context."},
{"lineNum":"  145","line":"inline fn execute_instruction(self: *Self, instr: *Instruction) Error!void { // This doesn\'t work if it\'s not inlined, lol!","class":"lineCov","hits":"1","order":"3091","possible_hits":"1",},
{"lineNum":"  146","line":"    switch (instr.kind) {","class":"linePartCov","hits":"1","order":"3092","possible_hits":"3",},
{"lineNum":"  147","line":"        // Invalid instructions"},
{"lineNum":"  148","line":"        .load_extern,"},
{"lineNum":"  149","line":"        .size_of,"},
{"lineNum":"  150","line":"        => unreachable,","class":"linePartCov","hits":"1","order":"3093","possible_hits":"2",},
{"lineNum":"  151","line":""},
{"lineNum":"  152","line":"        // Nops"},
{"lineNum":"  153","line":"        .label, .load_unit => {},"},
{"lineNum":"  154","line":""},
{"lineNum":"  155","line":"        // Load literals"},
{"lineNum":"  156","line":"        .load_int => {"},
{"lineNum":"  157","line":"            try self.assert_fits(instr.data.int, instr.dest.?.get_expanded_type(), \"integer value\", instr.span);","class":"lineCov","hits":"2","order":"3241","possible_hits":"2",},
{"lineNum":"  158","line":"            self.memory.store_int(try self.effective_address(instr.dest.?), instr.dest.?.expanded_type_sizeof(), instr.data.int);","class":"lineCov","hits":"1","order":"3246","possible_hits":"1",},
{"lineNum":"  159","line":"        },"},
{"lineNum":"  160","line":"        .load_float => self.memory.store_float(try self.effective_address(instr.dest.?), instr.dest.?.expanded_type_sizeof(), instr.data.float),","class":"lineNoCov","hits":"0","possible_hits":"2",},
{"lineNum":"  161","line":"        .load_string => {"},
{"lineNum":"  162","line":"            self.memory.store(Interned_String_Set.String_Idx, try self.effective_address(instr.dest.?), instr.data.string_id);","class":"lineNoCov","hits":"0","possible_hits":"3",},
{"lineNum":"  163","line":"            const interned_strings = self.ctx.lookup_interned_string_set(self.modules.get(instr.data.string_id.module_uid).?.uid).?;","class":"lineNoCov","hits":"0","possible_hits":"3",},
{"lineNum":"  164","line":"            const string = interned_strings.items()[instr.data.string_id.string_idx];","class":"lineNoCov","hits":"0","possible_hits":"3",},
{"lineNum":"  165","line":"            self.memory.store(u64, try self.effective_address(instr.dest.?) + 8, string.len);","class":"lineNoCov","hits":"0","possible_hits":"2",},
{"lineNum":"  166","line":"        },"},
{"lineNum":"  167","line":"        .load_symbol => {"},
{"lineNum":"  168","line":"            const symbol_module = instr.data.symbol.scope.module.?;","class":"lineCov","hits":"3","order":"4573","possible_hits":"3",},
{"lineNum":"  169","line":"            if (self.modules.get(symbol_module.uid) == null) {","class":"lineCov","hits":"1","order":"4574","possible_hits":"1",},
{"lineNum":"  170","line":"                self.load_module(symbol_module);","class":"linePartCov","hits":"1","order":"4575","possible_hits":"2",},
{"lineNum":"  171","line":"            }"},
{"lineNum":"  172","line":"            self.memory.store_int(try self.effective_address(instr.dest.?), instr.dest.?.expanded_type_sizeof(), @intFromPtr(instr.data.symbol));","class":"lineCov","hits":"2","order":"4576","possible_hits":"2",},
{"lineNum":"  173","line":"        },"},
{"lineNum":"  174","line":"        .load_AST => {"},
{"lineNum":"  175","line":"            // std.debug.print(\"loading: {}\\n\", .{instr.data.ast});"},
{"lineNum":"  176","line":"            self.memory.store_int(try self.effective_address(instr.dest.?), 8, @intFromPtr(instr.data.ast));","class":"lineNoCov","hits":"0","possible_hits":"2",},
{"lineNum":"  177","line":"        },"},
{"lineNum":"  178","line":"        .load_struct => try self.move_lval_list(try self.effective_address(instr.dest.?), &instr.data.lval_list),","class":"lineCov","hits":"2","order":"3105","possible_hits":"2",},
{"lineNum":"  179","line":"        .load_union => {"},
{"lineNum":"  180","line":"            if (instr.src1 != null) {","class":"lineCov","hits":"1","order":"3096","possible_hits":"1",},
{"lineNum":"  181","line":"                // Store data into first field"},
{"lineNum":"  182","line":"                const dest = try self.effective_address(instr.dest.?);","class":"lineNoCov","hits":"0","possible_hits":"2",},
{"lineNum":"  183","line":"                const src = try self.effective_address(instr.src1.?);","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"  184","line":"                self.memory.move(dest, src, instr.src1.?.expanded_type_sizeof());","class":"linePartCov","hits":"1","order":"3097","possible_hits":"2",},
{"lineNum":"  185","line":"            }"},
{"lineNum":"  186","line":"            // Store tag in last field"},
{"lineNum":"  187","line":"            const tag_address = try self.effective_address(instr.dest.?) + instr.dest.?.expanded_type_sizeof() - 8;","class":"lineCov","hits":"2","order":"3098","possible_hits":"2",},
{"lineNum":"  188","line":"            self.memory.store(i64, tag_address, @as(i64, @intCast(instr.data.int)));","class":"lineCov","hits":"1","order":"3104","possible_hits":"1",},
{"lineNum":"  189","line":"        },"},
{"lineNum":"  190","line":""},
{"lineNum":"  191","line":"        .copy => {"},
{"lineNum":"  192","line":"            std.debug.assert(instr.dest.?.expanded_type_sizeof() == instr.src1.?.expanded_type_sizeof());","class":"lineCov","hits":"3","order":"4906","possible_hits":"3",},
{"lineNum":"  193","line":"            const dest = try self.effective_address(instr.dest.?);","class":"lineCov","hits":"2","order":"4907","possible_hits":"2",},
{"lineNum":"  194","line":"            const src = try self.effective_address(instr.src1.?);","class":"lineCov","hits":"1","order":"4908","possible_hits":"1",},
{"lineNum":"  195","line":"            self.memory.move(dest, src, instr.dest.?.expanded_type_sizeof());","class":"lineCov","hits":"1","order":"4909","possible_hits":"1",},
{"lineNum":"  196","line":"        },"},
{"lineNum":"  197","line":"        .not => {"},
{"lineNum":"  198","line":"            const data = self.memory.load_int(try self.effective_address(instr.src1.?), instr.src1.?.expanded_type_sizeof());","class":"lineNoCov","hits":"0","possible_hits":"3",},
{"lineNum":"  199","line":"            self.memory.store_int(try self.effective_address(instr.dest.?), instr.dest.?.expanded_type_sizeof(), if (data != 0) 0 else 1);","class":"lineNoCov","hits":"0","possible_hits":"2",},
{"lineNum":"  200","line":"        },"},
{"lineNum":"  201","line":"        .negate_int => {"},
{"lineNum":"  202","line":"            const data = self.memory.load_int(try self.effective_address(instr.src1.?), instr.src1.?.expanded_type_sizeof());","class":"lineNoCov","hits":"0","possible_hits":"3",},
{"lineNum":"  203","line":"            self.memory.store_int(try self.effective_address(instr.dest.?), instr.dest.?.expanded_type_sizeof(), -data);","class":"lineNoCov","hits":"0","possible_hits":"2",},
{"lineNum":"  204","line":"        },"},
{"lineNum":"  205","line":"        .negate_float => {"},
{"lineNum":"  206","line":"            const data = self.memory.load_float(try self.effective_address(instr.src1.?), instr.src1.?.expanded_type_sizeof());","class":"lineNoCov","hits":"0","possible_hits":"3",},
{"lineNum":"  207","line":"            self.memory.store_float(try self.effective_address(instr.dest.?), instr.dest.?.expanded_type_sizeof(), -data);","class":"lineNoCov","hits":"0","possible_hits":"2",},
{"lineNum":"  208","line":"        },"},
{"lineNum":"  209","line":"        .mut_addr_of, .addr_of => {"},
{"lineNum":"  210","line":"            const data = try self.effective_address(instr.src1.?);","class":"lineNoCov","hits":"0","possible_hits":"2",},
{"lineNum":"  211","line":"            self.memory.store_int(try self.effective_address(instr.dest.?), 8, data);","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"  212","line":"        },"},
{"lineNum":"  213","line":"        .equal => {"},
{"lineNum":"  214","line":"            const data = try self.binop_load_int(instr.src1.?, instr.src2.?);","class":"lineNoCov","hits":"0","possible_hits":"2",},
{"lineNum":"  215","line":"            self.memory.store_int(try self.effective_address(instr.dest.?), instr.dest.?.expanded_type_sizeof(), if (data.src1 == data.src2) 1 else 0);","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"  216","line":"        },"},
{"lineNum":"  217","line":"        .not_equal => {"},
{"lineNum":"  218","line":"            const data = try self.binop_load_int(instr.src1.?, instr.src2.?);","class":"lineNoCov","hits":"0","possible_hits":"2",},
{"lineNum":"  219","line":"            self.memory.store_int(try self.effective_address(instr.dest.?), instr.dest.?.expanded_type_sizeof(), if (data.src1 != data.src2) 1 else 0);","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"  220","line":"        },"},
{"lineNum":"  221","line":"        .greater_int => {"},
{"lineNum":"  222","line":"            const data = try self.binop_load_int(instr.src1.?, instr.src2.?);","class":"lineNoCov","hits":"0","possible_hits":"2",},
{"lineNum":"  223","line":"            self.memory.store_int(try self.effective_address(instr.dest.?), instr.dest.?.expanded_type_sizeof(), if (data.src1 > data.src2) 1 else 0);","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"  224","line":"        },"},
{"lineNum":"  225","line":"        .greater_float => {"},
{"lineNum":"  226","line":"            const data = try self.binop_load_float(instr.src1.?, instr.src2.?);","class":"lineNoCov","hits":"0","possible_hits":"2",},
{"lineNum":"  227","line":"            self.memory.store_float(try self.effective_address(instr.dest.?), instr.dest.?.expanded_type_sizeof(), if (data.src1 > data.src2) 1 else 0);","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"  228","line":"        },"},
{"lineNum":"  229","line":"        .lesser_int => {"},
{"lineNum":"  230","line":"            const data = try self.binop_load_int(instr.src1.?, instr.src2.?);","class":"lineNoCov","hits":"0","possible_hits":"2",},
{"lineNum":"  231","line":"            self.memory.store_int(try self.effective_address(instr.dest.?), instr.dest.?.expanded_type_sizeof(), if (data.src1 < data.src2) 1 else 0);","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"  232","line":"        },"},
{"lineNum":"  233","line":"        .lesser_float => {"},
{"lineNum":"  234","line":"            const data = try self.binop_load_float(instr.src1.?, instr.src2.?);","class":"lineNoCov","hits":"0","possible_hits":"2",},
{"lineNum":"  235","line":"            self.memory.store_float(try self.effective_address(instr.dest.?), instr.dest.?.expanded_type_sizeof(), if (data.src1 < data.src2) 1 else 0);","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"  236","line":"        },"},
{"lineNum":"  237","line":"        .greater_equal_int => {"},
{"lineNum":"  238","line":"            const data = try self.binop_load_int(instr.src1.?, instr.src2.?);","class":"lineNoCov","hits":"0","possible_hits":"2",},
{"lineNum":"  239","line":"            self.memory.store_int(try self.effective_address(instr.dest.?), instr.dest.?.expanded_type_sizeof(), if (data.src1 >= data.src2) 1 else 0);","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"  240","line":"        },"},
{"lineNum":"  241","line":"        .greater_equal_float => {"},
{"lineNum":"  242","line":"            const data = try self.binop_load_float(instr.src1.?, instr.src2.?);","class":"lineNoCov","hits":"0","possible_hits":"2",},
{"lineNum":"  243","line":"            self.memory.store_float(try self.effective_address(instr.dest.?), instr.dest.?.expanded_type_sizeof(), if (data.src1 >= data.src2) 1 else 0);","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"  244","line":"        },"},
{"lineNum":"  245","line":"        .lesser_equal_int => {"},
{"lineNum":"  246","line":"            const data = try self.binop_load_int(instr.src1.?, instr.src2.?);","class":"lineNoCov","hits":"0","possible_hits":"2",},
{"lineNum":"  247","line":"            self.memory.store_int(try self.effective_address(instr.dest.?), instr.dest.?.expanded_type_sizeof(), if (data.src1 <= data.src2) 1 else 0);","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"  248","line":"        },"},
{"lineNum":"  249","line":"        .lesser_equal_float => {"},
{"lineNum":"  250","line":"            const data = try self.binop_load_float(instr.src1.?, instr.src2.?);","class":"lineNoCov","hits":"0","possible_hits":"2",},
{"lineNum":"  251","line":"            self.memory.store_float(try self.effective_address(instr.dest.?), instr.dest.?.expanded_type_sizeof(), if (data.src1 <= data.src2) 1 else 0);","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"  252","line":"        },"},
{"lineNum":"  253","line":"        .add_int => {"},
{"lineNum":"  254","line":"            const data = try self.binop_load_int(instr.src1.?, instr.src2.?);","class":"lineCov","hits":"2","order":"4632","possible_hits":"2",},
{"lineNum":"  255","line":"            const val = data.src1 + data.src2;","class":"lineCov","hits":"1","order":"4638","possible_hits":"1",},
{"lineNum":"  256","line":"            try self.assert_fits(val, instr.dest.?.get_expanded_type(), \"addition result\", instr.span);","class":"lineCov","hits":"1","order":"4639","possible_hits":"1",},
{"lineNum":"  257","line":"            self.memory.store_int(try self.effective_address(instr.dest.?), instr.dest.?.expanded_type_sizeof(), val);","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"  258","line":"        },"},
{"lineNum":"  259","line":"        .add_float => {"},
{"lineNum":"  260","line":"            const data = try self.binop_load_float(instr.src1.?, instr.src2.?);","class":"lineNoCov","hits":"0","possible_hits":"2",},
{"lineNum":"  261","line":"            self.memory.store_float(try self.effective_address(instr.dest.?), instr.dest.?.expanded_type_sizeof(), data.src1 + data.src2);","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"  262","line":"        },"},
{"lineNum":"  263","line":"        .sub_int => {"},
{"lineNum":"  264","line":"            const data = try self.binop_load_int(instr.src1.?, instr.src2.?);","class":"lineNoCov","hits":"0","possible_hits":"2",},
{"lineNum":"  265","line":"            const val = data.src1 - data.src2;","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"  266","line":"            try self.assert_fits(val, instr.dest.?.get_expanded_type(), \"subtraction result\", instr.span);","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"  267","line":"            self.memory.store_int(try self.effective_address(instr.dest.?), instr.dest.?.expanded_type_sizeof(), val);","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"  268","line":"        },"},
{"lineNum":"  269","line":"        .sub_float => {"},
{"lineNum":"  270","line":"            const data = try self.binop_load_float(instr.src1.?, instr.src2.?);","class":"lineNoCov","hits":"0","possible_hits":"2",},
{"lineNum":"  271","line":"            self.memory.store_float(try self.effective_address(instr.dest.?), instr.dest.?.expanded_type_sizeof(), data.src1 - data.src2);","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"  272","line":"        },"},
{"lineNum":"  273","line":"        .mult_int => {"},
{"lineNum":"  274","line":"            const data = try self.binop_load_int(instr.src1.?, instr.src2.?);","class":"lineNoCov","hits":"0","possible_hits":"2",},
{"lineNum":"  275","line":"            const val = data.src1 * data.src2;","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"  276","line":"            try self.assert_fits(val, instr.dest.?.get_expanded_type(), \"multiplication result\", instr.span);","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"  277","line":"            self.memory.store_int(try self.effective_address(instr.dest.?), instr.dest.?.expanded_type_sizeof(), val);","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"  278","line":"        },"},
{"lineNum":"  279","line":"        .mult_float => {"},
{"lineNum":"  280","line":"            const data = try self.binop_load_float(instr.src1.?, instr.src2.?);","class":"lineNoCov","hits":"0","possible_hits":"2",},
{"lineNum":"  281","line":"            self.memory.store_float(try self.effective_address(instr.dest.?), instr.dest.?.expanded_type_sizeof(), data.src1 * data.src2);","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"  282","line":"        },"},
{"lineNum":"  283","line":"        .div_int => {"},
{"lineNum":"  284","line":"            const data = try self.binop_load_int(instr.src1.?, instr.src2.?);","class":"lineNoCov","hits":"0","possible_hits":"2",},
{"lineNum":"  285","line":"            if (data.src2 == 0) {","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"  286","line":"                self.debug_call_stack.append(instr.span) catch unreachable;","class":"lineNoCov","hits":"0","possible_hits":"2",},
{"lineNum":"  287","line":"                return self.interpreter_panic(\"interpreter error: division by zero\\n\", .{});","class":"lineNoCov","hits":"0","possible_hits":"2",},
{"lineNum":"  288","line":"            }"},
{"lineNum":"  289","line":"            const val = @divTrunc(data.src1, data.src2);","class":"lineNoCov","hits":"0","possible_hits":"3",},
{"lineNum":"  290","line":"            try self.assert_fits(val, instr.dest.?.get_expanded_type(), \"division result\", instr.span);","class":"lineNoCov","hits":"0","possible_hits":"2",},
{"lineNum":"  291","line":"            self.memory.store_int(try self.effective_address(instr.dest.?), instr.dest.?.expanded_type_sizeof(), val);","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"  292","line":"        },"},
{"lineNum":"  293","line":"        .div_float => {"},
{"lineNum":"  294","line":"            const data = try self.binop_load_float(instr.src1.?, instr.src2.?);","class":"lineNoCov","hits":"0","possible_hits":"2",},
{"lineNum":"  295","line":"            self.memory.store_float(try self.effective_address(instr.dest.?), instr.dest.?.expanded_type_sizeof(), @divTrunc(data.src1, data.src2));","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"  296","line":"        },"},
{"lineNum":"  297","line":"        .mod => {"},
{"lineNum":"  298","line":"            const data = try self.binop_load_int(instr.src1.?, instr.src2.?);","class":"lineNoCov","hits":"0","possible_hits":"2",},
{"lineNum":"  299","line":"            const val = @rem(data.src1, data.src2);","class":"lineNoCov","hits":"0","possible_hits":"2",},
{"lineNum":"  300","line":"            try self.assert_fits(val, instr.dest.?.get_expanded_type(), \"modulus result\", instr.span);","class":"lineNoCov","hits":"0","possible_hits":"2",},
{"lineNum":"  301","line":"            self.memory.store_int(try self.effective_address(instr.dest.?), instr.dest.?.expanded_type_sizeof(), val);","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"  302","line":"        },"},
{"lineNum":"  303","line":"        .get_tag => { // gets the tag of a union value. The tag will be located in the last slot"},
{"lineNum":"  304","line":"            const tag_offset = instr.src1.?.expanded_type_sizeof() - 8;","class":"lineNoCov","hits":"0","possible_hits":"2",},
{"lineNum":"  305","line":"            std.debug.assert(instr.dest.?.expanded_type_sizeof() == 8);","class":"lineNoCov","hits":"0","possible_hits":"2",},
{"lineNum":"  306","line":"            self.memory.move(try self.effective_address(instr.dest.?), try self.effective_address(instr.src1.?) + tag_offset, 8);","class":"lineNoCov","hits":"0","possible_hits":"2",},
{"lineNum":"  307","line":"        },"},
{"lineNum":"  308","line":"        .jump => {"},
{"lineNum":"  309","line":"            const module_uid = (self.curr_module() catch unreachable).uid;","class":"lineCov","hits":"3","order":"3132","possible_hits":"3",},
{"lineNum":"  310","line":"            if (instr.data.jump_bb.next) |next| {","class":"lineCov","hits":"2","order":"3133","possible_hits":"2",},
{"lineNum":"  311","line":"                self.instruction_pointer.inst_idx = next.offset_table.get(module_uid).?;","class":"lineCov","hits":"2","order":"6196","possible_hits":"2",},
{"lineNum":"  312","line":"            } else {"},
{"lineNum":"  313","line":"                self.ret();","class":"lineCov","hits":"3","order":"3134","possible_hits":"3",},
{"lineNum":"  314","line":"            }"},
{"lineNum":"  315","line":"        },"},
{"lineNum":"  316","line":"        .branch_if_false => {"},
{"lineNum":"  317","line":"            const module_uid = (self.curr_module() catch unreachable).uid;","class":"lineNoCov","hits":"0","possible_hits":"3",},
{"lineNum":"  318","line":"            if (self.memory.load_int(try self.effective_address(instr.src1.?), instr.src1.?.expanded_type_sizeof()) != 0) {","class":"lineNoCov","hits":"0","possible_hits":"2",},
{"lineNum":"  319","line":"                if (instr.data.branch_bb.next) |next| {","class":"lineNoCov","hits":"0","possible_hits":"2",},
{"lineNum":"  320","line":"                    self.instruction_pointer.inst_idx = next.offset_table.get(module_uid).?;","class":"lineNoCov","hits":"0","possible_hits":"2",},
{"lineNum":"  321","line":"                } else {"},
{"lineNum":"  322","line":"                    self.ret();","class":"lineNoCov","hits":"0","possible_hits":"3",},
{"lineNum":"  323","line":"                }"},
{"lineNum":"  324","line":"            } else {"},
{"lineNum":"  325","line":"                if (instr.data.branch_bb.branch) |branch| {","class":"lineNoCov","hits":"0","possible_hits":"2",},
{"lineNum":"  326","line":"                    self.instruction_pointer.inst_idx = branch.offset_table.get(module_uid).?;","class":"lineNoCov","hits":"0","possible_hits":"2",},
{"lineNum":"  327","line":"                } else {"},
{"lineNum":"  328","line":"                    self.ret();","class":"lineNoCov","hits":"0","possible_hits":"4",},
{"lineNum":"  329","line":"                }"},
{"lineNum":"  330","line":"            }"},
{"lineNum":"  331","line":"        },"},
{"lineNum":"  332","line":"        .call => {"},
{"lineNum":"  333","line":"            // std.debug.print(\"symbol instr src: {}\\n\", .{instr.src1.?});"},
{"lineNum":"  334","line":"            const symbol_loc = try self.effective_address(instr.src1.?);","class":"lineCov","hits":"2","order":"4579","possible_hits":"2",},
{"lineNum":"  335","line":"            // std.debug.print(\"symbol_loc: {}\\n\", .{symbol_loc});"},
{"lineNum":"  336","line":"            const symbol_int = @as(usize, @intCast(self.memory.load_int(symbol_loc, 8)));","class":"lineCov","hits":"1","order":"4580","possible_hits":"1",},
{"lineNum":"  337","line":"            // std.debug.print(\"symbol_int: {}\\n\", .{symbol_int});"},
{"lineNum":"  338","line":"            const symbol: *Symbol = @ptrFromInt(symbol_int);","class":"lineCov","hits":"2","order":"4581","possible_hits":"2",},
{"lineNum":"  339","line":""},
{"lineNum":"  340","line":"            // Intercept method calls to builtin methods"},
{"lineNum":"  341","line":"            if (symbol.represents_method(core_.package_type, \"find\")) {","class":"lineCov","hits":"1","order":"4582","possible_hits":"1",},
{"lineNum":"  342","line":"                return self.package_find(instr);","class":"linePartCov","hits":"1","order":"4589","possible_hits":"2",},
{"lineNum":"  343","line":"            }"},
{"lineNum":"  344","line":""},
{"lineNum":"  345","line":"            try self.call(symbol, instr.dest.?, instr.data.call.arg_lval_list); // TODO: Comptime contexts","class":"lineCov","hits":"2","order":"4590","possible_hits":"2",},
{"lineNum":"  346","line":"        },"},
{"lineNum":"  347","line":"        .invoke => {"},
{"lineNum":"  348","line":"            const symbol_loc = try self.effective_address(instr.data.invoke.method_decl_lval.?);","class":"lineNoCov","hits":"0","possible_hits":"2",},
{"lineNum":"  349","line":"            const symbol_int = @as(usize, @intCast(self.memory.load_int(symbol_loc, 8)));","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"  350","line":"            const symbol: *Symbol = @ptrFromInt(symbol_int);","class":"lineNoCov","hits":"0","possible_hits":"2",},
{"lineNum":"  351","line":""},
{"lineNum":"  352","line":"            try self.call(symbol, instr.dest.?, instr.data.invoke.arg_lval_list); // TODO: Comptime contexts","class":"lineNoCov","hits":"0","possible_hits":"2",},
{"lineNum":"  353","line":"        },"},
{"lineNum":"  354","line":"        .push_stack_trace => { // Pushes a static span/code to the lines array if debug mode is on"},
{"lineNum":"  355","line":"            self.debug_call_stack.append(instr.span) catch unreachable;","class":"lineCov","hits":"2","order":"4578","possible_hits":"2",},
{"lineNum":"  356","line":"        },"},
{"lineNum":"  357","line":"        .pop_stack_trace => { // Pops a message off the stack after a function is successfully called"},
{"lineNum":"  358","line":"            _ = self.debug_call_stack.pop();","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"  359","line":"        },"},
{"lineNum":"  360","line":"        .panic => { // if debug mode is on, panics with a message, unrolls lines stack, exits"},
{"lineNum":"  361","line":"            return self.interpreter_panic(\"interpreter error: reached unreachable code\\n\", .{});","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"  362","line":"        },"},
{"lineNum":"  363","line":"        else => std.debug.panic(\"interpreter error: interpreter.zig::interpret(): Unimplemented Instruction for {s}\\n\", .{@tagName(instr.kind)}),","class":"linePartCov","hits":"1","order":"3094","possible_hits":"3",},
{"lineNum":"  364","line":"    }"},
{"lineNum":"  365","line":"}"},
{"lineNum":"  366","line":""},
{"lineNum":"  367","line":"fn package_find(self: *Self, instr: *Instruction) !void {","class":"lineNoCov","hits":"0","possible_hits":"2",},
{"lineNum":"  368","line":"    const arg: *lval_.L_Value = instr.data.call.arg_lval_list.items[@as(usize, @intCast(0))];","class":"lineNoCov","hits":"0","possible_hits":"2",},
{"lineNum":"  369","line":"    const interned_strings = self.ctx.lookup_interned_string_set(self.modules.get(1).?.uid).?;","class":"lineNoCov","hits":"0","possible_hits":"3",},
{"lineNum":"  370","line":"    const src_ast = try self.extract_ast(try self.effective_address(arg), core_.package_source_type.expand_identifier(), instr.span);","class":"lineNoCov","hits":"0","possible_hits":"2",},
{"lineNum":"  371","line":"    const current_module_path = (self.curr_module() catch unreachable).absolute_path;","class":"lineNoCov","hits":"0","possible_hits":"2",},
{"lineNum":"  372","line":""},
{"lineNum":"  373","line":"    if (builtin_.package_find(self.ctx, self, current_module_path, src_ast)) |package_info| {","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"  374","line":"        const adrs = package_info.package_adrs;","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"  375","line":"        // Store the directory of the package inside the package struct before returning"},
{"lineNum":"  376","line":"        const dir_string = interned_strings.add_string(package_info.package_dirname, self.modules.get(1).?.uid);","class":"lineNoCov","hits":"0","possible_hits":"3",},
{"lineNum":"  377","line":"        const dir_offset = core_.package_type.struct_type.get_offset_field(\"dir\");","class":"lineNoCov","hits":"0","possible_hits":"3",},
{"lineNum":"  378","line":"        self.memory.store(Interned_String_Set.String_Idx, adrs + dir_offset, dir_string);","class":"lineNoCov","hits":"0","possible_hits":"2",},
{"lineNum":"  379","line":"        // Store the address of the package in the retval"},
{"lineNum":"  380","line":"        const ret_addr = try self.effective_address(instr.dest.?);","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"  381","line":"        self.memory.store_int(ret_addr, 8, adrs);","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"  382","line":"    } else |_| {"},
{"lineNum":"  383","line":"        return self.interpreter_panic(\"interpreter error: cannot find package\\n\", .{});","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"  384","line":"    }"},
{"lineNum":"  385","line":"    return;","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"  386","line":"}"},
{"lineNum":"  387","line":""},
{"lineNum":"  388","line":"pub fn load_module(self: *Self, module: *module_.Module) void {","class":"lineCov","hits":"2","order":"3075","possible_hits":"2",},
{"lineNum":"  389","line":"    self.modules.put(module.uid, module) catch unreachable;","class":"lineCov","hits":"1","order":"3076","possible_hits":"1",},
{"lineNum":"  390","line":"}"},
{"lineNum":"  391","line":""},
{"lineNum":"  392","line":"/// Sets up the caller\'s stack frame, pushes function arguments in reverse order, stores the return value location,"},
{"lineNum":"  393","line":"/// and then jumps to the function\'s code."},
{"lineNum":"  394","line":"pub fn call(self: *Self, function_symbol: *Symbol, retval_place: *lval_.L_Value, args_list: std.array_list.Managed(*lval_.L_Value)) error{CompileError}!void {","class":"lineCov","hits":"2","order":"4591","possible_hits":"2",},
{"lineNum":"  395","line":"    self.call_depth += 1;","class":"lineCov","hits":"1","order":"4592","possible_hits":"1",},
{"lineNum":"  396","line":"    // Save old stack pointer"},
{"lineNum":"  397","line":"    const old_sp = self.stack_pointer;","class":"lineCov","hits":"1","order":"4593","possible_hits":"1",},
{"lineNum":"  398","line":"    self.stack_pointer = alignment_.next_alignment(self.stack_pointer, 8); // align stack pointer to 8 before pushing args","class":"lineCov","hits":"1","order":"4594","possible_hits":"1",},
{"lineNum":"  399","line":""},
{"lineNum":"  400","line":"    // push args in reverse order"},
{"lineNum":"  401","line":"    var i: i64 = @as(i64, @intCast(args_list.items.len)) - 1;","class":"lineCov","hits":"1","order":"4595","possible_hits":"1",},
{"lineNum":"  402","line":"    while (i >= 0) : (i -= 1) {","class":"linePartCov","hits":"2","order":"4596","possible_hits":"3",},
{"lineNum":"  403","line":"        const arg = args_list.items[@as(usize, @intCast(i))];","class":"linePartCov","hits":"2","order":"4597","possible_hits":"3",},
{"lineNum":"  404","line":"        const size = arg.get_expanded_type().sizeof();","class":"lineCov","hits":"1","order":"4598","possible_hits":"1",},
{"lineNum":"  405","line":"        const alignof = arg.expanded_type_alignof();","class":"lineCov","hits":"1","order":"4599","possible_hits":"1",},
{"lineNum":"  406","line":"        self.stack_pointer = alignment_.next_alignment(self.stack_pointer, alignof);","class":"lineCov","hits":"1","order":"4600","possible_hits":"1",},
{"lineNum":"  407","line":"        try self.push_move(try self.effective_address(arg), size);","class":"linePartCov","hits":"1","order":"4601","possible_hits":"2",},
{"lineNum":"  408","line":"    }","class":"lineCov","hits":"1","order":"4610","possible_hits":"1",},
{"lineNum":"  409","line":"    self.stack_pointer = alignment_.next_alignment(self.stack_pointer, 8);","class":"lineCov","hits":"1","order":"4611","possible_hits":"1",},
{"lineNum":"  410","line":""},
{"lineNum":"  411","line":"    // Setup next stackframe"},
{"lineNum":"  412","line":"    try self.push_int(8, try self.effective_address(retval_place)); // push return-value address","class":"linePartCov","hits":"1","order":"4612","possible_hits":"2",},
{"lineNum":"  413","line":"    try self.push_int(8, old_sp); //                                push old sp","class":"lineCov","hits":"1","order":"4617","possible_hits":"1",},
{"lineNum":"  414","line":"    try self.push_int(8, self.base_pointer); //                     push bp","class":"lineCov","hits":"1","order":"4618","possible_hits":"1",},
{"lineNum":"  415","line":"    try self.push(Instruction_Pointer, self.instruction_pointer); //          push return address","class":"lineCov","hits":"1","order":"4619","possible_hits":"1",},
{"lineNum":"  416","line":"    self.base_pointer = self.stack_pointer - 8; //                        bp := sp -1","class":"lineCov","hits":"1","order":"4625","possible_hits":"1",},
{"lineNum":"  417","line":""},
{"lineNum":"  418","line":"    // allocate space for locals"},
{"lineNum":"  419","line":"    const local_size_bytes = function_symbol.cfg.?.locals_size.?;","class":"lineCov","hits":"2","order":"4626","possible_hits":"2",},
{"lineNum":"  420","line":"    try self.memory_check(local_size_bytes);","class":"linePartCov","hits":"1","order":"4627","possible_hits":"2",},
{"lineNum":"  421","line":"    self.stack_pointer += local_size_bytes;","class":"lineCov","hits":"1","order":"4628","possible_hits":"1",},
{"lineNum":"  422","line":""},
{"lineNum":"  423","line":"    // jump to symbol addr"},
{"lineNum":"  424","line":"    self.instruction_pointer = Instruction_Pointer{","class":"lineCov","hits":"1","order":"4629","possible_hits":"1",},
{"lineNum":"  425","line":"        .module_uid = function_symbol.scope.module.?.uid,","class":"lineCov","hits":"2","order":"4630","possible_hits":"2",},
{"lineNum":"  426","line":"        .inst_idx = function_symbol.cfg.?.offset_table.get(function_symbol.scope.module.?.uid).?,","class":"lineCov","hits":"2","order":"4631","possible_hits":"2",},
{"lineNum":"  427","line":"    };"},
{"lineNum":"  428","line":"}"},
{"lineNum":"  429","line":""},
{"lineNum":"  430","line":"/// Tears down the stack frame, and jumps back to the caller\'s location"},
{"lineNum":"  431","line":"inline fn ret(self: *Self) void {","class":"linePartCov","hits":"1","order":"3135","possible_hits":"3",},
{"lineNum":"  432","line":"    self.call_depth -= 1;","class":"linePartCov","hits":"1","order":"3136","possible_hits":"6",},
{"lineNum":"  433","line":"    // deallocate locals"},
{"lineNum":"  434","line":"    self.stack_pointer = self.base_pointer + 8;","class":"linePartCov","hits":"1","order":"3137","possible_hits":"3",},
{"lineNum":"  435","line":"    // jump to return-address"},
{"lineNum":"  436","line":"    self.instruction_pointer = self.pop(Instruction_Pointer);","class":"linePartCov","hits":"1","order":"3138","possible_hits":"3",},
{"lineNum":"  437","line":"    // restore previous base-pointer"},
{"lineNum":"  438","line":"    self.base_pointer = @as(i64, @intCast(self.pop_int(8)));","class":"linePartCov","hits":"1","order":"3143","possible_hits":"3",},
{"lineNum":"  439","line":"    // restore previous stack-pointer, deallocate params, deallocate return-pointer"},
{"lineNum":"  440","line":"    self.stack_pointer = @as(i64, @intCast(self.pop_int(8)));","class":"linePartCov","hits":"1","order":"3151","possible_hits":"3",},
{"lineNum":"  441","line":"    // self.print_registers();"},
{"lineNum":"  442","line":"}"},
{"lineNum":"  443","line":""},
{"lineNum":"  444","line":"pub fn alloc(self: *Self, nbytes: i64, align_to: i64) error{CompileError}!usize {","class":"lineNoCov","hits":"0","possible_hits":"2",},
{"lineNum":"  445","line":"    std.debug.assert(nbytes > 0);","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"  446","line":"    std.debug.assert(align_to == 1 or align_to == 2 or align_to == 4 or align_to == 8);","class":"lineNoCov","hits":"0","possible_hits":"2",},
{"lineNum":"  447","line":""},
{"lineNum":"  448","line":"    try self.memory_check(nbytes);","class":"lineNoCov","hits":"0","possible_hits":"2",},
{"lineNum":"  449","line":"    self.bump_alloc_pointer -= nbytes;","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"  450","line":"    const alignment_subtract = @rem(self.bump_alloc_pointer, align_to);","class":"lineNoCov","hits":"0","possible_hits":"2",},
{"lineNum":"  451","line":"    try self.memory_check(alignment_subtract);","class":"lineNoCov","hits":"0","possible_hits":"2",},
{"lineNum":"  452","line":"    self.bump_alloc_pointer -= alignment_subtract;","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"  453","line":"    return @intCast(self.bump_alloc_pointer);","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"  454","line":"}"},
{"lineNum":"  455","line":""},
{"lineNum":"  456","line":"/// Extracts an AST value from a specified memory address in interpreter\'s memory, based on the given AST type."},
{"lineNum":"  457","line":"pub fn extract_ast(self: *Self, address: i64, _type: *Type_AST, span: Span) Error!*ast_.AST {","class":"lineCov","hits":"2","order":"3153","possible_hits":"2",},
{"lineNum":"  458","line":"    // FIXME: High Cyclo"},
{"lineNum":"  459","line":"    std.debug.assert(address >= 0);","class":"lineCov","hits":"1","order":"3154","possible_hits":"1",},
{"lineNum":"  460","line":"    switch (_type.*) {","class":"linePartCov","hits":"1","order":"3155","possible_hits":"3",},
{"lineNum":"  461","line":"        .identifier => return self.extract_identifier(address, _type, span),","class":"lineCov","hits":"2","order":"3247","possible_hits":"2",},
{"lineNum":"  462","line":"        .addr_of => return ast_.AST.create_int(","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"  463","line":"            Token.init_simple(\"unsigned int\"),","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"  464","line":"            self.memory.load_int(address, 8),","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"  465","line":"            self.ctx.allocator(),","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"  466","line":"        ),"},
{"lineNum":"  467","line":"        .unit_type => return ast_.AST.create_unit_value(_type.token(), self.ctx.allocator()),","class":"lineCov","hits":"1","order":"3176","possible_hits":"1",},
{"lineNum":"  468","line":"        .enum_type => return self.extract_enum_type(address, _type, span),","class":"lineCov","hits":"2","order":"3166","possible_hits":"2",},
{"lineNum":"  469","line":"        .struct_type => return self.extract_struct_type(address, _type, span),","class":"lineNoCov","hits":"0","possible_hits":"2",},
{"lineNum":"  470","line":"        .tuple_type => return self.extract_tuple_type(address, _type, span),","class":"lineNoCov","hits":"0","possible_hits":"2",},
{"lineNum":"  471","line":"        .array_of => return self.extract_array_type(address, _type, span),","class":"lineCov","hits":"2","order":"3156","possible_hits":"2",},
{"lineNum":"  472","line":"        .function => return self.extract_function(address),","class":"lineNoCov","hits":"0","possible_hits":"2",},
{"lineNum":"  473","line":"        .untagged_sum_type => {"},
{"lineNum":"  474","line":"            self.ctx.errors.add_error(errs_.Error{ .basic = .{","class":"lineCov","hits":"1","order":"4910","possible_hits":"1",},
{"lineNum":"  475","line":"                .span = span,"},
{"lineNum":"  476","line":"                .msg = \"comptime untagged enum values cannot propagate to runtime\","},
{"lineNum":"  477","line":"            } });"},
{"lineNum":"  478","line":"            return error.CompileError;","class":"lineCov","hits":"1","order":"4911","possible_hits":"1",},
{"lineNum":"  479","line":"        },"},
{"lineNum":"  480","line":"        .annotation => return try self.extract_ast(address, _type.child(), span),","class":"linePartCov","hits":"1","order":"3175","possible_hits":"2",},
{"lineNum":"  481","line":"        else => std.debug.panic(\"interpreter error: unimplemented extract_ast() for: AST.{s}\\n\", .{@tagName(_type.*)}),","class":"lineNoCov","hits":"0","possible_hits":"2",},
{"lineNum":"  482","line":"    }"},
{"lineNum":"  483","line":"}"},
{"lineNum":"  484","line":""},
{"lineNum":"  485","line":"fn extract_identifier(self: *Self, address: i64, identifier_type: *Type_AST, span: Span) Error!*ast_.AST {","class":"lineCov","hits":"2","order":"3248","possible_hits":"2",},
{"lineNum":"  486","line":"    const info = prelude_.info_from_name(identifier_type.token().data);","class":"lineCov","hits":"1","order":"3249","possible_hits":"1",},
{"lineNum":"  487","line":"    if (info == null) {","class":"lineCov","hits":"1","order":"3250","possible_hits":"1",},
{"lineNum":"  488","line":"        return try self.extract_ast(address, identifier_type.symbol().?.init_typedef().?, span);","class":"lineCov","hits":"1","order":"3251","possible_hits":"1",},
{"lineNum":"  489","line":"    }"},
{"lineNum":"  490","line":"    switch (info.?.type_kind) {","class":"linePartCov","hits":"2","order":"3252","possible_hits":"3",},
{"lineNum":"  491","line":"        .type => {"},
{"lineNum":"  492","line":"            const stack_value = self.memory.load_unsigned_int(address, 8);","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"  493","line":"            if (stack_value == 0xAAAAAAAAAAAAAAAA) { // NOTE: This only works if the interpreter never overwrites this address...","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"  494","line":"                return prelude_.unit_value;","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"  495","line":"            } else {"},
{"lineNum":"  496","line":"                return @ptrFromInt(stack_value);","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"  497","line":"            }"},
{"lineNum":"  498","line":"        },"},
{"lineNum":"  499","line":"        .string => {"},
{"lineNum":"  500","line":"            const idx = self.memory.load(Interned_String_Set.String_Idx, address);","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"  501","line":"            const interned_strings = self.ctx.module_interned_strings.get(idx.module_uid);","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"  502","line":"            std.debug.assert(idx.module_uid == interned_strings.?.uid);","class":"lineNoCov","hits":"0","possible_hits":"3",},
{"lineNum":"  503","line":"            const string = interned_strings.?.items()[idx.string_idx];","class":"lineNoCov","hits":"0","possible_hits":"3",},
{"lineNum":"  504","line":"            return ast_.AST.create_string(Token.init_simple(\"\\\"\"), string, self.ctx.allocator());","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"  505","line":"        },"},
{"lineNum":"  506","line":"        .none => unreachable,","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"  507","line":"        .boolean => {"},
{"lineNum":"  508","line":"            const val = self.memory.load_int(address, info.?.size);","class":"lineNoCov","hits":"0","possible_hits":"3",},
{"lineNum":"  509","line":"            if (val == 0) {","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"  510","line":"                return ast_.AST.create_false(Token.init_simple(\"false\"), self.ctx.allocator());","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"  511","line":"            } else {"},
{"lineNum":"  512","line":"                return ast_.AST.create_true(Token.init_simple(\"true\"), self.ctx.allocator());","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"  513","line":"            }"},
{"lineNum":"  514","line":"        },"},
{"lineNum":"  515","line":"        .signed_integer => {"},
{"lineNum":"  516","line":"            const retval = ast_.AST.create_int(","class":"lineCov","hits":"1","order":"3256","possible_hits":"1",},
{"lineNum":"  517","line":"                Token.init_simple(\"signed int\"),","class":"lineCov","hits":"1","order":"3253","possible_hits":"1",},
{"lineNum":"  518","line":"                self.memory.load_int(address, info.?.size),","class":"lineCov","hits":"3","order":"3254","possible_hits":"3",},
{"lineNum":"  519","line":"                self.ctx.allocator(),","class":"lineCov","hits":"1","order":"3255","possible_hits":"1",},
{"lineNum":"  520","line":"            );"},
{"lineNum":"  521","line":"            // retval.set_represents(identifier_type);"},
{"lineNum":"  522","line":"            return retval;","class":"lineCov","hits":"1","order":"3257","possible_hits":"1",},
{"lineNum":"  523","line":"        },"},
{"lineNum":"  524","line":"        .unsigned_integer => {"},
{"lineNum":"  525","line":"            const retval = ast_.AST.create_int(","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"  526","line":"                Token.init_simple(\"unsigned int\"),","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"  527","line":"                self.memory.load_int(address, info.?.size),","class":"lineNoCov","hits":"0","possible_hits":"3",},
{"lineNum":"  528","line":"                self.ctx.allocator(),","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"  529","line":"            );"},
{"lineNum":"  530","line":"            // retval.set_represents(identifier_type);"},
{"lineNum":"  531","line":"            return retval;","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"  532","line":"        },"},
{"lineNum":"  533","line":"        .floating_point => {"},
{"lineNum":"  534","line":"            const retval = ast_.AST.create_float(","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"  535","line":"                Token.init_simple(\"float\"),","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"  536","line":"                self.memory.load_float(address, info.?.size),","class":"lineNoCov","hits":"0","possible_hits":"3",},
{"lineNum":"  537","line":"                self.ctx.allocator(),","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"  538","line":"            );"},
{"lineNum":"  539","line":"            // retval.set_represents(identifier_type);"},
{"lineNum":"  540","line":"            return retval;","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"  541","line":"        },"},
{"lineNum":"  542","line":"    }"},
{"lineNum":"  543","line":"}"},
{"lineNum":"  544","line":""},
{"lineNum":"  545","line":"fn extract_function(self: *Self, address: i64) Error!*ast_.AST {","class":"lineNoCov","hits":"0","possible_hits":"2",},
{"lineNum":"  546","line":"    const stack_value = @as(usize, @intCast(self.memory.load_int(address, 8)));","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"  547","line":"    const symbol: *Symbol = @ptrFromInt(stack_value);","class":"lineNoCov","hits":"0","possible_hits":"2",},
{"lineNum":"  548","line":"    const ast = ast_.AST.create_pattern_symbol(","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"  549","line":"        Token.init_simple(\"function\"),","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"  550","line":"        .@\"fn\","},
{"lineNum":"  551","line":"        .local,"},
{"lineNum":"  552","line":"        symbol.name,","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"  553","line":"        self.ctx.allocator(),","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"  554","line":"    );"},
{"lineNum":"  555","line":"    ast.set_symbol(symbol);","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"  556","line":"    return ast;","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"  557","line":"}"},
{"lineNum":"  558","line":""},
{"lineNum":"  559","line":"fn extract_enum_type(self: *Self, address: i64, enum_type: *Type_AST, span: Span) Error!*ast_.AST {","class":"lineCov","hits":"2","order":"3167","possible_hits":"2",},
{"lineNum":"  560","line":"    // self.print_memory(@intCast(address), @intCast(address + _type.sizeof()));"},
{"lineNum":"  561","line":"    const tag = self.memory.load_int(address + enum_type.sizeof() - 8, 8);","class":"lineCov","hits":"1","order":"3168","possible_hits":"1",},
{"lineNum":"  562","line":"    const token = enum_type.children().items[@intCast(tag)].annotation.pattern.token();","class":"lineCov","hits":"2","order":"3169","possible_hits":"2",},
{"lineNum":"  563","line":"    var retval = ast_.AST.create_enum_value(token, self.ctx.allocator());","class":"lineCov","hits":"1","order":"3170","possible_hits":"1",},
{"lineNum":"  564","line":"    retval.set_pos(@as(usize, @intCast(tag)));","class":"linePartCov","hits":"1","order":"3171","possible_hits":"2",},
{"lineNum":"  565","line":"    retval.enum_value.base = enum_type;","class":"lineCov","hits":"2","order":"3172","possible_hits":"2",},
{"lineNum":"  566","line":"    const proper_term: *Type_AST = enum_type.children().items[@as(usize, @intCast(tag))];","class":"linePartCov","hits":"2","order":"3173","possible_hits":"3",},
{"lineNum":"  567","line":"    retval.enum_value.init = try self.extract_ast(address, proper_term, span);","class":"lineCov","hits":"2","order":"3174","possible_hits":"2",},
{"lineNum":"  568","line":"    return retval;","class":"lineCov","hits":"1","order":"3177","possible_hits":"1",},
{"lineNum":"  569","line":"}"},
{"lineNum":"  570","line":""},
{"lineNum":"  571","line":"fn extract_struct_type(self: *Self, address: i64, struct_type: *Type_AST, span: Span) Error!*ast_.AST {","class":"lineNoCov","hits":"0","possible_hits":"2",},
{"lineNum":"  572","line":"    if (struct_type.types_match(prelude_.string_type)) {","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"  573","line":"        const idx = self.memory.load(Interned_String_Set.String_Idx, address);","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"  574","line":"        const interned_strings = self.ctx.module_interned_strings.get(idx.module_uid);","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"  575","line":"        std.debug.assert(idx.module_uid == interned_strings.?.uid);","class":"lineNoCov","hits":"0","possible_hits":"3",},
{"lineNum":"  576","line":"        const string = interned_strings.?.items()[idx.string_idx];","class":"lineNoCov","hits":"0","possible_hits":"3",},
{"lineNum":"  577","line":"        return ast_.AST.create_string(Token.init_simple(\"\\\"\"), string, self.ctx.allocator());","class":"lineNoCov","hits":"0","possible_hits":"2",},
{"lineNum":"  578","line":"    }"},
{"lineNum":"  579","line":"    var value_terms = std.array_list.Managed(*ast_.AST).init(self.ctx.allocator());","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"  580","line":"    errdefer value_terms.deinit();","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"  581","line":"    for (0.., struct_type.children().items) |i, term| {","class":"lineNoCov","hits":"0","possible_hits":"3",},
{"lineNum":"  582","line":"        // std.debug.print(\"term:{}\\n\", .{i});"},
{"lineNum":"  583","line":"        const offset = struct_type.struct_type.get_offset(i);","class":"lineNoCov","hits":"0","possible_hits":"3",},
{"lineNum":"  584","line":"        // std.debug.print(\"offset:{}\\n\", .{offset});"},
{"lineNum":"  585","line":"        const extracted_term = try self.extract_ast(address + offset, term, span);","class":"lineNoCov","hits":"0","possible_hits":"3",},
{"lineNum":"  586","line":"        // std.debug.print(\"extracted_term:{}\\n\", .{extracted_term});"},
{"lineNum":"  587","line":"        value_terms.append(extracted_term) catch unreachable;","class":"lineNoCov","hits":"0","possible_hits":"2",},
{"lineNum":"  588","line":"    }","class":"lineNoCov","hits":"0","possible_hits":"3",},
{"lineNum":"  589","line":"    return ast_.AST.create_struct_value(struct_type.token(), struct_type, value_terms, self.ctx.allocator());","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"  590","line":"}"},
{"lineNum":"  591","line":""},
{"lineNum":"  592","line":"fn extract_tuple_type(self: *Self, address: i64, tuple_type: *Type_AST, span: Span) Error!*ast_.AST {","class":"lineNoCov","hits":"0","possible_hits":"2",},
{"lineNum":"  593","line":"    var value_terms = std.array_list.Managed(*ast_.AST).init(self.ctx.allocator());","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"  594","line":"    errdefer value_terms.deinit();","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"  595","line":"    for (0.., tuple_type.children().items) |i, term| {","class":"lineNoCov","hits":"0","possible_hits":"3",},
{"lineNum":"  596","line":"        // std.debug.print(\"term:{}\\n\", .{i});"},
{"lineNum":"  597","line":"        const offset = tuple_type.tuple_type.get_offset(i);","class":"lineNoCov","hits":"0","possible_hits":"3",},
{"lineNum":"  598","line":"        // std.debug.print(\"offset:{}\\n\", .{offset});"},
{"lineNum":"  599","line":"        const extracted_term = try self.extract_ast(address + offset, term, span);","class":"lineNoCov","hits":"0","possible_hits":"3",},
{"lineNum":"  600","line":"        // std.debug.print(\"extracted_term:{}\\n\", .{extracted_term});"},
{"lineNum":"  601","line":"        value_terms.append(extracted_term) catch unreachable;","class":"lineNoCov","hits":"0","possible_hits":"2",},
{"lineNum":"  602","line":"    }","class":"lineNoCov","hits":"0","possible_hits":"3",},
{"lineNum":"  603","line":"    return ast_.AST.create_tuple_value(tuple_type.token(), value_terms, self.ctx.allocator());","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"  604","line":"}"},
{"lineNum":"  605","line":""},
{"lineNum":"  606","line":"fn extract_array_type(self: *Self, address: i64, array_type: *Type_AST, span: Span) Error!*ast_.AST {","class":"lineCov","hits":"2","order":"3157","possible_hits":"2",},
{"lineNum":"  607","line":"    var value_terms = std.array_list.Managed(*ast_.AST).init(self.ctx.allocator());","class":"lineCov","hits":"1","order":"3158","possible_hits":"1",},
{"lineNum":"  608","line":"    errdefer value_terms.deinit();","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"  609","line":"    const length: usize = @intCast(array_type.array_of.len.int.data);","class":"lineCov","hits":"1","order":"3159","possible_hits":"1",},
{"lineNum":"  610","line":"    const elem_type = array_type.child();","class":"lineCov","hits":"1","order":"3160","possible_hits":"1",},
{"lineNum":"  611","line":"    for (0..length) |i| {","class":"lineCov","hits":"3","order":"3161","possible_hits":"3",},
{"lineNum":"  612","line":"        // std.debug.print(\"term:{}\\n\", .{i});"},
{"lineNum":"  613","line":"        const offset = array_type.array_of.get_offset(i);","class":"lineCov","hits":"3","order":"3162","possible_hits":"3",},
{"lineNum":"  614","line":"        // std.debug.print(\"offset:{}\\n\", .{offset});"},
{"lineNum":"  615","line":"        const extracted_term = try self.extract_ast(address + offset, elem_type, span);","class":"linePartCov","hits":"1","order":"3165","possible_hits":"3",},
{"lineNum":"  616","line":"        // std.debug.print(\"extracted_term:{}\\n\", .{extracted_term});"},
{"lineNum":"  617","line":"        value_terms.append(extracted_term) catch unreachable;","class":"lineCov","hits":"2","order":"3178","possible_hits":"2",},
{"lineNum":"  618","line":"    }","class":"lineCov","hits":"3","order":"3179","possible_hits":"3",},
{"lineNum":"  619","line":"    return ast_.AST.create_array_value(array_type.token(), value_terms, self.ctx.allocator());","class":"lineCov","hits":"1","order":"3180","possible_hits":"1",},
{"lineNum":"  620","line":"}"},
{"lineNum":"  621","line":""},
{"lineNum":"  622","line":"/// Prints the values of the interpreter\'s registers"},
{"lineNum":"  623","line":"fn print_registers(self: *Self) void {"},
{"lineNum":"  624","line":"    const module: ?*module_.Module = self.curr_module() catch null;"},
{"lineNum":"  625","line":"    std.debug.print(\"bp:0x{X} sp:0x{X} ip:[{s}#{}]@{X}\\n\", .{"},
{"lineNum":"  626","line":"        self.base_pointer,"},
{"lineNum":"  627","line":"        self.stack_pointer,"},
{"lineNum":"  628","line":"        if (module != null) module.?.name() else \"?\","},
{"lineNum":"  629","line":"        self.instruction_pointer.module_uid,"},
{"lineNum":"  630","line":"        self.instruction_pointer.inst_idx,"},
{"lineNum":"  631","line":"    });"},
{"lineNum":"  632","line":"}"},
{"lineNum":"  633","line":""},
{"lineNum":"  634","line":"/// Prints the contents of the interpreter\'s stack. Used for debugging."},
{"lineNum":"  635","line":"fn print_stack(self: *Self) void {"},
{"lineNum":"  636","line":"    self.memory.print_memory(0, @as(usize, @intCast(self.stack_pointer)));"},
{"lineNum":"  637","line":"}"},
{"lineNum":"  638","line":""},
{"lineNum":"  639","line":"fn print_debug_stack(self: *Self) void {"},
{"lineNum":"  640","line":"    for (0..self.debug_call_stack.items.len) |i| {"},
{"lineNum":"  641","line":"        const span = self.debug_call_stack.items[i];"},
{"lineNum":"  642","line":"        std.debug.print(\"{}: {s}\\n\", .{ i, span.line_text });"},
{"lineNum":"  643","line":"    }"},
{"lineNum":"  644","line":"    std.debug.print(\"\\n\", .{});"},
{"lineNum":"  645","line":"}"},
{"lineNum":"  646","line":""},
{"lineNum":"  647","line":"fn curr_instruction(self: *Self) error{CompileError}!*Instruction {","class":"lineCov","hits":"2","order":"3083","possible_hits":"2",},
{"lineNum":"  648","line":"    const module = try self.curr_module();","class":"lineCov","hits":"1","order":"3084","possible_hits":"1",},
{"lineNum":"  649","line":"    return module.instructions.items[@as(usize, @intCast(self.instruction_pointer.inst_idx))];","class":"lineCov","hits":"1","order":"3087","possible_hits":"1",},
{"lineNum":"  650","line":"}"},
{"lineNum":"  651","line":""},
{"lineNum":"  652","line":"pub fn curr_module(self: *Self) error{CompileError}!*module_.Module {","class":"lineCov","hits":"2","order":"3085","possible_hits":"2",},
{"lineNum":"  653","line":"    return self.modules.get(self.instruction_pointer.module_uid) orelse","class":"lineCov","hits":"3","order":"3086","possible_hits":"3",},
{"lineNum":"  654","line":"        self.interpreter_panic(\"interpreter error: attempt to use module 0x{X}, which hasn\'t been loaded yet\\n\", .{self.instruction_pointer.module_uid});","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"  655","line":"}"},
{"lineNum":"  656","line":""},
{"lineNum":"  657","line":"/// Loads integer values from the specified L_Values and returns a structure containing both the loaded"},
{"lineNum":"  658","line":"/// values."},
{"lineNum":"  659","line":"fn binop_load_int(self: *Self, src1: *lval_.L_Value, src2: *lval_.L_Value) !struct { src1: i128, src2: i128 } {","class":"lineCov","hits":"2","order":"4633","possible_hits":"2",},
{"lineNum":"  660","line":"    return .{","class":"lineCov","hits":"2","order":"4634","possible_hits":"2",},
{"lineNum":"  661","line":"        .src1 = self.memory.load_int(try self.effective_address(src1), src1.expanded_type_sizeof()),","class":"lineCov","hits":"1","order":"4635","possible_hits":"1",},
{"lineNum":"  662","line":"        .src2 = self.memory.load_int(try self.effective_address(src2), src2.expanded_type_sizeof()),","class":"lineCov","hits":"1","order":"4637","possible_hits":"1",},
{"lineNum":"  663","line":"    };"},
{"lineNum":"  664","line":"}"},
{"lineNum":"  665","line":""},
{"lineNum":"  666","line":"/// Loads floating-point values from the specified L_Values and returns a structure containing both the"},
{"lineNum":"  667","line":"/// loaded values."},
{"lineNum":"  668","line":"fn binop_load_float(self: *Self, src1: *lval_.L_Value, src2: *lval_.L_Value) !struct { src1: f64, src2: f64 } {","class":"lineNoCov","hits":"0","possible_hits":"2",},
{"lineNum":"  669","line":"    return .{","class":"lineNoCov","hits":"0","possible_hits":"2",},
{"lineNum":"  670","line":"        .src1 = self.memory.load_float(try self.effective_address(src1), src1.expanded_type_sizeof()),","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"  671","line":"        .src2 = self.memory.load_float(try self.effective_address(src2), src2.expanded_type_sizeof()),","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"  672","line":"    };"},
{"lineNum":"  673","line":"}"},
{"lineNum":"  674","line":""},
{"lineNum":"  675","line":"/// Copies memory blocks referenced by a list of L_Values to the specified destination address in the"},
{"lineNum":"  676","line":"/// interpreter\'s memory."},
{"lineNum":"  677","line":"fn move_lval_list("},
{"lineNum":"  678","line":"    self: *Self,"},
{"lineNum":"  679","line":"    dest: i64,"},
{"lineNum":"  680","line":"    list: *std.array_list.Managed(*lval_.L_Value),"},
{"lineNum":"  681","line":") !void {","class":"lineCov","hits":"2","order":"3111","possible_hits":"2",},
{"lineNum":"  682","line":"    std.debug.assert(dest >= 0);","class":"lineCov","hits":"1","order":"3112","possible_hits":"1",},
{"lineNum":"  683","line":"    var cursor = dest;","class":"lineCov","hits":"1","order":"3113","possible_hits":"1",},
{"lineNum":"  684","line":"    for (list.items) |lval| {","class":"lineCov","hits":"3","order":"3114","possible_hits":"3",},
{"lineNum":"  685","line":"        cursor = alignment_.next_alignment(cursor, lval.expanded_type_alignof());","class":"lineCov","hits":"1","order":"3115","possible_hits":"1",},
{"lineNum":"  686","line":"        const src = try self.effective_address(lval);","class":"linePartCov","hits":"1","order":"3118","possible_hits":"2",},
{"lineNum":"  687","line":"        const len = lval.expanded_type_sizeof();","class":"lineCov","hits":"1","order":"3119","possible_hits":"1",},
{"lineNum":"  688","line":"        // std.debug.print(\"dest:0x{X} src:0x{X} len:0x{X}\\n\", .{ cursor, src, len });"},
{"lineNum":"  689","line":"        // std.debug.print(\"{}\\n\", .{lval});"},
{"lineNum":"  690","line":"        self.memory.move(cursor, src, len);","class":"lineCov","hits":"1","order":"3120","possible_hits":"1",},
{"lineNum":"  691","line":"        cursor += len;","class":"lineCov","hits":"1","order":"3130","possible_hits":"1",},
{"lineNum":"  692","line":"    }","class":"lineCov","hits":"4","order":"3131","possible_hits":"4",},
{"lineNum":"  693","line":"}"},
{"lineNum":"  694","line":""},
{"lineNum":"  695","line":"/// Gets the effective address of an lvalue in the interpreter\'s memory."},
{"lineNum":"  696","line":"fn effective_address(self: *Self, lval: *lval_.L_Value) error{CompileError}!i64 {","class":"lineCov","hits":"2","order":"3099","possible_hits":"2",},
{"lineNum":"  697","line":"    switch (lval.*) {","class":"linePartCov","hits":"1","order":"3100","possible_hits":"2",},
{"lineNum":"  698","line":"        .symbver => {"},
{"lineNum":"  699","line":"            if (std.mem.eql(u8, \"_retval\", lval.symbver.symbol.name)) {","class":"lineCov","hits":"2","order":"3101","possible_hits":"2",},
{"lineNum":"  700","line":"                // Intercept stores to the return symbol of the form:"},
{"lineNum":"  701","line":"                //     retval := val"},
{"lineNum":"  702","line":"                // and replace with:"},
{"lineNum":"  703","line":"                //     retval^ := val"},
{"lineNum":"  704","line":"                return self.memory.load(i64, self.base_pointer + CFG.retval_offset);","class":"linePartCov","hits":"1","order":"3106","possible_hits":"2",},
{"lineNum":"  705","line":"            } else if (lval.symbver.symbol.offset == null) {","class":"lineCov","hits":"2","order":"3102","possible_hits":"2",},
{"lineNum":"  706","line":"                // If this is triggered for a temporary or a constant, you didn\'t offset it correctly"},
{"lineNum":"  707","line":"                if (lval.symbver.def != null) {","class":"lineNoCov","hits":"0","possible_hits":"2",},
{"lineNum":"  708","line":"                    // symbver def is real (Good fortune!!)"},
{"lineNum":"  709","line":"                    self.debug_call_stack.append(lval.symbver.def.?.span) catch unreachable;","class":"lineNoCov","hits":"0","possible_hits":"2",},
{"lineNum":"  710","line":"                    return self.interpreter_panic(\"interpreter error: variable `{s}` isn\'t comptime known\\n\", .{lval.symbver.symbol.name});","class":"lineNoCov","hits":"0","possible_hits":"2",},
{"lineNum":"  711","line":"                } else {"},
{"lineNum":"  712","line":"                    // symbver def is null, use symbol span instead (bad fortune!! curse on family)"},
{"lineNum":"  713","line":"                    self.debug_call_stack.append(lval.symbver.symbol.span()) catch unreachable;","class":"lineNoCov","hits":"0","possible_hits":"2",},
{"lineNum":"  714","line":"                    return self.interpreter_panic(\"interpreter error: variable `{s}` isn\'t comptime known\\n\", .{lval.symbver.symbol.name});","class":"lineNoCov","hits":"0","possible_hits":"2",},
{"lineNum":"  715","line":"                }"},
{"lineNum":"  716","line":"            } else {"},
{"lineNum":"  717","line":"                // std.debug.print(\"{s}\\n\", .{lval.symbver.symbol.name});"},
{"lineNum":"  718","line":"                return self.base_pointer + lval.symbver.symbol.offset.?;","class":"lineCov","hits":"2","order":"3103","possible_hits":"2",},
{"lineNum":"  719","line":"            }"},
{"lineNum":"  720","line":"        },"},
{"lineNum":"  721","line":"        .dereference => return self.memory.load(i64, try self.effective_address(lval.dereference.expr)),","class":"lineNoCov","hits":"0","possible_hits":"2",},
{"lineNum":"  722","line":"        .index => {"},
{"lineNum":"  723","line":"            const base = try self.effective_address(lval.index.lhs);","class":"lineNoCov","hits":"0","possible_hits":"2",},
{"lineNum":"  724","line":"            const index = self.memory.load(i64, try self.effective_address(lval.index.rhs));","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"  725","line":"            // TODO: Check that index isn\'t greater than lval.index.length"},
{"lineNum":"  726","line":"            return base + index * lval.expanded_type_sizeof();","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"  727","line":"        },"},
{"lineNum":"  728","line":"        .select => {"},
{"lineNum":"  729","line":"            const base = try self.effective_address(lval.select.lhs);","class":"lineCov","hits":"2","order":"4904","possible_hits":"2",},
{"lineNum":"  730","line":"            return base + lval.select.offset;","class":"lineCov","hits":"1","order":"4905","possible_hits":"1",},
{"lineNum":"  731","line":"        },"},
{"lineNum":"  732","line":"        .raw_address => return lval.raw_address.adrs,","class":"lineNoCov","hits":"0","possible_hits":"2",},
{"lineNum":"  733","line":"    }"},
{"lineNum":"  734","line":"}"},
{"lineNum":"  735","line":""},
{"lineNum":"  736","line":"/// Pops and returns an integer value from the interpreter\'s stack. The size of the integer is allowed to be known"},
{"lineNum":"  737","line":"/// only at compiler runtime."},
{"lineNum":"  738","line":"fn pop_int(self: *Self, int_size_bytes: i64) i128 {","class":"lineCov","hits":"2","order":"3144","possible_hits":"2",},
{"lineNum":"  739","line":"    self.stack_pointer -= int_size_bytes;","class":"lineCov","hits":"1","order":"3145","possible_hits":"1",},
{"lineNum":"  740","line":"    return self.memory.load_int(self.stack_pointer, int_size_bytes);","class":"lineCov","hits":"1","order":"3146","possible_hits":"1",},
{"lineNum":"  741","line":"}"},
{"lineNum":"  742","line":""},
{"lineNum":"  743","line":"/// Pops a generic, compiler-comptime-known type from the stack"},
{"lineNum":"  744","line":"fn pop(self: *Self, comptime T: type) T {"},
{"lineNum":"  745","line":"    const t_size: usize = @sizeOf(T);","class":"lineCov","hits":"1","order":"3140","possible_hits":"1",},
{"lineNum":"  746","line":"    self.stack_pointer -= t_size;","class":"lineCov","hits":"1","order":"3141","possible_hits":"1",},
{"lineNum":"  747","line":"    return self.memory.load(T, self.stack_pointer);","class":"lineCov","hits":"1","order":"3142","possible_hits":"1",},
{"lineNum":"  748","line":"}"},
{"lineNum":"  749","line":""},
{"lineNum":"  750","line":"/// Pushes an integer value onto the interpreter\'s stack."},
{"lineNum":"  751","line":"fn push_int(self: *Self, size: i64, val: i128) error{CompileError}!void {","class":"lineCov","hits":"2","order":"4613","possible_hits":"2",},
{"lineNum":"  752","line":"    try self.memory_check(size);","class":"lineCov","hits":"1","order":"4614","possible_hits":"1",},
{"lineNum":"  753","line":"    self.memory.store_int(self.stack_pointer, size, val);","class":"lineCov","hits":"1","order":"4615","possible_hits":"1",},
{"lineNum":"  754","line":"    self.stack_pointer += size;","class":"lineCov","hits":"1","order":"4616","possible_hits":"1",},
{"lineNum":"  755","line":"}"},
{"lineNum":"  756","line":""},
{"lineNum":"  757","line":"/// Pushes a memory block of the specified size onto the interpreter\'s stack."},
{"lineNum":"  758","line":"fn push_move(self: *Self, block_addr: i64, block_size: i64) error{CompileError}!void {","class":"lineCov","hits":"2","order":"4602","possible_hits":"2",},
{"lineNum":"  759","line":"    try self.memory_check(block_size);","class":"lineCov","hits":"1","order":"4603","possible_hits":"1",},
{"lineNum":"  760","line":"    self.memory.move(self.stack_pointer, block_addr, block_size);","class":"lineCov","hits":"1","order":"4607","possible_hits":"1",},
{"lineNum":"  761","line":"    self.stack_pointer += block_size;","class":"lineCov","hits":"1","order":"4609","possible_hits":"1",},
{"lineNum":"  762","line":"}"},
{"lineNum":"  763","line":""},
{"lineNum":"  764","line":"/// Pushes a generic, compiler-comptime-known type to the stack"},
{"lineNum":"  765","line":"fn push(self: *Self, comptime T: type, val: T) error{CompileError}!void {","class":"lineCov","hits":"2","order":"4620","possible_hits":"2",},
{"lineNum":"  766","line":"    const t_size: usize = @sizeOf(T);","class":"lineCov","hits":"1","order":"4621","possible_hits":"1",},
{"lineNum":"  767","line":"    try self.memory_check(t_size);","class":"lineCov","hits":"1","order":"4622","possible_hits":"1",},
{"lineNum":"  768","line":"    self.memory.store(T, self.stack_pointer, val);","class":"lineCov","hits":"1","order":"4623","possible_hits":"1",},
{"lineNum":"  769","line":"    self.stack_pointer += t_size;","class":"lineCov","hits":"1","order":"4624","possible_hits":"1",},
{"lineNum":"  770","line":"}"},
{"lineNum":"  771","line":"/// Asserts that the provided `val` fits within the bounds specified by the data type `_type`."},
{"lineNum":"  772","line":"/// Adds an error if the value is out of bounds."},
{"lineNum":"  773","line":"fn assert_fits(self: *Self, val: i128, _type: *Type_AST, operation_name: []const u8, span: Span) error{CompileError}!void {","class":"lineCov","hits":"2","order":"3242","possible_hits":"2",},
{"lineNum":"  774","line":"    const bounds = prelude_.bounds_from_ast(_type) orelse return;","class":"lineCov","hits":"2","order":"3243","possible_hits":"2",},
{"lineNum":"  775","line":"    if (val < bounds.lower or val > bounds.upper) {","class":"lineCov","hits":"2","order":"3244","possible_hits":"2",},
{"lineNum":"  776","line":"        self.debug_call_stack.append(span) catch unreachable;","class":"lineCov","hits":"2","order":"4640","possible_hits":"2",},
{"lineNum":"  777","line":"        return self.interpreter_panic(\"interpreter error: {s} is out of bounds; value={}\\n\", .{ operation_name, val });","class":"lineCov","hits":"2","order":"3245","possible_hits":"2",},
{"lineNum":"  778","line":"    }"},
{"lineNum":"  779","line":"}"},
{"lineNum":"  780","line":""},
{"lineNum":"  781","line":"fn memory_check(self: *Self, space_needed: i64) error{CompileError}!void {","class":"lineCov","hits":"2","order":"4604","possible_hits":"2",},
{"lineNum":"  782","line":"    if (self.bump_alloc_pointer -| self.stack_pointer < space_needed) {","class":"lineCov","hits":"1","order":"4605","possible_hits":"1",},
{"lineNum":"  783","line":"        return self.interpreter_panic(\"interpreter error: out of memory!\\n\", .{});","class":"linePartCov","hits":"1","order":"4606","possible_hits":"2",},
{"lineNum":"  784","line":"    }"},
{"lineNum":"  785","line":"}"},
{"lineNum":"  786","line":""},
{"lineNum":"  787","line":"/// Signals an interpreter panic, printing an error message and call stack information."},
{"lineNum":"  788","line":"fn interpreter_panic(self: *Self, comptime msg: []const u8, args: anytype) error{CompileError} {","class":"linePartCov","hits":"4","order":"4641","possible_hits":"16",},
{"lineNum":"  789","line":"    var stdout = std.fs.File.stdout();","class":"linePartCov","hits":"2","order":"4642","possible_hits":"8",},
{"lineNum":"  790","line":""},
{"lineNum":"  791","line":"    var buf = std.array_list.Managed(u8).init(std.heap.page_allocator);","class":"linePartCov","hits":"2","order":"4643","possible_hits":"8",},
{"lineNum":"  792","line":"    defer buf.deinit();","class":"linePartCov","hits":"2","order":"4680","possible_hits":"24",},
{"lineNum":"  793","line":""},
{"lineNum":"  794","line":"    buf.print(msg, args) catch return error.CompileError;","class":"linePartCov","hits":"4","order":"4644","possible_hits":"24",},
{"lineNum":"  795","line":""},
{"lineNum":"  796","line":"    var i = self.debug_call_stack.items.len - 1;","class":"linePartCov","hits":"2","order":"4645","possible_hits":"16",},
{"lineNum":"  797","line":"    while (true) {"},
{"lineNum":"  798","line":"        const stack_span = self.debug_call_stack.items[i];","class":"linePartCov","hits":"6","order":"4646","possible_hits":"24",},
{"lineNum":"  799","line":"        stack_span.print_debug_line(&buf, Span.interpreter_format) catch return error.CompileError;","class":"linePartCov","hits":"4","order":"4647","possible_hits":"24",},
{"lineNum":"  800","line":""},
{"lineNum":"  801","line":"        if (i == 0) {","class":"linePartCov","hits":"2","order":"4675","possible_hits":"8",},
{"lineNum":"  802","line":"            break;","class":"linePartCov","hits":"2","order":"4678","possible_hits":"8",},
{"lineNum":"  803","line":"        } else {"},
{"lineNum":"  804","line":"            i -= 1;","class":"linePartCov","hits":"1","order":"4676","possible_hits":"8",},
{"lineNum":"  805","line":"        }"},
{"lineNum":"  806","line":"    }","class":"linePartCov","hits":"2","order":"4677","possible_hits":"16",},
{"lineNum":"  807","line":""},
{"lineNum":"  808","line":"    stdout.writeAll(buf.items) catch unreachable;","class":"linePartCov","hits":"4","order":"4679","possible_hits":"16",},
{"lineNum":"  809","line":""},
{"lineNum":"  810","line":"    return error.CompileError;","class":"linePartCov","hits":"2","order":"4681","possible_hits":"8",},
{"lineNum":"  811","line":"}"},
]};
var percent_low = 25;var percent_high = 75;
var header = { "command" : "orng-test", "date" : "2025-11-10 15:43:08", "instrumented" : 388, "covered" : 203,};
var merged_data = [];
