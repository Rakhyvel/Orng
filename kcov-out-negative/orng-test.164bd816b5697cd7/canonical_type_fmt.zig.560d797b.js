var data = {lines:[
{"lineNum":"    1","line":"/// This format wrapper formats a type to a canonical C representation string. Canonicalizations are stable"},
{"lineNum":"    2","line":"/// across compilations, cyclic tolerant, allow for extern types."},
{"lineNum":"    3","line":"const std = @import(\"std\");"},
{"lineNum":"    4","line":"const prelude_ = @import(\"../hierarchy/prelude.zig\");"},
{"lineNum":"    5","line":"const String = @import(\"../zig-string/zig-string.zig\").String;"},
{"lineNum":"    6","line":"const Type_AST = @import(\"../types/type.zig\").Type_AST;"},
{"lineNum":"    7","line":"const C_Type_Map = @import(\"../ast/type_map.zig\").C_Type_Map;"},
{"lineNum":"    8","line":""},
{"lineNum":"    9","line":"const Self = @This();"},
{"lineNum":"   10","line":""},
{"lineNum":"   11","line":"type: *Type_AST,"},
{"lineNum":"   12","line":"case: enum { lower, upper } = .lower,"},
{"lineNum":"   13","line":""},
{"lineNum":"   14","line":"pub fn format(self: *const Self, writer: *std.io.Writer) !void {","class":"lineNoCov","hits":"0","possible_hits":"2",},
{"lineNum":"   15","line":"    const hash = try Self.hash_type(self.type);","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"   16","line":"    switch (self.case) {","class":"lineNoCov","hits":"0","possible_hits":"3",},
{"lineNum":"   17","line":"        .lower => try writer.print(\"orange_type_{X}\", .{hash}),","class":"lineNoCov","hits":"0","possible_hits":"2",},
{"lineNum":"   18","line":"        .upper => try writer.print(\"ORANGE_TYPE_{X}\", .{hash}),","class":"lineNoCov","hits":"0","possible_hits":"2",},
{"lineNum":"   19","line":"    }"},
{"lineNum":"   20","line":"}"},
{"lineNum":"   21","line":""},
{"lineNum":"   22","line":"/// Returns the hash for a given type"},
{"lineNum":"   23","line":"pub fn hash_type(_type: *Type_AST) !usize {","class":"lineNoCov","hits":"0","possible_hits":"2",},
{"lineNum":"   24","line":"    var seen_map = C_Type_Map(usize).init(std.heap.page_allocator);","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"   25","line":"    defer seen_map.deinit();","class":"lineNoCov","hits":"0","possible_hits":"2",},
{"lineNum":"   26","line":""},
{"lineNum":"   27","line":"    var next_id: usize = 0;","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"   28","line":""},
{"lineNum":"   29","line":"    var str = String.init(std.heap.page_allocator);","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"   30","line":"    defer str.deinit();","class":"lineNoCov","hits":"0","possible_hits":"2",},
{"lineNum":"   31","line":"    var writer = str.writer(&.{});","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"   32","line":"    const writer_intfc = &writer.interface;","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"   33","line":""},
{"lineNum":"   34","line":"    try hash_type_internal(_type, &seen_map, &next_id, writer_intfc);","class":"lineNoCov","hits":"0","possible_hits":"2",},
{"lineNum":"   35","line":""},
{"lineNum":"   36","line":"    return std.hash.Fnv1a_64.hash(str.str());","class":"lineNoCov","hits":"0","possible_hits":"2",},
{"lineNum":"   37","line":"}"},
{"lineNum":"   38","line":""},
{"lineNum":"   39","line":"/// Returns a String object representing the canonical representation of the type"},
{"lineNum":"   40","line":"pub fn canonical_rep(_type: *Type_AST) !String {","class":"lineNoCov","hits":"0","possible_hits":"2",},
{"lineNum":"   41","line":"    var seen_map = C_Type_Map(usize).init(std.heap.page_allocator);","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"   42","line":"    defer seen_map.deinit();","class":"lineNoCov","hits":"0","possible_hits":"2",},
{"lineNum":"   43","line":""},
{"lineNum":"   44","line":"    var next_id: usize = 0;","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"   45","line":""},
{"lineNum":"   46","line":"    var str = String.init(std.heap.page_allocator);","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"   47","line":"    var writer = str.writer(&.{});","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"   48","line":"    const writer_intfc = &writer.interface;","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"   49","line":""},
{"lineNum":"   50","line":"    try hash_type_internal(_type, &seen_map, &next_id, writer_intfc);","class":"lineNoCov","hits":"0","possible_hits":"2",},
{"lineNum":"   51","line":""},
{"lineNum":"   52","line":"    return str;","class":"lineNoCov","hits":"0","possible_hits":"2",},
{"lineNum":"   53","line":"}"},
{"lineNum":"   54","line":""},
{"lineNum":"   55","line":"/// Hashes a type to its C canonical representation."},
{"lineNum":"   56","line":"///"},
{"lineNum":"   57","line":"/// ### Params"},
{"lineNum":"   58","line":"/// * `_type`: The type to hash"},
{"lineNum":"   59","line":"/// * `seen_map`: A C-equivalence linear map of types that have been seen to their ID. Used for back edges in cycles."},
{"lineNum":"   60","line":"/// * `next_id`: Pointer to a usize to monotonically increase, for assigning IDs to types."},
{"lineNum":"   61","line":"/// * `writer`: Writer to write the repr to."},
{"lineNum":"   62","line":"fn hash_type_internal("},
{"lineNum":"   63","line":"    _type: *Type_AST,"},
{"lineNum":"   64","line":"    seen_map: *C_Type_Map(usize),"},
{"lineNum":"   65","line":"    next_id: *usize,"},
{"lineNum":"   66","line":"    writer: *std.io.Writer,"},
{"lineNum":"   67","line":") error{WriteFailed}!void {","class":"lineNoCov","hits":"0","possible_hits":"2",},
{"lineNum":"   68","line":"    var real_type = _type.expand_identifier();","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"   69","line":""},
{"lineNum":"   70","line":"    // Already computed the hash, emit a back ref with the id"},
{"lineNum":"   71","line":"    if (seen_map.contains(real_type)) {","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"   72","line":"        try writer.print(\"ref{}\", .{seen_map.get(real_type).?});","class":"lineNoCov","hits":"0","possible_hits":"2",},
{"lineNum":"   73","line":"        return;","class":"lineNoCov","hits":"0","possible_hits":"2",},
{"lineNum":"   74","line":"    }"},
{"lineNum":"   75","line":""},
{"lineNum":"   76","line":"    // Assign a unique ID to this type"},
{"lineNum":"   77","line":"    const id = next_id.*;","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"   78","line":"    next_id.* += 1;","class":"lineNoCov","hits":"0","possible_hits":"2",},
{"lineNum":"   79","line":"    seen_map.put(real_type, id) catch unreachable;","class":"lineNoCov","hits":"0","possible_hits":"2",},
{"lineNum":"   80","line":""},
{"lineNum":"   81","line":"    // Compute children hashes depending on type kind"},
{"lineNum":"   82","line":"    switch (real_type.*) {","class":"lineNoCov","hits":"0","possible_hits":"3",},
{"lineNum":"   83","line":"        .identifier => {"},
{"lineNum":"   84","line":"            const info = prelude_.info_from_name(real_type.token().data);","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"   85","line":"            if (info != null) {","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"   86","line":"                try writer.print(\"{s}\", .{info.?.canon_name});","class":"lineNoCov","hits":"0","possible_hits":"2",},
{"lineNum":"   87","line":"            } else {"},
{"lineNum":"   88","line":"                try writer.print(\"{s}\", .{real_type.token().data});","class":"lineNoCov","hits":"0","possible_hits":"3",},
{"lineNum":"   89","line":"            }"},
{"lineNum":"   90","line":"        },"},
{"lineNum":"   91","line":"        .addr_of => {"},
{"lineNum":"   92","line":"            try writer.print(\"p\", .{});","class":"lineNoCov","hits":"0","possible_hits":"2",},
{"lineNum":"   93","line":"            try hash_type_internal(real_type.child(), seen_map, next_id, writer);","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"   94","line":"        },"},
{"lineNum":"   95","line":"        .anyptr_type => try writer.print(\"void\", .{}),","class":"lineNoCov","hits":"0","possible_hits":"2",},
{"lineNum":"   96","line":"        .unit_type => try writer.print(\"unit\", .{}),","class":"lineNoCov","hits":"0","possible_hits":"2",},
{"lineNum":"   97","line":"        .struct_type, .tuple_type => {"},
{"lineNum":"   98","line":"            try writer.print(\"tuple{}\", .{non_unit_len(real_type)});","class":"lineNoCov","hits":"0","possible_hits":"2",},
{"lineNum":"   99","line":"            try append_fields(real_type, seen_map, next_id, writer);","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"  100","line":"        },"},
{"lineNum":"  101","line":"        .context_type => {"},
{"lineNum":"  102","line":"            try writer.print(\"context{}\", .{non_unit_len(real_type)});","class":"lineNoCov","hits":"0","possible_hits":"2",},
{"lineNum":"  103","line":"            try append_fields(real_type, seen_map, next_id, writer);","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"  104","line":"        },"},
{"lineNum":"  105","line":"        .array_of => {"},
{"lineNum":"  106","line":"            try writer.print(\"array{}_\", .{real_type.array_of.len.int.data});","class":"lineNoCov","hits":"0","possible_hits":"2",},
{"lineNum":"  107","line":"            try hash_type_internal(real_type.child(), seen_map, next_id, writer);","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"  108","line":"        },"},
{"lineNum":"  109","line":"        .enum_type => {"},
{"lineNum":"  110","line":"            // TODO will likely need to emit the tag size, too"},
{"lineNum":"  111","line":"            try writer.print(\"enum{}\", .{non_unit_len(real_type)});","class":"lineNoCov","hits":"0","possible_hits":"2",},
{"lineNum":"  112","line":"            try append_fields(real_type, seen_map, next_id, writer);","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"  113","line":"        },"},
{"lineNum":"  114","line":"        .untagged_sum_type => {"},
{"lineNum":"  115","line":"            try writer.print(\"union\", .{});","class":"lineNoCov","hits":"0","possible_hits":"2",},
{"lineNum":"  116","line":"            try append_fields(real_type.child().expand_identifier(), seen_map, next_id, writer);","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"  117","line":"        },"},
{"lineNum":"  118","line":"        .dyn_type => {"},
{"lineNum":"  119","line":"            try writer.print(\"dyn_{s}\", .{real_type.child().symbol().?.name});","class":"lineNoCov","hits":"0","possible_hits":"2",},
{"lineNum":"  120","line":"        },"},
{"lineNum":"  121","line":"        .function => {"},
{"lineNum":"  122","line":"            try writer.print(\"function_\", .{});","class":"lineNoCov","hits":"0","possible_hits":"2",},
{"lineNum":"  123","line":"            try hash_type_internal(real_type.lhs(), seen_map, next_id, writer);","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"  124","line":"            try writer.print(\"_\", .{});","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"  125","line":"            try hash_type_internal(real_type.rhs(), seen_map, next_id, writer);","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"  126","line":"        },"},
{"lineNum":"  127","line":"        else => try writer.print(\"({t})\", .{real_type.*}),","class":"lineNoCov","hits":"0","possible_hits":"3",},
{"lineNum":"  128","line":"    }"},
{"lineNum":"  129","line":"}"},
{"lineNum":"  130","line":""},
{"lineNum":"  131","line":"/// Calculate how many fields would be emitted for C. Orange unit typed fields do not get emitted."},
{"lineNum":"  132","line":"fn non_unit_len(real_type: *Type_AST) usize {","class":"lineNoCov","hits":"0","possible_hits":"2",},
{"lineNum":"  133","line":"    var ret: usize = 0;","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"  134","line":"    for (real_type.children().items) |child| {","class":"lineNoCov","hits":"0","possible_hits":"3",},
{"lineNum":"  135","line":"        if (!child.is_c_void_type()) ret += 1;","class":"lineNoCov","hits":"0","possible_hits":"2",},
{"lineNum":"  136","line":"    }","class":"lineNoCov","hits":"0","possible_hits":"3",},
{"lineNum":"  137","line":"    return ret;","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"  138","line":"}"},
{"lineNum":"  139","line":""},
{"lineNum":"  140","line":"fn append_fields("},
{"lineNum":"  141","line":"    _type: *Type_AST,"},
{"lineNum":"  142","line":"    seen_map: *C_Type_Map(usize),"},
{"lineNum":"  143","line":"    next_id: *usize,"},
{"lineNum":"  144","line":"    writer: *std.io.Writer,"},
{"lineNum":"  145","line":") !void {","class":"lineNoCov","hits":"0","possible_hits":"2",},
{"lineNum":"  146","line":"    for (_type.children().items) |child| {","class":"lineNoCov","hits":"0","possible_hits":"3",},
{"lineNum":"  147","line":"        if (child.is_c_void_type()) continue;","class":"lineNoCov","hits":"0","possible_hits":"2",},
{"lineNum":"  148","line":"        try writer.print(\"_\", .{});","class":"lineNoCov","hits":"0","possible_hits":"2",},
{"lineNum":"  149","line":"        try hash_type_internal(child, seen_map, next_id, writer);","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"  150","line":"    }","class":"lineNoCov","hits":"0","possible_hits":"4",},
{"lineNum":"  151","line":"}"},
]};
var percent_low = 25;var percent_high = 75;
var header = { "command" : "orng-test", "date" : "2025-11-10 15:43:08", "instrumented" : 69, "covered" : 0,};
var merged_data = [];
