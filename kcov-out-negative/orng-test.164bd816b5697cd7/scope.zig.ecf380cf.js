var data = {lines:[
{"lineNum":"    1","line":"const std = @import(\"std\");"},
{"lineNum":"    2","line":"const ast_ = @import(\"../ast/ast.zig\");"},
{"lineNum":"    3","line":"const Compiler_Context = @import(\"../hierarchy/compiler.zig\");"},
{"lineNum":"    4","line":"const Decorate = @import(\"../ast/decorate.zig\");"},
{"lineNum":"    5","line":"// const Decorate_Access = @import(\"../ast/decorate-access.zig\");"},
{"lineNum":"    6","line":"const errs_ = @import(\"../util/errors.zig\");"},
{"lineNum":"    7","line":"const Symbol = @import(\"symbol.zig\");"},
{"lineNum":"    8","line":"const Symbol_Tree = @import(\"../ast/symbol-tree.zig\");"},
{"lineNum":"    9","line":"const module_ = @import(\"../hierarchy/module.zig\");"},
{"lineNum":"   10","line":"const unification_ = @import(\"../types/unification.zig\");"},
{"lineNum":"   11","line":"const UID_Gen = @import(\"../util/uid_gen.zig\");"},
{"lineNum":"   12","line":"const walker_ = @import(\"../ast/walker.zig\");"},
{"lineNum":"   13","line":"const Tree_Writer = @import(\"../ast/tree_writer.zig\");"},
{"lineNum":"   14","line":"const Type_AST = @import(\"../types/type.zig\").Type_AST;"},
{"lineNum":"   15","line":""},
{"lineNum":"   16","line":"const Self = @This();"},
{"lineNum":"   17","line":""},
{"lineNum":"   18","line":"const Lookup_Result = union(enum) { found_but_rt, found_but_fn, not_found, found: *Symbol };"},
{"lineNum":"   19","line":""},
{"lineNum":"   20","line":"parent: ?*Self,"},
{"lineNum":"   21","line":"children: std.array_list.Managed(*Self),"},
{"lineNum":"   22","line":"symbols: std.StringArrayHashMap(*Symbol),"},
{"lineNum":"   23","line":"traits: std.array_list.Managed(*ast_.AST), // List of all `trait`s in this scope. Added to in the `decorate` phase."},
{"lineNum":"   24","line":"impls: std.array_list.Managed(*ast_.AST), // List of all `impl`s in this scope Added to in the `decorate` phase."},
{"lineNum":"   25","line":"tests: std.array_list.Managed(*ast_.AST), // List of all `test`s in this scope Added to in the `decorate` phase."},
{"lineNum":"   26","line":"module: ?*module_.Module, // Enclosing module"},
{"lineNum":"   27","line":"uid: usize,"},
{"lineNum":"   28","line":"uid_gen: *UID_Gen,"},
{"lineNum":"   29","line":""},
{"lineNum":"   30","line":"function_depth: usize = 0,"},
{"lineNum":"   31","line":"inner_function: ?*Symbol = null,"},
{"lineNum":"   32","line":""},
{"lineNum":"   33","line":"pub fn init(parent: ?*Self, uid_gen: *UID_Gen, allocator: std.mem.Allocator) *Self {","class":"lineCov","hits":"2","order":"209","possible_hits":"2",},
{"lineNum":"   34","line":"    var retval = allocator.create(Self) catch unreachable;","class":"lineCov","hits":"2","order":"210","possible_hits":"2",},
{"lineNum":"   35","line":"    retval.parent = parent;","class":"lineCov","hits":"1","order":"211","possible_hits":"1",},
{"lineNum":"   36","line":"    retval.children = std.array_list.Managed(*Self).init(allocator);","class":"lineCov","hits":"1","order":"212","possible_hits":"1",},
{"lineNum":"   37","line":"    retval.symbols = std.StringArrayHashMap(*Symbol).init(allocator);","class":"lineCov","hits":"1","order":"213","possible_hits":"1",},
{"lineNum":"   38","line":"    retval.traits = std.array_list.Managed(*ast_.AST).init(allocator);","class":"lineCov","hits":"1","order":"214","possible_hits":"1",},
{"lineNum":"   39","line":"    retval.impls = std.array_list.Managed(*ast_.AST).init(allocator);","class":"lineCov","hits":"1","order":"215","possible_hits":"1",},
{"lineNum":"   40","line":"    retval.tests = std.array_list.Managed(*ast_.AST).init(allocator);","class":"lineCov","hits":"1","order":"216","possible_hits":"1",},
{"lineNum":"   41","line":"    retval.uid = uid_gen.uid();","class":"lineCov","hits":"1","order":"217","possible_hits":"1",},
{"lineNum":"   42","line":"    retval.uid_gen = uid_gen;","class":"lineCov","hits":"1","order":"222","possible_hits":"1",},
{"lineNum":"   43","line":"    if (parent) |_parent| {","class":"lineCov","hits":"2","order":"223","possible_hits":"2",},
{"lineNum":"   44","line":"        std.debug.assert(@intFromPtr(retval) != 0xaaaaaaaaaaaaaaaa);","class":"lineCov","hits":"1","order":"453","possible_hits":"1",},
{"lineNum":"   45","line":"        _parent.children.append(retval) catch unreachable;","class":"lineCov","hits":"2","order":"454","possible_hits":"2",},
{"lineNum":"   46","line":"        retval.function_depth = _parent.function_depth;","class":"lineCov","hits":"1","order":"455","possible_hits":"1",},
{"lineNum":"   47","line":"        retval.inner_function = _parent.inner_function;","class":"lineCov","hits":"1","order":"456","possible_hits":"1",},
{"lineNum":"   48","line":"        retval.module = _parent.module;","class":"lineCov","hits":"1","order":"457","possible_hits":"1",},
{"lineNum":"   49","line":"    } else {"},
{"lineNum":"   50","line":"        retval.function_depth = 0;","class":"lineCov","hits":"1","order":"224","possible_hits":"1",},
{"lineNum":"   51","line":"        retval.inner_function = null;","class":"lineCov","hits":"1","order":"225","possible_hits":"1",},
{"lineNum":"   52","line":"        retval.module = null;","class":"lineCov","hits":"1","order":"226","possible_hits":"1",},
{"lineNum":"   53","line":"    }"},
{"lineNum":"   54","line":"    return retval;","class":"lineCov","hits":"1","order":"227","possible_hits":"1",},
{"lineNum":"   55","line":"}"},
{"lineNum":"   56","line":""},
{"lineNum":"   57","line":"pub const Lookup_Flags = struct {"},
{"lineNum":"   58","line":"    crossed_boundary: bool = false,"},
{"lineNum":"   59","line":"    allow_modules: bool = false,"},
{"lineNum":"   60","line":"    look_for_kind: ?Symbol.Kind = null,"},
{"lineNum":"   61","line":"};"},
{"lineNum":"   62","line":""},
{"lineNum":"   63","line":"pub fn lookup(self: *Self, name: []const u8, flags: Lookup_Flags) Lookup_Result {","class":"lineCov","hits":"2","order":"403","possible_hits":"2",},
{"lineNum":"   64","line":"    const log: bool = false;","class":"lineCov","hits":"1","order":"404","possible_hits":"1",},
{"lineNum":"   65","line":"    if (log) {"},
{"lineNum":"   66","line":"        const found = self.symbols.get(name) != null;"},
{"lineNum":"   67","line":"        std.debug.print(\"searching for: {s} {}({})\\n\", .{ name, found, flags });"},
{"lineNum":"   68","line":"        self.pprint();"},
{"lineNum":"   69","line":"    }"},
{"lineNum":"   70","line":""},
{"lineNum":"   71","line":"    if (self.symbols.get(name)) |symbol| {","class":"lineCov","hits":"2","order":"405","possible_hits":"2",},
{"lineNum":"   72","line":"        if (!flags.allow_modules and symbol.kind == .module) {","class":"lineCov","hits":"2","order":"1941","possible_hits":"2",},
{"lineNum":"   73","line":"            // search parents"},
{"lineNum":"   74","line":"        } else if (flags.look_for_kind != null and @intFromEnum(flags.look_for_kind.?) != @intFromEnum(symbol.kind)) {","class":"lineCov","hits":"2","order":"1942","possible_hits":"2",},
{"lineNum":"   75","line":"            // search parents"},
{"lineNum":"   76","line":"        } else if (flags.crossed_boundary and (symbol.kind == .mut or symbol.kind == .let)) {","class":"lineCov","hits":"1","order":"1943","possible_hits":"1",},
{"lineNum":"   77","line":"            // Found the symbol, but it\'s non-const and we\'ve crossed an inner-function boundary"},
{"lineNum":"   78","line":"            return .found_but_fn;","class":"lineCov","hits":"1","order":"6240","possible_hits":"1",},
{"lineNum":"   79","line":"        } else {"},
{"lineNum":"   80","line":"            // Found the symbol just fine"},
{"lineNum":"   81","line":"            if (log) {"},
{"lineNum":"   82","line":"                std.debug.print(\"Found: {s} {*}\\n\", .{ name, symbol });"},
{"lineNum":"   83","line":"            }"},
{"lineNum":"   84","line":"            return Lookup_Result{ .found = symbol };","class":"linePartCov","hits":"2","order":"406","possible_hits":"3",},
{"lineNum":"   85","line":"        }"},
{"lineNum":"   86","line":"    }"},
{"lineNum":"   87","line":""},
{"lineNum":"   88","line":"    if (self.parent) |parent| {","class":"lineCov","hits":"2","order":"407","possible_hits":"2",},
{"lineNum":"   89","line":"        var new_flags = flags;","class":"lineCov","hits":"1","order":"1559","possible_hits":"1",},
{"lineNum":"   90","line":"        new_flags.crossed_boundary = parent.function_depth < self.function_depth or flags.crossed_boundary;","class":"lineCov","hits":"3","order":"1560","possible_hits":"3",},
{"lineNum":"   91","line":"        const res = parent.lookup(name, new_flags);","class":"lineCov","hits":"1","order":"1561","possible_hits":"1",},
{"lineNum":"   92","line":"        return res;","class":"lineCov","hits":"1","order":"1562","possible_hits":"1",},
{"lineNum":"   93","line":"    } else {"},
{"lineNum":"   94","line":"        // Did not find the symbol at all"},
{"lineNum":"   95","line":"        return .not_found;","class":"lineCov","hits":"1","order":"408","possible_hits":"1",},
{"lineNum":"   96","line":"    }"},
{"lineNum":"   97","line":"}"},
{"lineNum":"   98","line":""},
{"lineNum":"   99","line":"pub fn num_visible_contexts(self: *Self) usize {","class":"lineCov","hits":"2","order":"4987","possible_hits":"2",},
{"lineNum":"  100","line":"    var result: usize = 0;","class":"lineCov","hits":"1","order":"4988","possible_hits":"1",},
{"lineNum":"  101","line":""},
{"lineNum":"  102","line":"    for (self.symbols.keys()) |symbol_name| {","class":"lineCov","hits":"3","order":"4989","possible_hits":"3",},
{"lineNum":"  103","line":"        const symbol = self.symbols.get(symbol_name).?;","class":"lineCov","hits":"3","order":"4993","possible_hits":"3",},
{"lineNum":"  104","line":"        if (symbol.kind == .let) {","class":"lineCov","hits":"1","order":"4994","possible_hits":"1",},
{"lineNum":"  105","line":"            var symbol_type = symbol.type();","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"  106","line":"            if (symbol_type.* == .addr_of) {","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"  107","line":"                symbol_type = symbol_type.child();","class":"lineNoCov","hits":"0","possible_hits":"2",},
{"lineNum":"  108","line":"            }"},
{"lineNum":"  109","line":"            if (symbol_type.* == .context_type or std.mem.startsWith(u8, symbol.name, \"context_value__\")) {","class":"lineNoCov","hits":"0","possible_hits":"2",},
{"lineNum":"  110","line":"                result += 1;","class":"linePartCov","hits":"1","order":"4995","possible_hits":"4",},
{"lineNum":"  111","line":"            }"},
{"lineNum":"  112","line":"        }"},
{"lineNum":"  113","line":"    }","class":"lineCov","hits":"3","order":"4990","possible_hits":"3",},
{"lineNum":"  114","line":""},
{"lineNum":"  115","line":"    const parent_contrib = if (self.parent) |parent|","class":"lineCov","hits":"2","order":"4991","possible_hits":"2",},
{"lineNum":"  116","line":"        parent.num_visible_contexts()","class":"lineCov","hits":"3","order":"4992","possible_hits":"3",},
{"lineNum":"  117","line":"    else"},
{"lineNum":"  118","line":"        0;"},
{"lineNum":"  119","line":""},
{"lineNum":"  120","line":"    return result + parent_contrib;","class":"linePartCov","hits":"1","order":"4996","possible_hits":"2",},
{"lineNum":"  121","line":"}"},
{"lineNum":"  122","line":""},
{"lineNum":"  123","line":"pub fn context_lookup(self: *Self, context_type: *Type_AST, ctx: *Compiler_Context) ?*Symbol {","class":"lineCov","hits":"2","order":"5013","possible_hits":"2",},
{"lineNum":"  124","line":"    for (self.symbols.keys()) |symbol_name| {","class":"lineCov","hits":"3","order":"5014","possible_hits":"3",},
{"lineNum":"  125","line":"        const symbol = self.symbols.get(symbol_name).?;","class":"lineCov","hits":"3","order":"5015","possible_hits":"3",},
{"lineNum":"  126","line":"        if (symbol.kind == .let) {","class":"lineCov","hits":"1","order":"5016","possible_hits":"1",},
{"lineNum":"  127","line":"            var symbol_type = symbol.type();","class":"lineCov","hits":"1","order":"5017","possible_hits":"1",},
{"lineNum":"  128","line":"            if (symbol_type.* == .addr_of and context_type.* != .addr_of) {","class":"lineCov","hits":"2","order":"5019","possible_hits":"2",},
{"lineNum":"  129","line":"                symbol_type = symbol_type.child();","class":"linePartCov","hits":"1","order":"5020","possible_hits":"2",},
{"lineNum":"  130","line":"            }"},
{"lineNum":"  131","line":"            if (context_type.types_match(symbol_type)) {","class":"lineCov","hits":"1","order":"5021","possible_hits":"1",},
{"lineNum":"  132","line":"                return symbol;","class":"linePartCov","hits":"2","order":"5022","possible_hits":"3",},
{"lineNum":"  133","line":"            }"},
{"lineNum":"  134","line":"        }"},
{"lineNum":"  135","line":"    } else if (self.parent) |parent| {","class":"lineCov","hits":"3","order":"5030","possible_hits":"3",},
{"lineNum":"  136","line":"        return parent.context_lookup(context_type, ctx);","class":"lineCov","hits":"1","order":"5031","possible_hits":"1",},
{"lineNum":"  137","line":"    } else {"},
{"lineNum":"  138","line":"        return null;","class":"lineCov","hits":"2","order":"5032","possible_hits":"2",},
{"lineNum":"  139","line":"    }"},
{"lineNum":"  140","line":"}"},
{"lineNum":"  141","line":""},
{"lineNum":"  142","line":"const Impl_Trait_Lookup_Result = struct { count: u8, ast: ?*ast_.AST };"},
{"lineNum":"  143","line":""},
{"lineNum":"  144","line":"/// Returns the number of impls found for a given type-trait pair, and the impl ast. The impl is unique if count == 1."},
{"lineNum":"  145","line":"pub fn impl_trait_lookup(self: *Self, for_type: *Type_AST, trait: *Symbol) Impl_Trait_Lookup_Result {","class":"lineCov","hits":"2","order":"3452","possible_hits":"2",},
{"lineNum":"  146","line":"    var retval: Impl_Trait_Lookup_Result = .{ .count = 0, .ast = null };","class":"lineCov","hits":"1","order":"3453","possible_hits":"1",},
{"lineNum":"  147","line":""},
{"lineNum":"  148","line":"    // Go through the scope\'s list of implementations, check to see if the types and traits match"},
{"lineNum":"  149","line":"    for (self.impls.items) |impl| {","class":"lineCov","hits":"3","order":"3454","possible_hits":"3",},
{"lineNum":"  150","line":"        const types_match = (impl.impl._type.types_match(for_type) or for_type.types_match(impl.impl._type));","class":"lineCov","hits":"3","order":"3463","possible_hits":"3",},
{"lineNum":"  151","line":"        const traits_match = impl.impl.trait.?.symbol() == trait;","class":"lineCov","hits":"3","order":"3464","possible_hits":"3",},
{"lineNum":"  152","line":"        if (types_match and traits_match) {","class":"lineCov","hits":"2","order":"3465","possible_hits":"2",},
{"lineNum":"  153","line":"            retval.count += 1;","class":"linePartCov","hits":"1","order":"3466","possible_hits":"2",},
{"lineNum":"  154","line":"            retval.ast = retval.ast orelse impl;","class":"lineCov","hits":"2","order":"3467","possible_hits":"2",},
{"lineNum":"  155","line":"        }"},
{"lineNum":"  156","line":"    }","class":"lineCov","hits":"4","order":"3455","possible_hits":"4",},
{"lineNum":"  157","line":""},
{"lineNum":"  158","line":"    // Go through imports"},
{"lineNum":"  159","line":"    for (self.symbols.keys()) |symbol_name| {","class":"lineCov","hits":"3","order":"3456","possible_hits":"3",},
{"lineNum":"  160","line":"        const symbol = self.symbols.get(symbol_name).?;","class":"lineCov","hits":"3","order":"3457","possible_hits":"3",},
{"lineNum":"  161","line":"        if (symbol.kind == .import) {","class":"lineCov","hits":"1","order":"3458","possible_hits":"1",},
{"lineNum":"  162","line":"            var res_symbol: *Symbol = undefined;","class":"lineCov","hits":"1","order":"5522","possible_hits":"1",},
{"lineNum":"  163","line":"            if (symbol.kind.import.real_symbol != null) {","class":"lineCov","hits":"2","order":"5523","possible_hits":"2",},
{"lineNum":"  164","line":"                res_symbol = symbol.kind.import.real_symbol.?;","class":"lineCov","hits":"2","order":"5524","possible_hits":"2",},
{"lineNum":"  165","line":"            } else {"},
{"lineNum":"  166","line":"                const res = self.parent.?.lookup(symbol.kind.import.real_name, .{ .allow_modules = true });","class":"lineNoCov","hits":"0","possible_hits":"3",},
{"lineNum":"  167","line":"                switch (res) {","class":"lineNoCov","hits":"0","possible_hits":"3",},
{"lineNum":"  168","line":"                    .found => {"},
{"lineNum":"  169","line":"                        res_symbol = res.found;","class":"lineNoCov","hits":"0","possible_hits":"2",},
{"lineNum":"  170","line":"                    },"},
{"lineNum":"  171","line":"                    else => std.debug.panic(\"compiler error: import didn\'t resolve to a module: {s}\", .{symbol.kind.import.real_name}),","class":"lineNoCov","hits":"0","possible_hits":"3",},
{"lineNum":"  172","line":"                }"},
{"lineNum":"  173","line":"            }"},
{"lineNum":"  174","line":""},
{"lineNum":"  175","line":"            const module_scope = res_symbol.init_value().?.scope().?;","class":"lineCov","hits":"3","order":"5525","possible_hits":"3",},
{"lineNum":"  176","line":"            const parent_res = module_scope.impl_trait_lookup(for_type, trait);","class":"lineCov","hits":"1","order":"5526","possible_hits":"1",},
{"lineNum":"  177","line":"            if (parent_res.count > 0) {","class":"lineCov","hits":"1","order":"5529","possible_hits":"1",},
{"lineNum":"  178","line":"                retval.count += parent_res.count;","class":"lineNoCov","hits":"0","possible_hits":"2",},
{"lineNum":"  179","line":"                retval.ast = retval.ast orelse parent_res.ast;","class":"lineNoCov","hits":"0","possible_hits":"2",},
{"lineNum":"  180","line":"                return parent_res;","class":"linePartCov","hits":"3","order":"3459","possible_hits":"4",},
{"lineNum":"  181","line":"            }"},
{"lineNum":"  182","line":"        }"},
{"lineNum":"  183","line":"    }","class":"lineCov","hits":"3","order":"3460","possible_hits":"3",},
{"lineNum":"  184","line":""},
{"lineNum":"  185","line":"    if (self.parent != null) {","class":"lineCov","hits":"1","order":"3461","possible_hits":"1",},
{"lineNum":"  186","line":"        // Did not match in this scope. Try parent scope"},
{"lineNum":"  187","line":"        const parent_res = self.parent.?.impl_trait_lookup(for_type, trait);","class":"lineCov","hits":"3","order":"3462","possible_hits":"3",},
{"lineNum":"  188","line":"        retval.count += parent_res.count;","class":"linePartCov","hits":"1","order":"3469","possible_hits":"2",},
{"lineNum":"  189","line":"        retval.ast = retval.ast orelse parent_res.ast;","class":"lineCov","hits":"2","order":"3470","possible_hits":"2",},
{"lineNum":"  190","line":"        return retval;","class":"lineCov","hits":"1","order":"3471","possible_hits":"1",},
{"lineNum":"  191","line":"    } else {"},
{"lineNum":"  192","line":"        // Not found, parent scope is null"},
{"lineNum":"  193","line":"        return retval;","class":"lineCov","hits":"1","order":"3468","possible_hits":"1",},
{"lineNum":"  194","line":"    }"},
{"lineNum":"  195","line":"}"},
{"lineNum":"  196","line":""},
{"lineNum":"  197","line":"/// Looks up the impl\'s decl/method_decl ast for a given type, with a given name"},
{"lineNum":"  198","line":"pub fn lookup_impl_member(self: *Self, for_type: *Type_AST, name: []const u8, compiler: *Compiler_Context) !?*ast_.AST {","class":"lineCov","hits":"2","order":"5368","possible_hits":"2",},
{"lineNum":"  199","line":"    if (false) {","class":"lineCov","hits":"1","order":"5369","possible_hits":"1",},
{"lineNum":"  200","line":"        std.debug.print(\"searching {} impls for {f}::{s}\\n\", .{ self.impls.items.len, for_type.*, name });"},
{"lineNum":"  201","line":"        self.pprint();"},
{"lineNum":"  202","line":"    }"},
{"lineNum":"  203","line":"    // Go through the list of implementations, check to see if the types and traits match"},
{"lineNum":"  204","line":"    for (self.impls.items) |impl| {","class":"lineCov","hits":"3","order":"5370","possible_hits":"3",},
{"lineNum":"  205","line":"        var subst = unification_.Substitutions.init(std.heap.page_allocator);","class":"lineCov","hits":"1","order":"5379","possible_hits":"1",},
{"lineNum":"  206","line":"        defer subst.deinit();","class":"linePartCov","hits":"2","order":"5536","possible_hits":"9",},
{"lineNum":"  207","line":""},
{"lineNum":"  208","line":"        // TODO: This was a hack to make sure the impl type is always decorated. Decorations should probably be needs-driven?"},
{"lineNum":"  209","line":"        const decorate_context = Decorate.new(self, compiler);","class":"lineCov","hits":"1","order":"5380","possible_hits":"1",},
{"lineNum":"  210","line":"        try walker_.walk_type(impl.impl._type, decorate_context);","class":"linePartCov","hits":"2","order":"5381","possible_hits":"3",},
{"lineNum":"  211","line":""},
{"lineNum":"  212","line":"        try compiler.validate_type.validate_type(impl.impl._type);","class":"linePartCov","hits":"1","order":"5382","possible_hits":"2",},
{"lineNum":"  213","line":"        unification_.unify(impl.impl._type, for_type, impl.impl._generic_params, &subst) catch continue;","class":"lineCov","hits":"2","order":"5404","possible_hits":"2",},
{"lineNum":"  214","line":"        const subst_contains_generics = unification_.substitution_contains_generics(&subst);","class":"lineCov","hits":"1","order":"5429","possible_hits":"1",},
{"lineNum":"  215","line":""},
{"lineNum":"  216","line":"        var the_impl = impl;","class":"lineCov","hits":"1","order":"5437","possible_hits":"1",},
{"lineNum":"  217","line":"        if (impl.impl._generic_params.items.len > 0 and !subst_contains_generics) {","class":"lineCov","hits":"2","order":"5438","possible_hits":"2",},
{"lineNum":"  218","line":"            const with_list = unification_.type_param_list_from_subst_map(&subst, impl.impl._generic_params, std.heap.page_allocator);","class":"lineCov","hits":"3","order":"5439","possible_hits":"3",},
{"lineNum":"  219","line":"            if (!subst_contains_generics and impl.impl.instantiations.get(with_list) == null) {","class":"lineCov","hits":"2","order":"5447","possible_hits":"2",},
{"lineNum":"  220","line":"                const new_impl: *ast_.AST = impl.clone(&subst, std.heap.page_allocator);","class":"lineCov","hits":"1","order":"5448","possible_hits":"1",},
{"lineNum":"  221","line":"                if (!subst_contains_generics) {","class":"lineCov","hits":"1","order":"5471","possible_hits":"1",},
{"lineNum":"  222","line":"                    new_impl.impl._generic_params.clearRetainingCapacity();","class":"linePartCov","hits":"1","order":"5472","possible_hits":"2",},
{"lineNum":"  223","line":"                }"},
{"lineNum":"  224","line":"                const new_scope = init(self, self.uid_gen, std.heap.page_allocator);","class":"lineCov","hits":"1","order":"5473","possible_hits":"1",},
{"lineNum":"  225","line":""},
{"lineNum":"  226","line":"                try walker_.walk_ast(new_impl, Symbol_Tree.new(new_scope, &compiler.errors, compiler.allocator()));","class":"linePartCov","hits":"1","order":"5474","possible_hits":"2",},
{"lineNum":"  227","line":""},
{"lineNum":"  228","line":"                new_impl.set_scope(new_scope);","class":"lineCov","hits":"1","order":"5475","possible_hits":"1",},
{"lineNum":"  229","line":""},
{"lineNum":"  230","line":"                if (new_impl.impl.trait == null or new_impl.impl.impls_anon_trait) {","class":"lineCov","hits":"2","order":"5476","possible_hits":"2",},
{"lineNum":"  231","line":"                    // impl\'d for an anon trait, create an anon trait for it"},
{"lineNum":"  232","line":"                    var token = new_impl.token();","class":"lineCov","hits":"1","order":"5477","possible_hits":"1",},
{"lineNum":"  233","line":"                    token.kind = .identifier;","class":"lineCov","hits":"1","order":"5478","possible_hits":"1",},
{"lineNum":"  234","line":"                    token.data = Symbol_Tree.next_anon_name(\"Trait\", compiler.allocator());","class":"lineCov","hits":"1","order":"5479","possible_hits":"1",},
{"lineNum":"  235","line":"                    const anon_trait = ast_.AST.create_trait(","class":"lineCov","hits":"2","order":"5480","possible_hits":"2",},
{"lineNum":"  236","line":"                        token,"},
{"lineNum":"  237","line":"                        new_impl.impl.method_defs,","class":"lineCov","hits":"3","order":"5481","possible_hits":"3",},
{"lineNum":"  238","line":"                        new_impl.impl.const_defs,","class":"lineCov","hits":"3","order":"5482","possible_hits":"3",},
{"lineNum":"  239","line":"                        compiler.allocator(),","class":"lineCov","hits":"1","order":"5483","possible_hits":"1",},
{"lineNum":"  240","line":"                    );"},
{"lineNum":"  241","line":"                    try walker_.walk_ast(anon_trait, Symbol_Tree.new(new_scope, &compiler.errors, compiler.allocator()));","class":"linePartCov","hits":"1","order":"5484","possible_hits":"2",},
{"lineNum":"  242","line":"                    new_impl.impl.trait = ast_.AST.create_identifier(token, compiler.allocator());","class":"lineCov","hits":"2","order":"5487","possible_hits":"2",},
{"lineNum":"  243","line":"                    new_impl.impl.impls_anon_trait = true;","class":"linePartCov","hits":"2","order":"5488","possible_hits":"3",},
{"lineNum":"  244","line":"                }"},
{"lineNum":"  245","line":""},
{"lineNum":"  246","line":"                // Decorate identifiers, validate"},
{"lineNum":"  247","line":"                const new_decorate_context = Decorate.new(new_scope, compiler);","class":"lineCov","hits":"1","order":"5489","possible_hits":"1",},
{"lineNum":"  248","line":"                try walker_.walk_ast(new_impl, new_decorate_context); // this doesn\'t know about the anonymous trait","class":"linePartCov","hits":"1","order":"5490","possible_hits":"2",},
{"lineNum":"  249","line":""},
{"lineNum":"  250","line":"                // Set all method_decls to be monomorphed"},
{"lineNum":"  251","line":"                for (new_impl.impl.method_defs.items) |method_def| {","class":"lineCov","hits":"3","order":"5491","possible_hits":"3",},
{"lineNum":"  252","line":"                    method_def.symbol().?.is_monomorphed = true;","class":"lineCov","hits":"3","order":"5492","possible_hits":"3",},
{"lineNum":"  253","line":"                }","class":"lineCov","hits":"3","order":"5493","possible_hits":"3",},
{"lineNum":"  254","line":""},
{"lineNum":"  255","line":"                try compiler.validate_scope.validate_scope(new_scope);","class":"linePartCov","hits":"1","order":"5494","possible_hits":"2",},
{"lineNum":"  256","line":""},
{"lineNum":"  257","line":"                impl.impl.instantiations.put(with_list, new_impl) catch unreachable;","class":"lineCov","hits":"2","order":"5530","possible_hits":"2",},
{"lineNum":"  258","line":"            }"},
{"lineNum":"  259","line":"            the_impl = impl.impl.instantiations.get(with_list).?; // TODO: substitutions need to be in the same order as withs","class":"lineCov","hits":"3","order":"5531","possible_hits":"3",},
{"lineNum":"  260","line":"        }"},
{"lineNum":"  261","line":"        return search_impl(the_impl, name) orelse continue;","class":"lineCov","hits":"6","order":"5371","possible_hits":"6",},
{"lineNum":"  262","line":"    }"},
{"lineNum":"  263","line":""},
{"lineNum":"  264","line":"    // Search for any imports"},
{"lineNum":"  265","line":"    for (self.symbols.keys()) |symbol_name| {","class":"lineCov","hits":"3","order":"5372","possible_hits":"3",},
{"lineNum":"  266","line":"        const symbol = self.symbols.get(symbol_name).?;","class":"lineCov","hits":"3","order":"5373","possible_hits":"3",},
{"lineNum":"  267","line":"        if (symbol.kind == .import) {","class":"lineCov","hits":"1","order":"5374","possible_hits":"1",},
{"lineNum":"  268","line":"            var res_symbol: *Symbol = undefined;","class":"lineCov","hits":"1","order":"6352","possible_hits":"1",},
{"lineNum":"  269","line":"            if (symbol.kind.import.real_symbol != null) {","class":"lineCov","hits":"2","order":"6353","possible_hits":"2",},
{"lineNum":"  270","line":"                res_symbol = symbol.kind.import.real_symbol.?;","class":"lineCov","hits":"2","order":"6354","possible_hits":"2",},
{"lineNum":"  271","line":"            } else {"},
{"lineNum":"  272","line":"                const res = self.parent.?.lookup(symbol.kind.import.real_name, .{ .allow_modules = true });","class":"lineNoCov","hits":"0","possible_hits":"3",},
{"lineNum":"  273","line":"                switch (res) {","class":"lineNoCov","hits":"0","possible_hits":"3",},
{"lineNum":"  274","line":"                    .found => {"},
{"lineNum":"  275","line":"                        res_symbol = res.found;","class":"lineNoCov","hits":"0","possible_hits":"2",},
{"lineNum":"  276","line":"                    },"},
{"lineNum":"  277","line":"                    else => std.debug.panic(\"compiler error: import didn\'t resolve to a module: {s}\", .{symbol.kind.import.real_name}),","class":"lineNoCov","hits":"0","possible_hits":"3",},
{"lineNum":"  278","line":"                }"},
{"lineNum":"  279","line":"            }"},
{"lineNum":"  280","line":""},
{"lineNum":"  281","line":"            const module_scope = res_symbol.init_value().?.scope().?;","class":"lineCov","hits":"3","order":"6355","possible_hits":"3",},
{"lineNum":"  282","line":"            const module_scope_lookup = try module_scope.lookup_impl_member(for_type, name, compiler);","class":"linePartCov","hits":"1","order":"6356","possible_hits":"2",},
{"lineNum":"  283","line":"            if (module_scope_lookup != null) {","class":"lineCov","hits":"1","order":"6360","possible_hits":"1",},
{"lineNum":"  284","line":"                return module_scope_lookup;","class":"linePartCov","hits":"2","order":"5375","possible_hits":"3",},
{"lineNum":"  285","line":"            }"},
{"lineNum":"  286","line":"        }"},
{"lineNum":"  287","line":"    }","class":"lineCov","hits":"3","order":"5376","possible_hits":"3",},
{"lineNum":"  288","line":""},
{"lineNum":"  289","line":"    if (self.parent != null) {","class":"lineCov","hits":"1","order":"5377","possible_hits":"1",},
{"lineNum":"  290","line":"        // Did not match in this scope. Try parent scope"},
{"lineNum":"  291","line":"        return self.parent.?.lookup_impl_member(for_type, name, compiler);","class":"lineCov","hits":"2","order":"5378","possible_hits":"2",},
{"lineNum":"  292","line":"    } else {"},
{"lineNum":"  293","line":"        // Not found, parent scope is null"},
{"lineNum":"  294","line":"        return null;","class":"lineCov","hits":"1","order":"6359","possible_hits":"1",},
{"lineNum":"  295","line":"    }"},
{"lineNum":"  296","line":"}"},
{"lineNum":"  297","line":""},
{"lineNum":"  298","line":"fn search_impl(impl: *ast_.AST, name: []const u8) ?*ast_.AST {","class":"lineCov","hits":"2","order":"5532","possible_hits":"2",},
{"lineNum":"  299","line":"    for (impl.impl.method_defs.items) |method_def| {","class":"lineCov","hits":"3","order":"5533","possible_hits":"3",},
{"lineNum":"  300","line":"        if (std.mem.eql(u8, method_def.method_decl.name.token().data, name)) {","class":"lineCov","hits":"2","order":"5534","possible_hits":"2",},
{"lineNum":"  301","line":"            return method_def;","class":"lineCov","hits":"1","order":"5535","possible_hits":"1",},
{"lineNum":"  302","line":"        }"},
{"lineNum":"  303","line":"    }","class":"linePartCov","hits":"2","order":"5607","possible_hits":"4",},
{"lineNum":"  304","line":"    for (impl.impl.const_defs.items) |const_def| {","class":"lineNoCov","hits":"0","possible_hits":"4",},
{"lineNum":"  305","line":"        if (std.mem.eql(u8, const_def.binding.pattern.symbol().?.name, name)) {","class":"lineNoCov","hits":"0","possible_hits":"2",},
{"lineNum":"  306","line":"            return const_def;","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"  307","line":"        }"},
{"lineNum":"  308","line":"    }","class":"lineNoCov","hits":"0","possible_hits":"3",},
{"lineNum":"  309","line":"    return null;","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"  310","line":"}"},
{"lineNum":"  311","line":""},
{"lineNum":"  312","line":"pub fn pprint(self: *Self) void {"},
{"lineNum":"  313","line":"    std.debug.print(\"scope_{}:\\n\", .{self.uid});"},
{"lineNum":"  314","line":"    for (self.symbols.keys()) |name| {"},
{"lineNum":"  315","line":"        const symbol = self.symbols.get(name).?;"},
{"lineNum":"  316","line":"        if (symbol.kind == .import) {"},
{"lineNum":"  317","line":"            std.debug.print(\"  {s} {s} ({s})\\n\", .{ @tagName(symbol.kind), name, symbol.kind.import.real_name });"},
{"lineNum":"  318","line":"        } else if (symbol.kind == .type) {"},
{"lineNum":"  319","line":"            std.debug.print(\"  {s} {s} = {?f}\\n\", .{ @tagName(symbol.kind), name, symbol.init_typedef() });"},
{"lineNum":"  320","line":"        } else {"},
{"lineNum":"  321","line":"            std.debug.print(\"  {s} {s}\\n\", .{ @tagName(symbol.kind), name });"},
{"lineNum":"  322","line":"        }"},
{"lineNum":"  323","line":"    }"},
{"lineNum":"  324","line":"}"},
{"lineNum":"  325","line":""},
{"lineNum":"  326","line":"pub fn put_symbol(scope: *Self, symbol: *Symbol, errors: *errs_.Errors) error{CompileError}!void {","class":"lineCov","hits":"2","order":"401","possible_hits":"2",},
{"lineNum":"  327","line":"    const res = scope.lookup(symbol.name, .{});","class":"lineCov","hits":"1","order":"402","possible_hits":"1",},
{"lineNum":"  328","line":"    switch (res) {","class":"lineCov","hits":"3","order":"409","possible_hits":"3",},
{"lineNum":"  329","line":"        .found => {"},
{"lineNum":"  330","line":"            const first = res.found;","class":"lineCov","hits":"3","order":"5710","possible_hits":"3",},
{"lineNum":"  331","line":"            errors.add_error(errs_.Error{ .redefinition = .{","class":"lineCov","hits":"2","order":"5711","possible_hits":"2",},
{"lineNum":"  332","line":"                .first_defined_span = first.span(),","class":"lineCov","hits":"1","order":"5712","possible_hits":"1",},
{"lineNum":"  333","line":"                .redefined_span = symbol.span(),","class":"lineCov","hits":"1","order":"5713","possible_hits":"1",},
{"lineNum":"  334","line":"                .name = symbol.name,","class":"lineCov","hits":"1","order":"5714","possible_hits":"1",},
{"lineNum":"  335","line":"            } });"},
{"lineNum":"  336","line":"            return error.CompileError;","class":"lineCov","hits":"1","order":"5715","possible_hits":"1",},
{"lineNum":"  337","line":"        },"},
{"lineNum":"  338","line":"        else => scope.symbols.put(symbol.name, symbol) catch unreachable,","class":"lineCov","hits":"3","order":"410","possible_hits":"3",},
{"lineNum":"  339","line":"    }"},
{"lineNum":"  340","line":"}"},
{"lineNum":"  341","line":""},
{"lineNum":"  342","line":"pub fn put_all_symbols(scope: *Self, symbols: *std.array_list.Managed(*Symbol), errors: *errs_.Errors) error{CompileError}!void {","class":"lineCov","hits":"2","order":"1803","possible_hits":"2",},
{"lineNum":"  343","line":"    for (symbols.items) |symbol| {","class":"lineCov","hits":"3","order":"1804","possible_hits":"3",},
{"lineNum":"  344","line":"        try scope.put_symbol(symbol, errors);","class":"lineCov","hits":"2","order":"1805","possible_hits":"2",},
{"lineNum":"  345","line":"    }","class":"lineCov","hits":"4","order":"1806","possible_hits":"4",},
{"lineNum":"  346","line":"}"},
{"lineNum":"  347","line":""},
{"lineNum":"  348","line":"pub fn collect_traits_and_impls("},
{"lineNum":"  349","line":"    self: *Self,"},
{"lineNum":"  350","line":"    traits: *std.array_list.Managed(*ast_.AST),"},
{"lineNum":"  351","line":"    impls: *std.array_list.Managed(*ast_.AST),"},
{"lineNum":"  352","line":") void {","class":"lineCov","hits":"2","order":"3546","possible_hits":"2",},
{"lineNum":"  353","line":"    traits.appendSlice(self.traits.items) catch unreachable;","class":"lineCov","hits":"2","order":"3547","possible_hits":"2",},
{"lineNum":"  354","line":"    impls.appendSlice(self.impls.items) catch unreachable;","class":"lineCov","hits":"3","order":"3548","possible_hits":"3",},
{"lineNum":"  355","line":""},
{"lineNum":"  356","line":"    for (self.children.items) |child| {","class":"lineCov","hits":"3","order":"3549","possible_hits":"3",},
{"lineNum":"  357","line":"        child.collect_traits_and_impls(traits, impls);","class":"lineCov","hits":"1","order":"3550","possible_hits":"1",},
{"lineNum":"  358","line":"    }","class":"lineCov","hits":"4","order":"3551","possible_hits":"4",},
{"lineNum":"  359","line":"}"},
{"lineNum":"  360","line":""},
{"lineNum":"  361","line":"pub fn collect_tests("},
{"lineNum":"  362","line":"    self: *Self,"},
{"lineNum":"  363","line":"    tests: *std.array_list.Managed(*ast_.AST),"},
{"lineNum":"  364","line":") void {","class":"lineCov","hits":"2","order":"4114","possible_hits":"2",},
{"lineNum":"  365","line":"    tests.appendSlice(self.tests.items) catch unreachable;","class":"lineCov","hits":"2","order":"4115","possible_hits":"2",},
{"lineNum":"  366","line":""},
{"lineNum":"  367","line":"    for (self.children.items) |child| {","class":"lineCov","hits":"3","order":"4116","possible_hits":"3",},
{"lineNum":"  368","line":"        child.collect_tests(tests);","class":"lineCov","hits":"1","order":"4117","possible_hits":"1",},
{"lineNum":"  369","line":"    }","class":"lineCov","hits":"4","order":"4118","possible_hits":"4",},
{"lineNum":"  370","line":"}"},
]};
var percent_low = 25;var percent_high = 75;
var header = { "command" : "orng-test", "date" : "2025-11-10 15:43:08", "instrumented" : 185, "covered" : 166,};
var merged_data = [];
