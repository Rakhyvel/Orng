var data = {lines:[
{"lineNum":"    1","line":"//! This file represents a struct for an AST walk, and is used to decorate identifier ASTs with symbols they refer to."},
{"lineNum":"    2","line":""},
{"lineNum":"    3","line":"const std = @import(\"std\");"},
{"lineNum":"    4","line":"const ast_ = @import(\"../ast/ast.zig\");"},
{"lineNum":"    5","line":"const core_ = @import(\"../hierarchy/core.zig\");"},
{"lineNum":"    6","line":"const Compiler_Context = @import(\"../hierarchy/compiler.zig\");"},
{"lineNum":"    7","line":"const errs_ = @import(\"../util/errors.zig\");"},
{"lineNum":"    8","line":"const Scope = @import(\"../symbol/scope.zig\");"},
{"lineNum":"    9","line":"const Symbol = @import(\"../symbol/symbol.zig\");"},
{"lineNum":"   10","line":"const token_ = @import(\"../lexer/token.zig\");"},
{"lineNum":"   11","line":"const Tree_Writer = @import(\"../ast/tree_writer.zig\");"},
{"lineNum":"   12","line":"const Type_AST = @import(\"../types/type.zig\").Type_AST;"},
{"lineNum":"   13","line":"const walk_ = @import(\"../ast/walker.zig\");"},
{"lineNum":"   14","line":""},
{"lineNum":"   15","line":"scope: *Scope,"},
{"lineNum":"   16","line":"ctx: *Compiler_Context,"},
{"lineNum":"   17","line":""},
{"lineNum":"   18","line":"const Self = @This();"},
{"lineNum":"   19","line":""},
{"lineNum":"   20","line":"pub fn new(scope: *Scope, ctx: *Compiler_Context) Self {","class":"lineCov","hits":"2","order":"522","possible_hits":"2",},
{"lineNum":"   21","line":"    return Self{","class":"lineCov","hits":"1","order":"523","possible_hits":"1",},
{"lineNum":"   22","line":"        .scope = scope,"},
{"lineNum":"   23","line":"        .ctx = ctx,"},
{"lineNum":"   24","line":"    };"},
{"lineNum":"   25","line":"}"},
{"lineNum":"   26","line":""},
{"lineNum":"   27","line":"pub fn prefix(self: Self, ast: *ast_.AST) walk_.Error!?Self {","class":"lineCov","hits":"2","order":"1921","possible_hits":"2",},
{"lineNum":"   28","line":"    return self.decorate_prefix(ast);","class":"lineCov","hits":"1","order":"1922","possible_hits":"1",},
{"lineNum":"   29","line":"}"},
{"lineNum":"   30","line":""},
{"lineNum":"   31","line":"pub fn postfix(self: Self, ast: *ast_.AST) walk_.Error!void {","class":"lineCov","hits":"2","order":"1953","possible_hits":"2",},
{"lineNum":"   32","line":"    return self.decorate_postfix(ast);","class":"lineCov","hits":"1","order":"1954","possible_hits":"1",},
{"lineNum":"   33","line":"}"},
{"lineNum":"   34","line":""},
{"lineNum":"   35","line":"pub fn prefix_type(self: Self, _type: *Type_AST) walk_.Error!?Self {","class":"lineCov","hits":"2","order":"1929","possible_hits":"2",},
{"lineNum":"   36","line":"    return self.decorate_prefix_type(_type);","class":"lineCov","hits":"1","order":"1930","possible_hits":"1",},
{"lineNum":"   37","line":"}"},
{"lineNum":"   38","line":""},
{"lineNum":"   39","line":"pub fn postfix_type(self: Self, _type: *Type_AST) walk_.Error!void {","class":"lineCov","hits":"2","order":"1948","possible_hits":"2",},
{"lineNum":"   40","line":"    return self.decorate_postfix_type(_type);","class":"lineCov","hits":"1","order":"1949","possible_hits":"1",},
{"lineNum":"   41","line":"}"},
{"lineNum":"   42","line":""},
{"lineNum":"   43","line":"fn decorate_prefix(self: Self, ast: *ast_.AST) walk_.Error!?Self {","class":"lineCov","hits":"2","order":"1923","possible_hits":"2",},
{"lineNum":"   44","line":"    switch (ast.*) {","class":"lineCov","hits":"3","order":"1924","possible_hits":"3",},
{"lineNum":"   45","line":"        else => return self,","class":"lineCov","hits":"1","order":"1952","possible_hits":"1",},
{"lineNum":"   46","line":""},
{"lineNum":"   47","line":"        .identifier => {"},
{"lineNum":"   48","line":"            if (ast.symbol() != null) {","class":"lineCov","hits":"1","order":"1957","possible_hits":"1",},
{"lineNum":"   49","line":"                return self;","class":"lineCov","hits":"1","order":"1958","possible_hits":"1",},
{"lineNum":"   50","line":"            }"},
{"lineNum":"   51","line":""},
{"lineNum":"   52","line":"            const res = self.scope.lookup(ast.token().data, .{ .allow_modules = false });","class":"lineCov","hits":"1","order":"1963","possible_hits":"1",},
{"lineNum":"   53","line":"            switch (res) {","class":"linePartCov","hits":"1","order":"1964","possible_hits":"2",},
{"lineNum":"   54","line":"                // Found the symbol, decorate the identifier AST with it"},
{"lineNum":"   55","line":"                .found => ast.set_symbol(res.found),","class":"lineCov","hits":"2","order":"1965","possible_hits":"2",},
{"lineNum":"   56","line":""},
{"lineNum":"   57","line":"                // Couldn\'t find the symbol"},
{"lineNum":"   58","line":"                .not_found => {"},
{"lineNum":"   59","line":"                    self.ctx.errors.add_error(errs_.Error{ .undeclared_identifier = .{ .identifier = ast.token(), .expected = null } });","class":"lineCov","hits":"1","order":"6261","possible_hits":"1",},
{"lineNum":"   60","line":"                    return error.CompileError;","class":"lineCov","hits":"1","order":"6262","possible_hits":"1",},
{"lineNum":"   61","line":"                },"},
{"lineNum":"   62","line":""},
{"lineNum":"   63","line":"                // Found the symbol, but must cross a comptime-boundary to access it, and it is not const"},
{"lineNum":"   64","line":"                .found_but_rt => {"},
{"lineNum":"   65","line":"                    self.ctx.errors.add_error(errs_.Error{ .comptime_access_runtime = .{ .identifier = ast.token() } });","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"   66","line":"                    return error.CompileError;","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"   67","line":"                },"},
{"lineNum":"   68","line":""},
{"lineNum":"   69","line":"                // Found the symbol, but must cross an inner-function boundary to access it, and it is not const"},
{"lineNum":"   70","line":"                .found_but_fn => {"},
{"lineNum":"   71","line":"                    self.ctx.errors.add_error(errs_.Error{ .inner_fn_access_runtime = .{ .identifier = ast.token() } });","class":"lineCov","hits":"1","order":"6241","possible_hits":"1",},
{"lineNum":"   72","line":"                    return error.CompileError;","class":"lineCov","hits":"1","order":"6242","possible_hits":"1",},
{"lineNum":"   73","line":"                },"},
{"lineNum":"   74","line":"            }"},
{"lineNum":"   75","line":""},
{"lineNum":"   76","line":"            if ((ast.symbol().?.kind == .let or ast.symbol().?.kind == .mut) // local variable","class":"lineCov","hits":"2","order":"1966","possible_hits":"2",},
{"lineNum":"   77","line":"            and ast.symbol().?.decl.?.decl_init() != null // not a parameter","class":"lineCov","hits":"1","order":"1967","possible_hits":"1",},
{"lineNum":"   78","line":"            and !ast.symbol().?.defined // not defined","class":"lineCov","hits":"1","order":"1968","possible_hits":"1",},
{"lineNum":"   79","line":"            ) {"},
{"lineNum":"   80","line":"                self.ctx.errors.add_error(errs_.Error{ .use_before_def = .{ .identifier = ast.token() } });","class":"lineCov","hits":"1","order":"6265","possible_hits":"1",},
{"lineNum":"   81","line":"                return error.CompileError;","class":"lineCov","hits":"1","order":"6266","possible_hits":"1",},
{"lineNum":"   82","line":"            }"},
{"lineNum":"   83","line":""},
{"lineNum":"   84","line":"            return self;","class":"lineCov","hits":"1","order":"1969","possible_hits":"1",},
{"lineNum":"   85","line":"        },"},
{"lineNum":"   86","line":""},
{"lineNum":"   87","line":"        .@\"if\", .match, .mapping, .@\"while\", .@\"for\", .block, .impl, .trait, .struct_decl, .enum_decl, .type_alias, .fn_decl => {"},
{"lineNum":"   88","line":"            var new_context = self;","class":"lineCov","hits":"1","order":"1925","possible_hits":"1",},
{"lineNum":"   89","line":"            new_context.scope = ast.scope().?;","class":"lineCov","hits":"3","order":"1926","possible_hits":"3",},
{"lineNum":"   90","line":"            return new_context;","class":"lineCov","hits":"1","order":"1927","possible_hits":"1",},
{"lineNum":"   91","line":"        },"},
{"lineNum":"   92","line":""},
{"lineNum":"   93","line":"        .method_decl => {"},
{"lineNum":"   94","line":"            var new_context = self;","class":"lineCov","hits":"1","order":"1959","possible_hits":"1",},
{"lineNum":"   95","line":"            if (ast.symbol() != null) {","class":"lineCov","hits":"1","order":"1960","possible_hits":"1",},
{"lineNum":"   96","line":"                new_context.scope = ast.symbol().?.scope;","class":"lineCov","hits":"1","order":"1961","possible_hits":"1",},
{"lineNum":"   97","line":"            }"},
{"lineNum":"   98","line":"            return new_context;","class":"lineCov","hits":"1","order":"1962","possible_hits":"1",},
{"lineNum":"   99","line":"        },"},
{"lineNum":"  100","line":""},
{"lineNum":"  101","line":"        .access => {"},
{"lineNum":"  102","line":"            // Capture scope, so that `Trait::member` accesses are began at the access point"},
{"lineNum":"  103","line":"            ast.set_scope(self.scope);","class":"lineCov","hits":"1","order":"5273","possible_hits":"1",},
{"lineNum":"  104","line":"            return self;","class":"lineCov","hits":"1","order":"5274","possible_hits":"1",},
{"lineNum":"  105","line":"        },"},
{"lineNum":"  106","line":"    }"},
{"lineNum":"  107","line":"}"},
{"lineNum":"  108","line":""},
{"lineNum":"  109","line":"fn decorate_prefix_type(self: Self, _type: *Type_AST) walk_.Error!?Self {","class":"lineCov","hits":"2","order":"1931","possible_hits":"2",},
{"lineNum":"  110","line":"    switch (_type.*) {","class":"lineCov","hits":"3","order":"1932","possible_hits":"3",},
{"lineNum":"  111","line":"        else => return self,","class":"lineCov","hits":"1","order":"1933","possible_hits":"1",},
{"lineNum":"  112","line":""},
{"lineNum":"  113","line":"        .identifier => {"},
{"lineNum":"  114","line":"            if (_type.symbol()) |_| {","class":"lineCov","hits":"1","order":"1936","possible_hits":"1",},
{"lineNum":"  115","line":"                // Do not re-decorate."},
{"lineNum":"  116","line":"                // Symbols are injected into ident types for lexical generic scoping"},
{"lineNum":"  117","line":"                // Keep those symbols the way they are, even if they\'re not \"visible\" from this scope!"},
{"lineNum":"  118","line":"                return self;","class":"lineCov","hits":"1","order":"1995","possible_hits":"1",},
{"lineNum":"  119","line":"            }"},
{"lineNum":"  120","line":"            const res = self.scope.lookup(_type.token().data, .{});","class":"lineCov","hits":"1","order":"1940","possible_hits":"1",},
{"lineNum":"  121","line":"            switch (res) {","class":"linePartCov","hits":"1","order":"1944","possible_hits":"2",},
{"lineNum":"  122","line":"                // Found the symbol, decorate the identifier AST with it"},
{"lineNum":"  123","line":"                .found => _type.set_symbol(res.found),","class":"lineCov","hits":"2","order":"1945","possible_hits":"2",},
{"lineNum":"  124","line":""},
{"lineNum":"  125","line":"                // Couldn\'t find the symbol"},
{"lineNum":"  126","line":"                .not_found => {"},
{"lineNum":"  127","line":"                    self.ctx.errors.add_error(errs_.Error{ .undeclared_identifier = .{ .identifier = _type.token(), .expected = null } });","class":"lineCov","hits":"1","order":"6718","possible_hits":"1",},
{"lineNum":"  128","line":"                    return error.CompileError;","class":"lineCov","hits":"1","order":"6719","possible_hits":"1",},
{"lineNum":"  129","line":"                },"},
{"lineNum":"  130","line":""},
{"lineNum":"  131","line":"                // Found the symbol, but must cross a comptime-boundary to access it, and it is not const"},
{"lineNum":"  132","line":"                .found_but_rt => {"},
{"lineNum":"  133","line":"                    self.ctx.errors.add_error(errs_.Error{ .comptime_access_runtime = .{ .identifier = _type.token() } });","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"  134","line":"                    return error.CompileError;","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"  135","line":"                },"},
{"lineNum":"  136","line":""},
{"lineNum":"  137","line":"                // Found the symbol, but must cross an inner-function boundary to access it, and it is not const"},
{"lineNum":"  138","line":"                .found_but_fn => {"},
{"lineNum":"  139","line":"                    self.ctx.errors.add_error(errs_.Error{ .inner_fn_access_runtime = .{ .identifier = _type.token() } });","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"  140","line":"                    return error.CompileError;","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"  141","line":"                },"},
{"lineNum":"  142","line":"            }"},
{"lineNum":"  143","line":""},
{"lineNum":"  144","line":"            return self;","class":"lineCov","hits":"1","order":"1946","possible_hits":"1",},
{"lineNum":"  145","line":"        },"},
{"lineNum":"  146","line":"    }"},
{"lineNum":"  147","line":"}"},
{"lineNum":"  148","line":""},
{"lineNum":"  149","line":"fn decorate_postfix(self: Self, ast: *ast_.AST) walk_.Error!void {","class":"lineCov","hits":"2","order":"1955","possible_hits":"2",},
{"lineNum":"  150","line":"    switch (ast.*) {","class":"lineCov","hits":"3","order":"1956","possible_hits":"3",},
{"lineNum":"  151","line":"        else => {},"},
{"lineNum":"  152","line":""},
{"lineNum":"  153","line":"        .access => ast.set_symbol(try self.resolve_access_ast(ast)),","class":"lineCov","hits":"2","order":"5354","possible_hits":"2",},
{"lineNum":"  154","line":""},
{"lineNum":"  155","line":"        .call => {"},
{"lineNum":"  156","line":"            if (ast.lhs().* == .enum_value) {","class":"lineCov","hits":"1","order":"1973","possible_hits":"1",},
{"lineNum":"  157","line":"                // Enum value"},
{"lineNum":"  158","line":"                ast.lhs().enum_value.init = ast.children().items[0];","class":"lineCov","hits":"3","order":"6762","possible_hits":"3",},
{"lineNum":"  159","line":"                ast.* = ast.lhs().*;","class":"lineCov","hits":"1","order":"6763","possible_hits":"1",},
{"lineNum":"  160","line":"            } else if (ast.lhs().refers_to_type()) {","class":"lineCov","hits":"1","order":"1974","possible_hits":"1",},
{"lineNum":"  161","line":"                // Struct value construction"},
{"lineNum":"  162","line":"                const struct_type = Type_AST.from_ast(ast.lhs(), self.ctx.allocator());","class":"lineCov","hits":"1","order":"1980","possible_hits":"1",},
{"lineNum":"  163","line":"                const struct_value = ast_.AST.create_struct_value(","class":"lineCov","hits":"1","order":"1989","possible_hits":"1",},
{"lineNum":"  164","line":"                    ast.lhs().token(),","class":"lineCov","hits":"1","order":"1986","possible_hits":"1",},
{"lineNum":"  165","line":"                    struct_type,"},
{"lineNum":"  166","line":"                    ast.children().*,","class":"lineCov","hits":"1","order":"1987","possible_hits":"1",},
{"lineNum":"  167","line":"                    self.ctx.allocator(),","class":"lineCov","hits":"1","order":"1988","possible_hits":"1",},
{"lineNum":"  168","line":"                );"},
{"lineNum":"  169","line":"                ast.* = struct_value.*;","class":"lineCov","hits":"3","order":"1992","possible_hits":"3",},
{"lineNum":"  170","line":"            }"},
{"lineNum":"  171","line":"        },"},
{"lineNum":"  172","line":""},
{"lineNum":"  173","line":"        .index => {"},
{"lineNum":"  174","line":"            var child = ast.lhs();","class":"lineCov","hits":"1","order":"2009","possible_hits":"1",},
{"lineNum":"  175","line":"            if (child.* != .identifier and child.* != .access) return;","class":"lineCov","hits":"2","order":"2010","possible_hits":"2",},
{"lineNum":"  176","line":""},
{"lineNum":"  177","line":"            const sym = child.symbol() orelse return;","class":"lineCov","hits":"3","order":"5141","possible_hits":"3",},
{"lineNum":"  178","line":"            const decl = sym.decl orelse return;","class":"lineCov","hits":"3","order":"5142","possible_hits":"3",},
{"lineNum":"  179","line":""},
{"lineNum":"  180","line":"            // child points to a generic function"},
{"lineNum":"  181","line":"            if (decl.num_generic_params() > 0) {","class":"lineCov","hits":"1","order":"5143","possible_hits":"1",},
{"lineNum":"  182","line":"                var types = std.array_list.Managed(*Type_AST).init(self.ctx.allocator());","class":"lineCov","hits":"1","order":"5275","possible_hits":"1",},
{"lineNum":"  183","line":"                for (ast.children().items) |arg| {","class":"lineCov","hits":"3","order":"5276","possible_hits":"3",},
{"lineNum":"  184","line":"                    try types.append(Type_AST.from_ast(arg, self.ctx.allocator()));","class":"linePartCov","hits":"1","order":"5277","possible_hits":"2",},
{"lineNum":"  185","line":"                }","class":"lineCov","hits":"3","order":"5278","possible_hits":"3",},
{"lineNum":"  186","line":"                ast.* = ast_.AST.create_generic_apply(ast.token(), child, types, self.ctx.allocator()).*;","class":"lineCov","hits":"1","order":"5279","possible_hits":"1",},
{"lineNum":"  187","line":"                try self.monomorphize_generic_apply(ast);","class":"linePartCov","hits":"3","order":"5144","possible_hits":"4",},
{"lineNum":"  188","line":"            }"},
{"lineNum":"  189","line":"        },"},
{"lineNum":"  190","line":""},
{"lineNum":"  191","line":"        .select => {"},
{"lineNum":"  192","line":"            var child = ast.lhs();","class":"lineCov","hits":"1","order":"2002","possible_hits":"1",},
{"lineNum":"  193","line":"            if (child.* == .identifier and child.symbol() != null and child.symbol().?.is_type()) {","class":"lineCov","hits":"2","order":"2003","possible_hits":"2",},
{"lineNum":"  194","line":"                const enum_value = ast_.AST.create_enum_value(ast.rhs().token(), self.ctx.allocator());","class":"lineCov","hits":"1","order":"6758","possible_hits":"1",},
{"lineNum":"  195","line":"                enum_value.enum_value.base = Type_AST.create_type_identifier(child.token(), self.ctx.allocator());","class":"lineCov","hits":"3","order":"6759","possible_hits":"3",},
{"lineNum":"  196","line":"                enum_value.enum_value.base.?.set_symbol(child.symbol());","class":"lineCov","hits":"3","order":"6760","possible_hits":"3",},
{"lineNum":"  197","line":"                ast.* = enum_value.*;","class":"lineCov","hits":"1","order":"6761","possible_hits":"1",},
{"lineNum":"  198","line":"                return;","class":"lineCov","hits":"2","order":"2004","possible_hits":"2",},
{"lineNum":"  199","line":"            }"},
{"lineNum":"  200","line":""},
{"lineNum":"  201","line":"            // child points to a generic function"},
{"lineNum":"  202","line":"            if (child.* != .identifier and child.* != .access) return;","class":"lineCov","hits":"2","order":"2005","possible_hits":"2",},
{"lineNum":"  203","line":""},
{"lineNum":"  204","line":"            const sym = child.symbol() orelse return;","class":"lineCov","hits":"3","order":"2006","possible_hits":"3",},
{"lineNum":"  205","line":"            const decl = sym.decl orelse return;","class":"lineCov","hits":"3","order":"2007","possible_hits":"3",},
{"lineNum":"  206","line":""},
{"lineNum":"  207","line":"            if (decl.* == .context_decl) {","class":"lineCov","hits":"1","order":"2008","possible_hits":"1",},
{"lineNum":"  208","line":"                const fn_ctx = decl.decl_typedef().?;","class":"lineCov","hits":"3","order":"5011","possible_hits":"3",},
{"lineNum":"  209","line":"                const context_val_symbol = self.scope.parent.?.context_lookup(fn_ctx, self.ctx) orelse {","class":"lineCov","hits":"2","order":"5012","possible_hits":"2",},
{"lineNum":"  210","line":"                    self.ctx.errors.add_error(errs_.Error{ .missing_context = .{","class":"lineCov","hits":"2","order":"5108","possible_hits":"2",},
{"lineNum":"  211","line":"                        .span = ast.token().span,","class":"lineCov","hits":"1","order":"5109","possible_hits":"1",},
{"lineNum":"  212","line":"                        .context = Type_AST.create_type_identifier(decl.token(), self.ctx.allocator()),","class":"lineCov","hits":"1","order":"5110","possible_hits":"1",},
{"lineNum":"  213","line":"                    } });"},
{"lineNum":"  214","line":"                    return error.CompileError;","class":"lineCov","hits":"2","order":"5023","possible_hits":"2",},
{"lineNum":"  215","line":"                };"},
{"lineNum":"  216","line":"                var token = ast.token();","class":"lineCov","hits":"1","order":"5024","possible_hits":"1",},
{"lineNum":"  217","line":"                token.data = context_val_symbol.name;","class":"lineCov","hits":"1","order":"5025","possible_hits":"1",},
{"lineNum":"  218","line":"                const context_val_ident = ast_.AST.create_identifier(token, self.ctx.allocator());","class":"lineCov","hits":"1","order":"5026","possible_hits":"1",},
{"lineNum":"  219","line":"                context_val_ident.set_symbol(context_val_symbol);","class":"lineCov","hits":"1","order":"5027","possible_hits":"1",},
{"lineNum":"  220","line":"                ast.set_lhs(context_val_ident);","class":"lineCov","hits":"4","order":"1996","possible_hits":"4",},
{"lineNum":"  221","line":"            }"},
{"lineNum":"  222","line":"        },"},
{"lineNum":"  223","line":""},
{"lineNum":"  224","line":"        .binding => {"},
{"lineNum":"  225","line":"            for (ast.binding.decls.items) |decl| {","class":"lineCov","hits":"4","order":"1997","possible_hits":"4",},
{"lineNum":"  226","line":"                if (decl.* == .decl) {","class":"lineCov","hits":"1","order":"1998","possible_hits":"1",},
{"lineNum":"  227","line":"                    decl.decl.name.symbol().?.defined = true;","class":"lineCov","hits":"1","order":"1999","possible_hits":"1",},
{"lineNum":"  228","line":"                }"},
{"lineNum":"  229","line":"            }","class":"lineCov","hits":"3","order":"2000","possible_hits":"3",},
{"lineNum":"  230","line":"        },"},
{"lineNum":"  231","line":"        .decl => {"},
{"lineNum":"  232","line":"            if (ast.decl.init != null and ast.decl.init.?.* == .access and ast.decl.init.?.symbol().?.kind == .type) {","class":"lineCov","hits":"2","order":"1993","possible_hits":"2",},
{"lineNum":"  233","line":"                const init_symbol = ast.decl.init.?.symbol().?;","class":"lineNoCov","hits":"0","possible_hits":"3",},
{"lineNum":"  234","line":"                ast.* = ast_.AST.create_type_alias(","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"  235","line":"                    ast.token(),","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"  236","line":"                    ast.decl.name,","class":"lineNoCov","hits":"0","possible_hits":"3",},
{"lineNum":"  237","line":"                    Type_AST.from_ast(ast.decl.init.?, self.ctx.allocator()),","class":"lineNoCov","hits":"0","possible_hits":"3",},
{"lineNum":"  238","line":"                    std.array_list.Managed(*ast_.AST).init(self.ctx.allocator()),","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"  239","line":"                    self.ctx.allocator(),","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"  240","line":"                ).*;"},
{"lineNum":"  241","line":"                ast.type_alias.init.?.set_symbol(init_symbol);","class":"linePartCov","hits":"2","order":"1994","possible_hits":"4",},
{"lineNum":"  242","line":"            }"},
{"lineNum":"  243","line":"        },"},
{"lineNum":"  244","line":"        .generic_apply => return self.monomorphize_generic_apply(ast),","class":"lineCov","hits":"2","order":"5545","possible_hits":"2",},
{"lineNum":"  245","line":"        .trait => self.scope.traits.append(ast) catch unreachable,","class":"lineCov","hits":"2","order":"2011","possible_hits":"2",},
{"lineNum":"  246","line":"        .@\"test\" => self.scope.tests.append(ast) catch unreachable,","class":"lineCov","hits":"2","order":"5100","possible_hits":"2",},
{"lineNum":"  247","line":"    }"},
{"lineNum":"  248","line":"}"},
{"lineNum":"  249","line":""},
{"lineNum":"  250","line":"fn decorate_postfix_type(self: Self, ast: *Type_AST) walk_.Error!void {","class":"lineCov","hits":"2","order":"1950","possible_hits":"2",},
{"lineNum":"  251","line":"    switch (ast.*) {","class":"lineCov","hits":"3","order":"1951","possible_hits":"3",},
{"lineNum":"  252","line":"        .access => ast.set_symbol(try self.resolve_access_ast(ast.access.inner_access)),","class":"lineNoCov","hits":"0","possible_hits":"2",},
{"lineNum":"  253","line":""},
{"lineNum":"  254","line":"        else => {},"},
{"lineNum":"  255","line":"    }"},
{"lineNum":"  256","line":"}"},
{"lineNum":"  257","line":""},
{"lineNum":"  258","line":"fn resolve_access_ast(self: Self, ast: *ast_.AST) walk_.Error!*Symbol {","class":"lineCov","hits":"2","order":"5355","possible_hits":"2",},
{"lineNum":"  259","line":"    const stripped_lhs = if (ast.lhs().* == .addr_of) ast.lhs().expr() else ast.lhs();","class":"linePartCov","hits":"1","order":"5356","possible_hits":"2",},
{"lineNum":"  260","line":"    const symbol = stripped_lhs.symbol().?;","class":"lineCov","hits":"3","order":"5357","possible_hits":"3",},
{"lineNum":"  261","line":""},
{"lineNum":"  262","line":"    return self.resolve_access_symbol(symbol, ast, stripped_lhs);","class":"lineCov","hits":"2","order":"5358","possible_hits":"2",},
{"lineNum":"  263","line":"}"},
{"lineNum":"  264","line":""},
{"lineNum":"  265","line":"fn resolve_access_symbol(self: Self, symbol: *Symbol, ast: *ast_.AST, stripped_lhs: *ast_.AST) walk_.Error!*Symbol {","class":"lineCov","hits":"2","order":"5359","possible_hits":"2",},
{"lineNum":"  266","line":"    switch (symbol.kind) {","class":"lineCov","hits":"3","order":"5360","possible_hits":"3",},
{"lineNum":"  267","line":"        .module => return try self.resolve_access_module(symbol, ast.rhs()),","class":"lineNoCov","hits":"0","possible_hits":"2",},
{"lineNum":"  268","line":""},
{"lineNum":"  269","line":"        .import => {"},
{"lineNum":"  270","line":"            const module_symbol = symbol.kind.import.real_symbol.?;","class":"lineCov","hits":"3","order":"5720","possible_hits":"3",},
{"lineNum":"  271","line":"            return try self.resolve_access_module(module_symbol, ast.rhs());","class":"lineCov","hits":"2","order":"5721","possible_hits":"2",},
{"lineNum":"  272","line":"        },"},
{"lineNum":"  273","line":""},
{"lineNum":"  274","line":"        .import_inner => {"},
{"lineNum":"  275","line":"            const new_symbol ="},
{"lineNum":"  276","line":"                if (symbol.decl.?.* == .type_alias)","class":"lineNoCov","hits":"0","possible_hits":"2",},
{"lineNum":"  277","line":"                    try self.resolve_access_ast(symbol.init_typedef().?.access.inner_access)","class":"lineNoCov","hits":"0","possible_hits":"2",},
{"lineNum":"  278","line":"                else"},
{"lineNum":"  279","line":"                    try self.resolve_access_ast(symbol.init_value().?);","class":"lineNoCov","hits":"0","possible_hits":"3",},
{"lineNum":"  280","line":"            return self.resolve_access_symbol(new_symbol, ast, stripped_lhs);","class":"lineNoCov","hits":"0","possible_hits":"2",},
{"lineNum":"  281","line":"        },"},
{"lineNum":"  282","line":""},
{"lineNum":"  283","line":"        .type => return try self.resolve_access_const(Type_AST.from_ast(stripped_lhs, self.ctx.allocator()), ast.rhs(), ast.scope().?),","class":"lineCov","hits":"2","order":"5361","possible_hits":"2",},
{"lineNum":"  284","line":""},
{"lineNum":"  285","line":"        else => {"},
{"lineNum":"  286","line":"            self.ctx.errors.add_error(errs_.Error{","class":"lineCov","hits":"2","order":"6173","possible_hits":"2",},
{"lineNum":"  287","line":"                .member_not_in_module = .{"},
{"lineNum":"  288","line":"                    .span = ast.rhs().token().span,","class":"lineCov","hits":"1","order":"6174","possible_hits":"1",},
{"lineNum":"  289","line":"                    .identifier = ast.rhs().token().data,","class":"lineCov","hits":"1","order":"6175","possible_hits":"1",},
{"lineNum":"  290","line":"                    .name = \"symbol\","},
{"lineNum":"  291","line":"                    .module_name = symbol.name,","class":"lineCov","hits":"1","order":"6176","possible_hits":"1",},
{"lineNum":"  292","line":"                },"},
{"lineNum":"  293","line":"            });"},
{"lineNum":"  294","line":"            return error.CompileError;","class":"lineCov","hits":"1","order":"6177","possible_hits":"1",},
{"lineNum":"  295","line":"        },"},
{"lineNum":"  296","line":"    }"},
{"lineNum":"  297","line":"}"},
{"lineNum":"  298","line":""},
{"lineNum":"  299","line":"fn monomorphize_generic_apply(self: Self, ast: *ast_.AST) walk_.Error!void {","class":"lineCov","hits":"2","order":"5282","possible_hits":"2",},
{"lineNum":"  300","line":"    const sym = ast.lhs().symbol().?;","class":"lineCov","hits":"2","order":"5283","possible_hits":"2",},
{"lineNum":"  301","line":"    const params = sym.decl.?.generic_params();","class":"lineCov","hits":"3","order":"5284","possible_hits":"3",},
{"lineNum":"  302","line":"    if (params.items.len != ast.generic_apply._children.items.len) {","class":"lineCov","hits":"2","order":"5285","possible_hits":"2",},
{"lineNum":"  303","line":"        self.ctx.errors.add_error(errs_.Error{ .mismatch_arity = .{","class":"lineNoCov","hits":"0","possible_hits":"2",},
{"lineNum":"  304","line":"            .span = ast.token().span,","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"  305","line":"            .takes = params.items.len,","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"  306","line":"            .given = ast.generic_apply._children.items.len,","class":"lineNoCov","hits":"0","possible_hits":"3",},
{"lineNum":"  307","line":"            .thing_name = sym.name,","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"  308","line":"            .takes_name = \"type parameter\","},
{"lineNum":"  309","line":"            .given_name = \"argument\","},
{"lineNum":"  310","line":"        } });"},
{"lineNum":"  311","line":"        return error.CompileError;","class":"linePartCov","hits":"2","order":"5286","possible_hits":"3",},
{"lineNum":"  312","line":"    }"},
{"lineNum":"  313","line":""},
{"lineNum":"  314","line":"    for (ast.generic_apply._children.items) |child| {","class":"lineCov","hits":"4","order":"5287","possible_hits":"4",},
{"lineNum":"  315","line":"        try self.ctx.validate_type.validate_type(child);","class":"linePartCov","hits":"1","order":"5288","possible_hits":"2",},
{"lineNum":"  316","line":"    }","class":"lineCov","hits":"3","order":"5289","possible_hits":"3",},
{"lineNum":"  317","line":""},
{"lineNum":"  318","line":"    if (ast.generic_apply.state == .unmorphed) {","class":"lineCov","hits":"2","order":"5290","possible_hits":"2",},
{"lineNum":"  319","line":"        ast.generic_apply.state = .morphing;","class":"lineCov","hits":"3","order":"5291","possible_hits":"3",},
{"lineNum":"  320","line":"        ast.generic_apply._symbol = try sym.monomorphize(ast.generic_apply._children, self.ctx);","class":"lineCov","hits":"2","order":"5292","possible_hits":"2",},
{"lineNum":"  321","line":"        ast.generic_apply.state = .morphed;","class":"lineCov","hits":"3","order":"5353","possible_hits":"3",},
{"lineNum":"  322","line":"    }"},
{"lineNum":"  323","line":"}"},
{"lineNum":"  324","line":""},
{"lineNum":"  325","line":"/// Takes in an a qualified-name AST and returns the symbol that it refers to. This requires looking up modules and packages, and so the"},
{"lineNum":"  326","line":"/// compiler instance is required."},
{"lineNum":"  327","line":"fn resolve_symbol_from_ast(self: Self, ast: *ast_.AST) walk_.Error!*Symbol {"},
{"lineNum":"  328","line":"    switch (ast.*) {"},
{"lineNum":"  329","line":"        .access => return self.resolve_symbol_from_access(ast),"},
{"lineNum":"  330","line":"        .identifier, .pattern_symbol => return self.resolve_symbol_from_identlike(ast),"},
{"lineNum":"  331","line":"        .generic_apply => return ast.symbol().?,"},
{"lineNum":"  332","line":"        else => std.debug.panic(\"compiler error: fell through {f}\", .{ast}),"},
{"lineNum":"  333","line":"    }"},
{"lineNum":"  334","line":"}"},
{"lineNum":"  335","line":""},
{"lineNum":"  336","line":"/// Takes in an access-ast and resolves the symbol it refers to"},
{"lineNum":"  337","line":"fn resolve_symbol_from_access(self: Self, access_ast: *ast_.AST) walk_.Error!*Symbol {"},
{"lineNum":"  338","line":"    const stripped_lhs = if (access_ast.lhs().* == .addr_of) access_ast.lhs().expr() else access_ast.lhs();"},
{"lineNum":"  339","line":"    const expanded_lhs = stripped_lhs.symbol().?;"},
{"lineNum":"  340","line":"    const symbol = try self.resolve_access_symbol(expanded_lhs, access_ast.rhs(), access_ast.scope().?);"},
{"lineNum":"  341","line":"    access_ast.set_symbol(symbol);"},
{"lineNum":"  342","line":"    return symbol;"},
{"lineNum":"  343","line":"}"},
{"lineNum":"  344","line":""},
{"lineNum":"  345","line":"/// Takes in a identifier-like AST (such as an identifier or a pattern symbol) and returns the symbol it refers to"},
{"lineNum":"  346","line":"fn resolve_symbol_from_identlike(self: Self, identlike_ast: *ast_.AST) walk_.Error!*Symbol {"},
{"lineNum":"  347","line":"    switch (identlike_ast.symbol().?.kind) {"},
{"lineNum":"  348","line":"        .module => {"},
{"lineNum":"  349","line":"            // We found it as a module _because_ it wasn\'t imported"},
{"lineNum":"  350","line":"            self.ctx.errors.add_error(errs_.Error{ .undeclared_identifier = .{ .identifier = identlike_ast.token(), .expected = null } });"},
{"lineNum":"  351","line":"            return error.CompileError;"},
{"lineNum":"  352","line":"        },"},
{"lineNum":"  353","line":"        .import => return self.resolve_symbol_from_import_identlike(identlike_ast),"},
{"lineNum":"  354","line":"        else => return identlike_ast.symbol().?,"},
{"lineNum":"  355","line":"    }"},
{"lineNum":"  356","line":"}"},
{"lineNum":"  357","line":""},
{"lineNum":"  358","line":"/// Takes in an identlike AST that refers to an import symbol, and returns the module symbol that it imports"},
{"lineNum":"  359","line":"fn resolve_symbol_from_import_identlike(self: Self, identlike_ast: *ast_.AST) *Symbol {"},
{"lineNum":"  360","line":"    const this_module = identlike_ast.symbol().?.scope.module.?;"},
{"lineNum":"  361","line":"    const curr_package_path = this_module.get_package_abs_path();"},
{"lineNum":"  362","line":"    var module_path_name = std.array_list.Managed(u8).init(self.ctx.allocator());"},
{"lineNum":"  363","line":"    defer module_path_name.deinit();"},
{"lineNum":"  364","line":"    module_path_name.print(\"{s}.orng\", .{identlike_ast.token().data}) catch unreachable;"},
{"lineNum":"  365","line":"    const package_build_paths = [_][]const u8{ curr_package_path, module_path_name.items };"},
{"lineNum":"  366","line":"    const other_module_dir = std.fs.path.join(self.ctx.allocator(), &package_build_paths) catch unreachable;"},
{"lineNum":"  367","line":""},
{"lineNum":"  368","line":"    if (std.mem.eql(u8, identlike_ast.symbol().?.kind.import.real_name, \"core\")) {"},
{"lineNum":"  369","line":"        return core_.core_symbol.?;"},
{"lineNum":"  370","line":"    }"},
{"lineNum":"  371","line":""},
{"lineNum":"  372","line":"    // TODO: If these are both non-null, report the ambiguity"},
{"lineNum":"  373","line":"    //       If these are both null, report that the module was not found"},
{"lineNum":"  374","line":""},
{"lineNum":"  375","line":"    const local_module_lookup = self.ctx.lookup_module(other_module_dir);"},
{"lineNum":"  376","line":"    const foreign_module_lookup = self.ctx.lookup_package_root_module(curr_package_path, identlike_ast.symbol().?.kind.import.real_name);"},
{"lineNum":"  377","line":""},
{"lineNum":"  378","line":"    // TODO: This doesn\'t work when we do:"},
{"lineNum":"  379","line":"    //   import module::member"},
{"lineNum":"  380","line":"    return (local_module_lookup orelse foreign_module_lookup) orelse {"},
{"lineNum":"  381","line":"        std.debug.panic(\"couldn\'t find module {s} or package {s}\", .{ other_module_dir, identlike_ast.symbol().?.kind.import.real_name });"},
{"lineNum":"  382","line":"    };"},
{"lineNum":"  383","line":"}"},
{"lineNum":"  384","line":""},
{"lineNum":"  385","line":"/// Resolves a symbol access from a module"},
{"lineNum":"  386","line":"fn resolve_access_module(self: Self, module_symbol: *Symbol, rhs: *ast_.AST) walk_.Error!*Symbol {","class":"lineCov","hits":"2","order":"5722","possible_hits":"2",},
{"lineNum":"  387","line":"    std.debug.assert(module_symbol.kind == .module);","class":"lineCov","hits":"1","order":"5723","possible_hits":"1",},
{"lineNum":"  388","line":"    const module_lookup_res = module_symbol.init_value().?.scope().?.lookup(","class":"lineCov","hits":"3","order":"5724","possible_hits":"3",},
{"lineNum":"  389","line":"        rhs.token().data,","class":"lineCov","hits":"1","order":"5725","possible_hits":"1",},
{"lineNum":"  390","line":"        .{},"},
{"lineNum":"  391","line":"    );"},
{"lineNum":"  392","line":"    const rhs_decl = switch (module_lookup_res) {","class":"lineCov","hits":"3","order":"5726","possible_hits":"3",},
{"lineNum":"  393","line":"        .found => module_lookup_res.found.decl.?,","class":"lineNoCov","hits":"0","possible_hits":"2",},
{"lineNum":"  394","line":"        else => {"},
{"lineNum":"  395","line":"            self.ctx.errors.add_error(errs_.Error{","class":"lineCov","hits":"2","order":"5727","possible_hits":"2",},
{"lineNum":"  396","line":"                .member_not_in_module = .{"},
{"lineNum":"  397","line":"                    .span = rhs.token().span,","class":"lineCov","hits":"1","order":"5728","possible_hits":"1",},
{"lineNum":"  398","line":"                    .identifier = rhs.token().data,","class":"lineCov","hits":"1","order":"5729","possible_hits":"1",},
{"lineNum":"  399","line":"                    .name = \"module\","},
{"lineNum":"  400","line":"                    .module_name = module_symbol.name,","class":"lineCov","hits":"1","order":"5730","possible_hits":"1",},
{"lineNum":"  401","line":"                },"},
{"lineNum":"  402","line":"            });"},
{"lineNum":"  403","line":"            return error.CompileError;","class":"linePartCov","hits":"1","order":"5731","possible_hits":"2",},
{"lineNum":"  404","line":"        },"},
{"lineNum":"  405","line":"    };"},
{"lineNum":"  406","line":"    return extract_symbol_from_decl(rhs_decl);","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"  407","line":"}"},
{"lineNum":"  408","line":""},
{"lineNum":"  409","line":"/// Resolves a symbol access on an import symbol"},
{"lineNum":"  410","line":"/// This is gauranteed to work, since the import-module symbol connection is setup by the compiler itself"},
{"lineNum":"  411","line":"// fn resolve_access_import(self: Self, import_symbol: *Symbol, rhs: *ast_.AST, scope: *Scope) walk_.Error!*Symbol {"},
{"lineNum":"  412","line":"//     const referant_symbol = import_symbol.scope.parent.?.lookup(import_symbol.kind.import.real_name, .{ .allow_modules = true }).found;"},
{"lineNum":"  413","line":"//     return try self.resolve_access_symbol(referant_symbol, rhs, scope);"},
{"lineNum":"  414","line":"// }"},
{"lineNum":"  415","line":""},
{"lineNum":"  416","line":"/// Resolves a symbol access on a constant symbol, likely a trait lookup"},
{"lineNum":"  417","line":"fn resolve_access_const(self: Self, lhs: *Type_AST, rhs: *ast_.AST, scope: *Scope) walk_.Error!*Symbol {","class":"lineCov","hits":"2","order":"5366","possible_hits":"2",},
{"lineNum":"  418","line":"    const rhs_decl = scope.lookup_impl_member(lhs, rhs.token().data, self.ctx) catch return error.CompileError;","class":"lineCov","hits":"2","order":"5367","possible_hits":"2",},
{"lineNum":"  419","line":"    if (rhs_decl == null) {","class":"lineCov","hits":"1","order":"5537","possible_hits":"1",},
{"lineNum":"  420","line":"        self.ctx.errors.add_error(errs_.Error{","class":"lineCov","hits":"2","order":"6361","possible_hits":"2",},
{"lineNum":"  421","line":"            .type_not_impl_method = .{"},
{"lineNum":"  422","line":"                .span = rhs.token().span,","class":"lineCov","hits":"1","order":"6362","possible_hits":"1",},
{"lineNum":"  423","line":"                .method_name = rhs.token().data,","class":"lineCov","hits":"1","order":"6363","possible_hits":"1",},
{"lineNum":"  424","line":"                ._type = lhs,"},
{"lineNum":"  425","line":"            },"},
{"lineNum":"  426","line":"        });"},
{"lineNum":"  427","line":"        return error.CompileError;","class":"lineCov","hits":"1","order":"6364","possible_hits":"1",},
{"lineNum":"  428","line":"    } else {"},
{"lineNum":"  429","line":"        return extract_symbol_from_decl(rhs_decl.?);","class":"lineCov","hits":"1","order":"5538","possible_hits":"1",},
{"lineNum":"  430","line":"    }"},
{"lineNum":"  431","line":"}"},
{"lineNum":"  432","line":""},
{"lineNum":"  433","line":"/// Extracts the symbol that a decl-like AST decls"},
{"lineNum":"  434","line":"fn extract_symbol_from_decl(decl: *ast_.AST) *Symbol {","class":"lineCov","hits":"2","order":"5539","possible_hits":"2",},
{"lineNum":"  435","line":"    if (decl.* == .decl) {","class":"lineCov","hits":"1","order":"5540","possible_hits":"1",},
{"lineNum":"  436","line":"        return decl.decl.name.symbol().?;","class":"lineNoCov","hits":"0","possible_hits":"2",},
{"lineNum":"  437","line":"    } else if (decl.* == .method_decl or decl.* == .fn_decl or decl.* == .trait or decl.* == .struct_decl or decl.* == .enum_decl or decl.* == .type_alias or decl.* == .context_decl) {","class":"lineCov","hits":"2","order":"5541","possible_hits":"2",},
{"lineNum":"  438","line":"        return decl.symbol().?;","class":"lineCov","hits":"2","order":"5542","possible_hits":"2",},
{"lineNum":"  439","line":"    } else if (decl.* == .binding) {","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"  440","line":"        return decl.binding.pattern.symbol().?;","class":"lineNoCov","hits":"0","possible_hits":"2",},
{"lineNum":"  441","line":"    } else {"},
{"lineNum":"  442","line":"        std.debug.panic(\"compiler error: unsupported access symbol resolution for decl-like AST: {s}\", .{@tagName(decl.*)});","class":"lineNoCov","hits":"0","possible_hits":"2",},
{"lineNum":"  443","line":"    }"},
{"lineNum":"  444","line":"}"},
]};
var percent_low = 25;var percent_high = 75;
var header = { "command" : "orng-test", "date" : "2025-11-10 15:43:08", "instrumented" : 183, "covered" : 153,};
var merged_data = [];
